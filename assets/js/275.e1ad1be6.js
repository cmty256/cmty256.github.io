(window.webpackJsonp=window.webpackJsonp||[]).push([[275],{603:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"api-调用平台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-调用平台"}},[t._v("#")]),t._v(" "),s("code",[t._v("API")]),t._v(" 调用平台")]),t._v(" "),s("h2",{attrs:{id:"项目介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目介绍"}},[t._v("#")]),t._v(" 项目介绍")]),t._v(" "),s("p",[t._v("一个提供 "),s("code",[t._v("API")]),t._v(" 接口供开发者调用的平台。（类似腾讯云）")]),t._v(" "),s("p",[t._v("用户可以注册登录，开通接口调用权限。用户可以浏览接口并调用，且每次调用会进行统计。")]),t._v(" "),s("p",[t._v("管理员可以发布接口、下线接口、接入接口，以及可视化接口的调用情况、数据。")]),t._v(" "),s("p",[t._v("项目侧重于后端，包含较多的编程技巧和架构设计层面的知识。")]),t._v(" "),s("h2",{attrs:{id:"第一阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第一阶段"}},[t._v("#")]),t._v(" 第一阶段")]),t._v(" "),s("h3",{attrs:{id:"主要内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主要内容"}},[t._v("#")]),t._v(" 主要内容：")]),t._v(" "),s("ol",[s("li",[t._v("项目介绍、业务流程、项目计划、需求分析")]),t._v(" "),s("li",[t._v("数据库表设计")]),t._v(" "),s("li",[t._v("前后端项目初始化（包含 "),s("code",[t._v("Ant Design Pro")]),t._v(" 框架最新版本的使用）")]),t._v(" "),s("li",[t._v("前后端代码自动生成（提高开发效率）")]),t._v(" "),s("li",[t._v("登录页、接口信息页开发")])]),t._v(" "),s("h3",{attrs:{id:"需求分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#需求分析"}},[t._v("#")]),t._v(" 需求分析")]),t._v(" "),s("p",[t._v("背景：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("前端开发需要用到后台接口")])]),t._v(" "),s("li",[s("p",[t._v("使用现成的系统的功能（"),s("a",{attrs:{href:"http://api.btstu.cn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("博天api"),s("OutboundLink")],1),t._v("）")])])]),t._v(" "),s("p",[t._v("做一个 "),s("code",[t._v("API")]),t._v(" 接口平台：")]),t._v(" "),s("ol",[s("li",[t._v("管理员可以对接口信息进行增删改查")]),t._v(" "),s("li",[t._v("用户可以访问前台，查看接口信息")])]),t._v(" "),s("p",[t._v("其他要求：")]),t._v(" "),s("ol",[s("li",[t._v("防止攻击（安全性）")]),t._v(" "),s("li",[t._v("不能随便调用（限制、开通） -- 限制流量，避免系统崩溃")]),t._v(" "),s("li",[s("strong",[t._v("统计调用次数")])]),t._v(" "),s("li",[t._v("计费")]),t._v(" "),s("li",[t._v("流量保护")]),t._v(" "),s("li",[s("code",[t._v("API")]),t._v(" 接入")])]),t._v(" "),s("h3",{attrs:{id:"业务流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#业务流程"}},[t._v("#")]),t._v(" 业务流程")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20230424200930707","data-src":"https://cmty256.github.io/imgs-blog/images/image-20230424200930707.png",loading:"lazy"}})]),t._v(" "),s("h3",{attrs:{id:"技术选型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#技术选型"}},[t._v("#")]),t._v(" 技术选型")]),t._v(" "),s("h4",{attrs:{id:"前端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端"}},[t._v("#")]),t._v(" "),s("strong",[t._v("前端")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Ant Design Pro")])]),t._v(" "),s("li",[s("code",[t._v("React")])]),t._v(" "),s("li",[s("code",[t._v("Ant Design Procomponents")])]),t._v(" "),s("li",[s("code",[t._v("Umi")])]),t._v(" "),s("li",[s("code",[t._v("Umi Request")]),t._v("（"),s("code",[t._v("Axios")]),t._v(" 的封装）")])]),t._v(" "),s("h4",{attrs:{id:"后端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后端"}},[t._v("#")]),t._v(" "),s("strong",[t._v("后端")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Java Spring Boot")])]),t._v(" "),s("li",[s("code",[t._v("Spring Boot Starter")]),t._v("("),s("code",[t._v("SDK")]),t._v("开发)")]),t._v(" "),s("li",[s("code",[t._v("Dubbo")]),t._v("（"),s("code",[t._v("RPC")]),t._v("）")]),t._v(" "),s("li",[s("code",[t._v("Nacos")])]),t._v(" "),s("li",[s("code",[t._v("Spring Cloud Gateway")]),t._v("（网关、限流、日志实现）")])]),t._v(" "),s("h3",{attrs:{id:"数据库表设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库表设计"}},[t._v("#")]),t._v(" 数据库表设计")]),t._v(" "),s("div",{staticClass:"language-SQL line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 接口信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exists")]),t._v(" myapi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("interface_info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto_increment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'主键'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("primary")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'接口名称'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("description"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'描述'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'接口地址'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("request_header"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请求头'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("reponse_header"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("text")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'响应头'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'接口状态（0-关闭，1-开启））'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请求类型'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("user_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'创建人'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("create_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'创建时间'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("update_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("update")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'更新时间'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("is_deleted"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'是否删除(0-未删, 1-已删)'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'接口信息'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br")])]),s("h3",{attrs:{id:"项目脚手架"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目脚手架"}},[t._v("#")]),t._v(" "),s("strong",[t._v("项目脚手架")])]),t._v(" "),s("p",[t._v("前端："),s("code",[t._v("Ant Design Pro")]),t._v(" 脚手架（https://pro.ant.design/zh-cn/）")]),t._v(" "),s("p",[t._v("后端："),s("code",[t._v("springboot-init")]),t._v(" 后端代码模板")]),t._v(" "),s("h3",{attrs:{id:"基础功能开发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础功能开发"}},[t._v("#")]),t._v(" 基础功能开发")]),t._v(" "),s("p",[t._v("增删改查、登录功能（通过对模板的复制粘贴修改完成)")]),t._v(" "),s("p",[t._v("前端接口调用：后端使用遵循 "),s("code",[t._v("openapi")]),t._v(" 的规范的 "),s("code",[t._v("swagger")]),t._v(" 文档，使用前端 "),s("code",[t._v("Ant Design Pro")]),t._v(" 框架集成的 "),s("code",[t._v("openapi")]),t._v(" 插件自动生成。")]),t._v(" "),s("h2",{attrs:{id:"第二阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第二阶段"}},[t._v("#")]),t._v(" 第二阶段")]),t._v(" "),s("h3",{attrs:{id:"主要内容-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主要内容-2"}},[t._v("#")]),t._v(" 主要内容：")]),t._v(" "),s("ol",[s("li",[t._v("开发接口管理前端页面")]),t._v(" "),s("li",[t._v("开发模拟 "),s("code",[t._v("API")]),t._v(" 接口")]),t._v(" "),s("li",[t._v("开发调用接口客户端")]),t._v(" "),s("li",[t._v("开发调用的安全性（"),s("code",[t._v("API")]),t._v(" 签名认证）")]),t._v(" "),s("li",[t._v("客户端 "),s("code",[t._v("SDK")]),t._v(" 的开发（"),s("code",[t._v("SDK")]),t._v("--"),s("code",[t._v("Spring Boot Starter")]),t._v(" 开发）")])]),t._v(" "),s("h3",{attrs:{id:"模拟接口项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模拟接口项目"}},[t._v("#")]),t._v(" 模拟接口项目")]),t._v(" "),s("p",[t._v("项目名称："),s("code",[t._v("myapi-interface")])]),t._v(" "),s("p",[t._v("提供三个不同种类的模拟接口：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("GET")]),t._v(" 接口")]),t._v(" "),s("li",[s("code",[t._v("POST")]),t._v(" 接口（"),s("code",[t._v("url")]),t._v(" 传参）")]),t._v(" "),s("li",[s("code",[t._v("POST")]),t._v(" 接口（"),s("code",[t._v("Restful")]),t._v("）")])]),t._v(" "),s("h4",{attrs:{id:"调用接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调用接口"}},[t._v("#")]),t._v(" 调用接口")]),t._v(" "),s("p",[t._v("几种 "),s("code",[t._v("HTTP")]),t._v(" 调用方式：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("HttpClient")])]),t._v(" "),s("li",[s("code",[t._v("RestTemplate")])]),t._v(" "),s("li",[t._v("第三方库（"),s("code",[t._v("OKHTTP")]),t._v("、"),s("code",[t._v("Hutool")]),t._v(")")])]),t._v(" "),s("hr"),t._v(" "),s("p",[s("code",[t._v("Hutool")]),t._v("：https://hutool.cn/docs/#/")]),t._v(" "),s("p",[s("code",[t._v("HTTP")]),t._v(" 客户端工具类：")]),t._v(" "),s("p",[t._v("https://hutool.cn/docs/#/http/Http%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E5%85%B7%E7%B1%BB-HttpUtil")]),t._v(" "),s("h3",{attrs:{id:"api-签名认证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-签名认证"}},[t._v("#")]),t._v(" "),s("code",[t._v("API")]),t._v(" 签名认证")]),t._v(" "),s("p",[t._v("本质：")]),t._v(" "),s("ol",[s("li",[t._v("签发签名")]),t._v(" "),s("li",[t._v("使用签名（校验签名）")])]),t._v(" "),s("p",[t._v("为什么需要？")]),t._v(" "),s("ol",[s("li",[t._v("保证安全性，不能随便一个人调用")]),t._v(" "),s("li",[t._v("适用于无需保存登录态的场景。只认签名，不关注用户登录态。")])]),t._v(" "),s("h4",{attrs:{id:"签名认证实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#签名认证实现"}},[t._v("#")]),t._v(" 签名认证实现")]),t._v(" "),s("p",[t._v("通过 "),s("code",[t._v("http request header")]),t._v(" 头传递参数。")]),t._v(" "),s("p",[t._v("参数 1："),s("code",[t._v("accessKey")]),t._v("：调用的标识 "),s("code",[t._v("userA")]),t._v(","),s("code",[t._v("userB")]),t._v("（复杂、无序、无规律）")]),t._v(" "),s("p",[t._v("参数 2："),s("code",[t._v("secretKey")]),t._v("：密钥（复杂、无序、无规律）"),s("strong",[t._v("该参数不能放到请求头中")]),t._v("（类似用户名和密码，区别："),s("code",[t._v("ak")]),t._v("、"),s("code",[t._v("sk")]),t._v(" 是无状态的）")]),t._v(" "),s("hr"),t._v(" "),s("blockquote",[s("p",[t._v("可以自己写代码来给用户生成 "),s("code",[t._v("ak")]),t._v("、"),s("code",[t._v("sk")])])]),t._v(" "),s("p",[t._v("千万不能把密钥直接在服务器之间传递，有可能会被拦截")]),t._v(" "),s("p",[t._v("参数 3：用户请求参数")]),t._v(" "),s("p",[t._v("参数 4："),s("code",[t._v("sign")])]),t._v(" "),s("hr"),t._v(" "),s("ul",[s("li",[t._v("加密方式：对称加密、非对称加密、"),s("code",[t._v("md5")]),t._v(" 签名（不可解密）")]),t._v(" "),s("li",[t._v("用户参数 + 密钥 => "),s("strong",[t._v("签名生成算法（"),s("code",[t._v("MD5")]),t._v("、"),s("code",[t._v("HMAac")]),t._v("、"),s("code",[t._v("Sha1")]),t._v("）")]),t._v(" => 不可解密的值 abc + abcdefgh => sajdgdioajdgioa")])]),t._v(" "),s("p",[t._v("怎么知道这个签名对不对？")]),t._v(" "),s("p",[s("strong",[t._v("服务端用一模一样的参数和算法去生成签名，只要和用户传的一致，就表示一致。")])]),t._v(" "),s("p",[s("strong",[t._v("怎么防重放？")])]),t._v(" "),s("p",[t._v("参数 5：加 "),s("code",[t._v("nonce")]),t._v(" 随机数，只能用一次")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("服务端要保存用过的随机数（缺点：增大了开销，所以要给随机数加个有效期）")]),t._v(" "),s("p",[t._v("参数 6：加 "),s("code",[t._v("timestamp")]),t._v(" 时间戳，校验时间戳是否过期。")]),t._v(" "),s("hr"),t._v(" "),s("p",[s("strong",[s("code",[t._v("API")]),t._v(" 签名认证是一个很灵活的设计，具体要有哪些参数、参数名如何一定要根据场景来。（比如 "),s("code",[t._v("userId")]),t._v("、"),s("code",[t._v("appId")]),t._v("、"),s("code",[t._v("version")]),t._v("、固定值等）")])]),t._v(" "),s("p",[t._v("思考：难道开发者每次调用接口都要自己写签名算法？")]),t._v(" "),s("h3",{attrs:{id:"开发简单易用的-sdk-简历加分项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开发简单易用的-sdk-简历加分项"}},[t._v("#")]),t._v(" 开发简单易用的 "),s("code",[t._v("SDK")]),t._v("（简历加分项）")]),t._v(" "),s("p",[t._v("项目名：myapi-client-sdk")]),t._v(" "),s("h4",{attrs:{id:"为什么需要-starter"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要-starter"}},[t._v("#")]),t._v(" 为什么需要 "),s("code",[t._v("Starter")]),t._v("？")]),t._v(" "),s("p",[t._v("理想情况：开发者只需要关心调用哪些接口、传递哪些参数，就跟自己写的代码一样简单。")]),t._v(" "),s("p",[t._v("开发 "),s("code",[t._v("starter")]),t._v(" 的好处：开发者引入之后，可以直接在 "),s("code",[t._v("application.yml")]),t._v(" 中写配置，自动创建客户端")]),t._v(" "),s("h4",{attrs:{id:"starter-开发流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#starter-开发流程"}},[t._v("#")]),t._v(" "),s("code",[t._v("Starter")]),t._v(" 开发流程")]),t._v(" "),s("p",[t._v("初始化，环境依赖（一定要移除 "),s("code",[t._v("build")]),t._v("）：")]),t._v(" "),s("p",[s("code",[t._v("spring-boot-configuration-processor")]),t._v(" 的作用是"),s("strong",[t._v("自动生成配置的代码提示")]),t._v("（"),s("code",[t._v("yml")]),t._v(" 文件里）")]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[t._v("         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--在 spring-boot-starter 依赖里包含了--\x3e")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-autoconfigure"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-configuration-processor"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("optional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("optional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.projectlombok"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("lombok"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("optional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("optional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br")])]),s("p",[t._v("编写配置类（启动类）：")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Data")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@ComponentScan")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//定义一个配置前缀")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@ConfigurationProperties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prefix "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chenmeng.api.client"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CmApiClientConfig")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" accessKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" secretKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CmApiClient")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cmApiClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CmApiClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("accessKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" secretKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br")])]),s("p",[t._v("注册配置类，"),s("code",[t._v("resources/META_INF/spring.factories")]),t._v(" 文件：")]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[t._v("# spring boot starter\norg.springframework.boot.autoconfigure.EnableAutoConfiguration=com.chenmeng.CmApiClientConfig\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[s("code",[t._v("mvn install")]),t._v(" 打包代码为本地依赖包")]),t._v(" "),s("p",[t._v("创建新项目，（复用 "),s("code",[t._v("server")]),t._v(" 项目）、测试")]),t._v(" "),s("p",[t._v("小作业：把打包好的包发送到 "),s("code",[t._v("maven")]),t._v(" 仓库中")]),t._v(" "),s("h2",{attrs:{id:"第三阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第三阶段"}},[t._v("#")]),t._v(" 第三阶段")]),t._v(" "),s("h3",{attrs:{id:"主要内容-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主要内容-3"}},[t._v("#")]),t._v(" 主要内容：")]),t._v(" "),s("ol",[s("li",[t._v("开发接口发布 / 下线的功能")]),t._v(" "),s("li",[t._v("开发浏览接口、查看接口文档、申请签名功能")]),t._v(" "),s("li",[t._v("开发在线调试功能")])]),t._v(" "),s("h3",{attrs:{id:"功能开发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#功能开发"}},[t._v("#")]),t._v(" 功能开发")]),t._v(" "),s("h4",{attrs:{id:"接口发布-下线的功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#接口发布-下线的功能"}},[t._v("#")]),t._v(" 接口发布 / 下线的功能")]),t._v(" "),s("p",[t._v("权限控制：仅管理员操作")]),t._v(" "),s("h5",{attrs:{id:"业务逻辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#业务逻辑"}},[t._v("#")]),t._v(" 业务逻辑")]),t._v(" "),s("p",[t._v("发布接口：")]),t._v(" "),s("ol",[s("li",[t._v("校验该接口是否存在")]),t._v(" "),s("li",[t._v("判断该接口是否可以调用")]),t._v(" "),s("li",[t._v("修改接口数据库中的状态字段为 1（考虑：可以设计 0 为默认，1 为开启，2 为关闭）")])]),t._v(" "),s("p",[t._v("下线接口：")]),t._v(" "),s("ol",[s("li",[t._v("校验该接口是否存在")]),t._v(" "),s("li",[t._v("修改接口数据库中的状态字段为 0")])]),t._v(" "),s("h4",{attrs:{id:"前端浏览接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端浏览接口"}},[t._v("#")]),t._v(" 前端浏览接口")]),t._v(" "),s("h5",{attrs:{id:"查看接口文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看接口文档"}},[t._v("#")]),t._v(" 查看接口文档")]),t._v(" "),s("p",[t._v("思路：动态路由，用 url 来传递 id ，加载不同的接口信息")]),t._v(" "),s("h5",{attrs:{id:"申请签名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#申请签名"}},[t._v("#")]),t._v(" 申请签名")]),t._v(" "),s("p",[t._v("用户在注册成功时，自动分配 accessKey、secretKey")]),t._v(" "),s("h5",{attrs:{id:"在线调用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在线调用"}},[t._v("#")]),t._v(" 在线调用")]),t._v(" "),s("p",[t._v("请求参数的类型（直接用 json 类型，更灵活）：")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[s("em",[t._v("TODO")])]),t._v(" "),s("p",[t._v("先跑通整个接口流程，后续可以针对不同的请求头或者接口类型来设计界面和表单，给用户更好的体验。（可以参考 swagger、postman、knife4j）")]),t._v(" "),s("h5",{attrs:{id:"调用流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调用流程"}},[t._v("#")]),t._v(" 调用流程")]),t._v(" "),s("p",[t._v("使用上述流程：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20230503194855075","data-src":"https://cmty256.github.io/imgs-blog/images/image-20230503194855075.png",loading:"lazy"}})]),t._v(" "),s("p",[t._v("流程：")]),t._v(" "),s("ol",[s("li",[t._v("前端将用户输入的请求参数和测试的接口 id 发给平台后端")]),t._v(" "),s("li",[t._v("（在调用前可以做一些校验）")]),t._v(" "),s("li",[t._v("平台后端去调用模拟接口")])]),t._v(" "),s("h3",{attrs:{id:"todo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#todo"}},[t._v("#")]),t._v(" TODO")]),t._v(" "),s("p",[t._v("判断接口是否可以调用时 由固定方法名 改为根据测试地址来调用")]),t._v(" "),s("p",[t._v("用户测试接口固定方法名改为根据测试地址来调用")]),t._v(" "),s("p",[t._v("模拟接口改为数据库校验 aKey")]),t._v(" "),s("p",[t._v("给 请求参数的类型 加多个 type ，目前只有 name")]),t._v(" "),s("h2",{attrs:{id:"第四阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第四阶段"}},[t._v("#")]),t._v(" 第四阶段")]),t._v(" "),s("h3",{attrs:{id:"主要内容-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主要内容-4"}},[t._v("#")]),t._v(" 主要内容：")]),t._v(" "),s("ol",[s("li",[t._v("开发接口调用次数统计功能")]),t._v(" "),s("li",[t._v("优化整个系统的架构 - API 网关详解")])]),t._v(" "),s("p",[t._v("​\ta. 网关是什么？")]),t._v(" "),s("p",[t._v("​\tb. 网关的作用？")]),t._v(" "),s("p",[t._v("​\tc. 网关的应用场景及实现？")]),t._v(" "),s("p",[t._v("​\td. 结合业务去应用网关")]),t._v(" "),s("h3",{attrs:{id:"接口调用次数统计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#接口调用次数统计"}},[t._v("#")]),t._v(" 接口调用次数统计")]),t._v(" "),s("p",[t._v("需求：")]),t._v(" "),s("ol",[s("li",[t._v("用户每次调用接口成功，次数 +1 （可以考虑用 -1）")]),t._v(" "),s("li",[t._v("给用户分配或者用户自主申请接口调用次数")])]),t._v(" "),s("p",[t._v("业务流程：")]),t._v(" "),s("ol",[s("li",[t._v("用户调用接口（之前已完成）")]),t._v(" "),s("li",[t._v("修改数据库，调用次数 +1")])]),t._v(" "),s("p",[t._v("设计库表")]),t._v(" "),s("p",[t._v("用哪个用户？哪个接口？")]),t._v(" "),s("p",[t._v("用户 => 接口（多对多）")]),t._v(" "),s("p",[t._v("用户调用接口关系表：")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--- 用户调用接口关系表")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exists")]),t._v(" cmapi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("user_interface_info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("auto_increment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'主键'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("primary")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'调用用户 id'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("interfaceInfoId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'接口 id'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("totalNum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'总调用次数'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("leftNum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'剩余调用次数'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0-正常，1-禁用'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("createTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'创建时间'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("updateTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("update")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'更新时间'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("isDelete"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'是否删除(0-未删，1-已删)'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("comment")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'用户调用接口关系'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])]),s("p",[t._v("开发步骤：")]),t._v(" "),s("ol",[s("li",[t._v("开发基本增删改查（给管理员用）")]),t._v(" "),s("li",[t._v("开发用户调用接口次数 +1 的功能（service）")])]),t._v(" "),s("h4",{attrs:{id:"问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[t._v("#")]),t._v(" "),s("strong",[t._v("问题")])]),t._v(" "),s("p",[t._v("如果每个接口的方法都调用次数 +1，是不是比较麻烦？")]),t._v(" "),s("p",[t._v("致命问题：接口开发者需要自己去添加统计代码")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20230506174904962","data-src":"https://cmty256.github.io/imgs-blog/images/image-20230506174904962.png",loading:"lazy"}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("使用 AOP 切面的优点：独立于接口，在每个接口调用后统计次数 +1")])]),t._v(" "),s("li",[s("p",[t._v("使用 AOP 切面的缺点：只存在于单个项目中，如果每个团队都要开发自己模拟接口，那么都要写一个切面")])])]),t._v(" "),s("h3",{attrs:{id:"网关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网关"}},[t._v("#")]),t._v(" 网关")]),t._v(" "),s("p",[t._v("什么是网关？理解成火车站的检票口，"),s("strong",[t._v("统一")]),t._v("去检票。")]),t._v(" "),s("h4",{attrs:{id:"网关作用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网关作用"}},[t._v("#")]),t._v(" 网关作用")]),t._v(" "),s("p",[t._v("统一去进行一些操作、处理一些问题。")]),t._v(" "),s("p",[t._v("比如：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("路由")])]),t._v(" "),s("li",[s("p",[t._v("负载均衡")])]),t._v(" "),s("li",[s("p",[t._v("统一鉴权")])]),t._v(" "),s("li",[s("p",[t._v("跨域")])]),t._v(" "),s("li",[s("p",[t._v("统一业务处理（缓存也在这里处理）")])]),t._v(" "),s("li",[s("p",[t._v("访问控制")])]),t._v(" "),s("li",[s("p",[t._v("发布控制")])]),t._v(" "),s("li",[s("p",[t._v("流量染色")])]),t._v(" "),s("li",[s("p",[t._v("接口保护")]),t._v(" "),s("p",[t._v("a. 限制请求")]),t._v(" "),s("p",[t._v("b. 信息脱敏（操作请求头，响应头）")]),t._v(" "),s("p",[t._v("c. 降级（熔断）-- 请求某个接口时不成功，提示请求其它接口，兜底效果")]),t._v(" "),s("p",[t._v("d. 限流：学习令牌桶算法、学习漏桶算法，学习一下 RedisLimitHandler")]),t._v(" "),s("p",[t._v("e. 超时时间")])]),t._v(" "),s("li",[s("p",[t._v("统一日志")])]),t._v(" "),s("li",[s("p",[t._v("统一文档")])])]),t._v(" "),s("p",[s("strong",[t._v("具体作用")])]),t._v(" "),s("h5",{attrs:{id:"路由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路由"}},[t._v("#")]),t._v(" "),s("strong",[t._v("路由")])]),t._v(" "),s("p",[t._v("起到转发的作用，比如有接口 A 和接口 B，网关会记录这些信息，根据用户访问的地址和参数，"),s("strong",[t._v("转发请求")]),t._v("到对应的接口（服务器/集群）")]),t._v(" "),s("p",[t._v("/a => 接口 A")]),t._v(" "),s("p",[t._v("/b => 接口 B")]),t._v(" "),s("p",[t._v("https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories")]),t._v(" "),s("h5",{attrs:{id:"负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[t._v("#")]),t._v(" 负载均衡")]),t._v(" "),s("p",[t._v("在路由的基础上")]),t._v(" "),s("p",[t._v("/c => 服务A/集群A（随机转发到其中的某一机器）")]),t._v(" "),s("p",[t._v("uri 从固定地址改成 Ib:xxxx")]),t._v(" "),s("h5",{attrs:{id:"统一鉴权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统一鉴权"}},[t._v("#")]),t._v(" "),s("strong",[t._v("统一鉴权")])]),t._v(" "),s("p",[t._v("判断用户是否有权限进行操作，无论访问什么接口，我都统一去判断权限，不用重复写")]),t._v(" "),s("h5",{attrs:{id:"统一处理跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统一处理跨域"}},[t._v("#")]),t._v(" 统一处理跨域")]),t._v(" "),s("p",[t._v("网关统一处理跨域，不用在每个项目里单独处理")]),t._v(" "),s("p",[t._v("https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#cors-configuration")]),t._v(" "),s("h5",{attrs:{id:"统一业务处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统一业务处理"}},[t._v("#")]),t._v(" "),s("strong",[t._v("统一业务处理")])]),t._v(" "),s("p",[t._v("把每个项目中都要做的通用逻辑放到上层（网关），统一处理，比如本项目的次数统计")]),t._v(" "),s("h5",{attrs:{id:"访问控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问控制"}},[t._v("#")]),t._v(" "),s("strong",[t._v("访问控制")])]),t._v(" "),s("p",[t._v("黑白名单，比如限制DDOS IP")]),t._v(" "),s("h5",{attrs:{id:"发布控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布控制"}},[t._v("#")]),t._v(" 发布控制")]),t._v(" "),s("p",[t._v("灰度发布，比如上线新接口，先给新接口分配 20% 的流量，老接口 80%，再慢慢调整比重。（不同人的软件最新版不一样）")]),t._v(" "),s("p",[t._v("https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-weight-route-predicate-factory")]),t._v(" "),s("h5",{attrs:{id:"流量染色"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#流量染色"}},[t._v("#")]),t._v(" 流量染色")]),t._v(" "),s("p",[t._v("给请求（流量）添加一些标识，一般是设置请求头中，添加新的请求头\nhttps://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-addrequestheader-gatewayfilter-factory")]),t._v(" "),s("p",[s("strong",[t._v("全局染色")]),t._v("：https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#default-filters")]),t._v(" "),s("h5",{attrs:{id:"统一接口保护"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统一接口保护"}},[t._v("#")]),t._v(" "),s("strong",[t._v("统一接口保护")])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("限制请求")]),t._v(" "),s("p",[t._v("https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#requestheadersiz-gatewayfilter-factory")])]),t._v(" "),s("li",[s("p",[t._v("信息脱敏")]),t._v(" "),s("p",[t._v("https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-removerequestheader-gatewayfilter-factory")])]),t._v(" "),s("li",[s("p",[t._v("降级（熔断） 进行兜底")]),t._v(" "),s("p",[t._v("https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#fallback-headers")])]),t._v(" "),s("li",[s("p",[t._v("限流")]),t._v(" "),s("p",[t._v("https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-requestratelimiter-gatewayfilter-factory")])]),t._v(" "),s("li",[s("p",[t._v("超时时间    超时就中断")]),t._v(" "),s("p",[t._v("https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#http-timeouts-configuration")])]),t._v(" "),s("li",[s("p",[t._v("重试（业务保护）：")]),t._v(" "),s("p",[t._v("https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-retry-gatewayfilter-factory")])])]),t._v(" "),s("h5",{attrs:{id:"统一日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统一日志"}},[t._v("#")]),t._v(" 统一日志")]),t._v(" "),s("p",[t._v("统一的请求，响应信息记录")]),t._v(" "),s("h5",{attrs:{id:"统一文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统一文档"}},[t._v("#")]),t._v(" 统一文档")]),t._v(" "),s("p",[t._v("将下游项目的文档进行聚合，在一个页面统一查看")]),t._v(" "),s("p",[t._v("建议用：https://doc.xiaominfo.com/docs/middleware-sources/aggregation-introduction")]),t._v(" "),s("h4",{attrs:{id:"网关的分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网关的分类"}},[t._v("#")]),t._v(" 网关的分类")]),t._v(" "),s("ul",[s("li",[t._v("**全局网关（接入层网关）**作用是负载均衡、请求日志等，不和业务逻辑绑定")]),t._v(" "),s("li",[t._v("**业务网关（微服务网关）**会有一些业务逻辑，作用是将请求转发到不同的业务/项目/接口/服务")])]),t._v(" "),s("p",[t._v("参考文章：https://blog.csdn.net/qq_21040559/article/details/122961395")]),t._v(" "),s("h4",{attrs:{id:"网关实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网关实现"}},[t._v("#")]),t._v(" "),s("strong",[t._v("网关实现")])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("Nginx")]),t._v(" （全局网关），"),s("strong",[t._v("Kong网关")]),t._v("（API网关），"),s("strong",[t._v("编程成本相对较高")])]),t._v(" "),s("li",[s("strong",[t._v("Spring Cloud Gateway")]),t._v("（取代了 Zuul ）性能高 可以用 java 代码来写逻辑  适于学习")])]),t._v(" "),s("p",[t._v("网关技术选型：https://zhuanlan.zhihu.com/p/500587132")]),t._v(" "),s("h3",{attrs:{id:"spring-cloud-gateway-用法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-gateway-用法"}},[t._v("#")]),t._v(" Spring Cloud Gateway 用法")]),t._v(" "),s("p",[t._v("全部内容基本来自官网")]),t._v(" "),s("p",[t._v("官网：https://spring.io/projects/spring-cloud-gateway")]),t._v(" "),s("p",[t._v("官方文档：https://docs.spring.io/spring-cloud-gateway/docs/current/reference//html/")]),t._v(" "),s("h4",{attrs:{id:"核心概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#核心概念"}},[t._v("#")]),t._v(" 核心概念")]),t._v(" "),s("p",[t._v("路由 "),s("strong",[t._v("Route")]),t._v("：（根据什么条件，转发请求到哪里）")]),t._v(" "),s("p",[t._v("断言 "),s("strong",[t._v("Predicate")]),t._v("：一组规则、条件，用来确定如何转发路由")]),t._v(" "),s("p",[t._v("过滤器 "),s("strong",[t._v("Filter")]),t._v("：对请求进行一系列的处理，比如添加请求头、添加请求参数")]),t._v(" "),s("p",[t._v("请求流程：")]),t._v(" "),s("ol",[s("li",[t._v("客户端发起请求")]),t._v(" "),s("li",[t._v("Handler Mapping：根据断言，去将请求转发到对应的路由")]),t._v(" "),s("li",[t._v("Web Handler：处理请求（一层层经过过滤器）")]),t._v(" "),s("li",[t._v("实际调用服务")])]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20230509171132036","data-src":"https://cmty256.github.io/imgs-blog/images/image-20230509171132036.png",loading:"lazy"}})]),t._v(" "),s("h4",{attrs:{id:"两种配置方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#两种配置方式"}},[t._v("#")]),t._v(" 两种配置方式")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("配置式（声明式，方便、规范）")]),t._v(" "),s("p",[t._v("a. 简化版")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" after_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Cookie=mycookie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mycookievalue\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[t._v("b. 全称版")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" after_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Cookie\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mycookie\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("regexp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mycookievalue\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("编程式（灵活、相对麻烦）")])])]),t._v(" "),s("h4",{attrs:{id:"建议开启日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#建议开启日志"}},[t._v("#")]),t._v(" 建议开启日志")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("logging")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("org")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("springframework")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" trace\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("h4",{attrs:{id:"断言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#断言"}},[t._v("#")]),t._v(" 断言")]),t._v(" "),s("p",[t._v("官网地址:https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories")]),t._v(" "),s("p",[t._v("目录：")]),t._v(" "),s("ol",[s("li",[t._v("After 在 xx 时间之后")]),t._v(" "),s("li",[t._v("Before 在 xx 时间之前")]),t._v(" "),s("li",[t._v("Between 在 xx 时间之间")]),t._v(" "),s("li",[t._v("请求类别")]),t._v(" "),s("li",[t._v("请求头（包含 Cookie）")]),t._v(" "),s("li",[t._v("查询参数")]),t._v(" "),s("li",[t._v("客户端地址")]),t._v(" "),s("li",[s("strong",[t._v("权重")])])]),t._v(" "),s("p",[s("strong",[t._v("The After Route Predicate Factory")])]),t._v(" "),s("p",[t._v("当前时间在这个时间"),s("strong",[t._v("之后")]),t._v("，就会访问当前这个路由")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" after_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" After=2017"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("20T17"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("42"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("47.789"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("07"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("00"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("America/Denver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[s("strong",[t._v("The Before Route Predicate Factory")])]),t._v(" "),s("p",[t._v("当前时间在这个时间"),s("strong",[t._v("之前")]),t._v("，就会访问当前这个路由")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" before_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Before=2017"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("20T17"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("42"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("47.789"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("07"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("00"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("America/Denver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[s("strong",[t._v("The Between Route Predicate Factory")])]),t._v(" "),s("p",[t._v("当前时间在这个时间"),s("strong",[t._v("之间")]),t._v("，就会访问当前这个路由")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" between_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Between=2017"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("20T17"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("42"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("47.789"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("07"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("00"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("America/Denver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 2017"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("21T17"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("42"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("47.789"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("07"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("00"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("America/Denver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[s("strong",[t._v("The Cookie Route Predicate Factory")])]),t._v(" "),s("p",[t._v("如果你的"),s("strong",[t._v("请求头cookie")]),t._v("的是"),s("strong",[t._v("chocolate")]),t._v("，它的值是"),s("strong",[t._v("ch.p")]),t._v("，就会访问当前这个路由")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cookie_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Cookie=chocolate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch.p\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[s("strong",[t._v("The Header Route Predicate Factory")])]),t._v(" "),s("p",[t._v("如果你的"),s("strong",[t._v("请求头")]),t._v("包含"),s("strong",[t._v("X-Request-Id")]),t._v("这样一个请求头，并且，它的值符合"),s("strong",[t._v("正则表达式的规则")]),t._v("，就会访问当前这个路由")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" header_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Header=X"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\d+\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[s("strong",[t._v("The Host Route Predicate Factory")])]),t._v(" "),s("p",[t._v("如果你的"),s("strong",[t._v("访问")]),t._v("的是这个**.somehost.org,**."),s("strong",[t._v("anotherhost.org")]),t._v("，"),s("strong",[t._v("域名")]),t._v("，就会访问当前这个路由")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" host_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Host="),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**.somehost.org")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**.anotherhost.org")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[s("strong",[t._v("The Method Route Predicate Factory")])]),t._v(" "),s("p",[t._v("如果你的"),s("strong",[t._v("请求类别")]),t._v("是这个"),s("strong",[t._v("GET")]),t._v("、"),s("strong",[t._v("POST")]),t._v("，就会访问当前这个路由")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" method_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Method=GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("POST\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("p",[s("strong",[t._v("The Path Route Predicate Factory")])]),t._v(" "),s("p",[t._v("如果你的"),s("strong",[t._v("访问的地址")]),t._v("是以这些**/red/{segment},/blue/{segment}**路径作为前缀，就会访问当前这个路由")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/red/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("segment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("/blue/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("segment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[s("strong",[t._v("The Query Route Predicate Factory")])]),t._v(" "),s("p",[t._v("根据"),s("strong",[t._v("查询条件")]),t._v("，比如red greet green，就会访问当前这个路由")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" query_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Query=red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" gree.\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[s("strong",[t._v("The RemoteAddr Route Predicate Factory")])]),t._v(" "),s("p",[t._v("根据"),s("strong",[t._v("远程地址")]),t._v("，比如你的用户的ip地址是192.168.1.1/24，就会访问当前这个路由")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" remoteaddr_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" RemoteAddr=192.168.1.1/24\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[s("strong",[t._v("The Weight Route Predicate Factory")])]),t._v(" "),s("p",[t._v("根据你设置的"),s("strong",[t._v("权重")]),t._v("，给你把同一个访问的地址，重定到不同的服务，轻松实现发布控制")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" weight_high\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//weighthigh.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Weight=group1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" weight_low\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//weightlow.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Weight=group1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("p",[s("strong",[t._v("The XForwarded Remote Addr Route Predicate Factory")])]),t._v(" "),s("p",[t._v("从请求头中如果拿到XForwarded这个"),s("strong",[t._v("请求头的地址")]),t._v("192.168.1.1/24 就会访问当前这个路由")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xforwarded_remoteaddr_route\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.org\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" XForwardedRemoteAddr=192.168.1.1/24\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("h4",{attrs:{id:"过滤器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#过滤器"}},[t._v("#")]),t._v(" 过滤器")]),t._v(" "),s("p",[s("strong",[t._v("官网文档")]),t._v("：https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories")]),t._v(" "),s("p",[s("strong",[t._v("基本功能")]),t._v("：对请求头、请求参数、响应头的增删改查\n1.添加清求头\n2.添加请求参数\n3.添加响应头\t\n4.降级\n5.限流\n6.重试")]),t._v(" "),s("p",[t._v("引入依赖：")]),t._v(" "),s("p",[t._v("用于集成Reactor Resilience4j断路器库，以实现微服务的容错处理和服务熔断（接口保护 -- 降级）等功能。")]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[t._v("        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-circuitbreaker-reactor-resilience4j"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[s("strong",[t._v("小作业：")])]),t._v(" "),s("p",[t._v("通过阅读源码：https://spring.io/projects/spring-cloud-gateway/#samples 来了解gateway编程式开发")]),t._v(" "),s("h2",{attrs:{id:"第五阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第五阶段"}},[t._v("#")]),t._v(" 第五阶段")]),t._v(" "),s("h3",{attrs:{id:"主要内容-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主要内容-5"}},[t._v("#")]),t._v(" 主要内容：")]),t._v(" "),s("ol",[s("li",[t._v("实现统一的接口鉴权和计费（API 网关实践）")])]),t._v(" "),s("p",[t._v("实现统一的用户鉴权 ，统一的接口调用次数统计（把API网关用到项目中）")]),t._v(" "),s("h3",{attrs:{id:"要用到的特性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#要用到的特性"}},[t._v("#")]),t._v(" "),s("strong",[t._v("要用到的特性")])]),t._v(" "),s("ol",[s("li",[t._v("路由（转发请求到模拟接口项目）")]),t._v(" "),s("li",[s("s",[t._v("负载均衡（需要用到注册中心）")])]),t._v(" "),s("li",[t._v("统一鉴权(accessKey，secretKey)")]),t._v(" "),s("li",[t._v("统一处理跨域")]),t._v(" "),s("li",[t._v("统一业务处理（每次请求接口后，接口调用次数+1）")]),t._v(" "),s("li",[t._v("访问控制（黑白名单）")]),t._v(" "),s("li",[s("s",[t._v("发布控制")])]),t._v(" "),s("li",[t._v("流量染色(记录请求是否为网关来的)")]),t._v(" "),s("li",[s("s",[t._v("统一接口保护")]),t._v(" "),s("ol",[s("li",[t._v("限制请求")]),t._v(" "),s("li",[t._v("信息脱敏")]),t._v(" "),s("li",[t._v("降级（熔断）")]),t._v(" "),s("li",[t._v("限流 学习令牌桶算法，学习露桶算法，学习一下RedislimitHandler")]),t._v(" "),s("li",[t._v("超时时间")]),t._v(" "),s("li",[t._v("重试（业务保护）")])])]),t._v(" "),s("li",[t._v("统一日志(记录每次的请求和响应)")]),t._v(" "),s("li",[s("s",[t._v("统一文档")])])]),t._v(" "),s("h3",{attrs:{id:"业务逻辑-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#业务逻辑-2"}},[t._v("#")]),t._v(" 业务逻辑")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("用户发送请求到 API 网关")]),t._v(" "),s("p",[t._v("（面试官可能会问：为什么要用 API 网关？可以联想一下上面那个画图过程）")])]),t._v(" "),s("li",[s("p",[t._v("请求日志")])]),t._v(" "),s("li",[s("p",[t._v("（黑白名单）")])]),t._v(" "),s("li",[s("p",[t._v("用户鉴权（判断 ak、sk 是否合法）")])]),t._v(" "),s("li",[s("p",[t._v("请求的模拟接口是否存在？")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("请求转发，调用模拟接口")])])]),t._v(" "),s("li",[s("p",[t._v("响应日志")])]),t._v(" "),s("li",[s("p",[t._v("调用成功，接口调用次数 + 1")])]),t._v(" "),s("li",[s("p",[t._v("调用失败，返回一个规范的错误码")])])]),t._v(" "),s("h3",{attrs:{id:"具体实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#具体实现"}},[t._v("#")]),t._v(" 具体实现")]),t._v(" "),s("h4",{attrs:{id:"_1、请求转发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、请求转发"}},[t._v("#")]),t._v(" 1、请求转发")]),t._v(" "),s("p",[t._v("使用 Path 前缀匹配断言：")]),t._v(" "),s("p",[t._v("将所有前缀为：/api/ 的请求进行转发，转发到http://localhost:8123/api")]),t._v(" "),s("p",[t._v("比如请求网关："),s("a",{attrs:{href:"http://localhost:8090/api/name/%E5%BC%A0%E4%B8%89",target:"_blank",rel:"noopener noreferrer"}},[t._v("localhost:8090/api/name/张三"),s("OutboundLink")],1),t._v("转发到 "),s("a",{attrs:{href:"http://localhost:8123/api/name/%E5%BC%A0%E4%B8%89",target:"_blank",rel:"noopener noreferrer"}},[t._v("localhost:8123/api/name/张三"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" api_route\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置转发到哪个网址")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8123")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 前缀断言")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/api/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])]),s("h4",{attrs:{id:"_2、编写业务逻辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、编写业务逻辑"}},[t._v("#")]),t._v(" 2、编写业务逻辑")]),t._v(" "),s("p",[t._v("使用了 GlobalFilter(编程式，还有一种叫配置式，上面有讲)，全局请求拦截处理（类似 AOP）")]),t._v(" "),s("p",[t._v("官网：https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#global-filters")]),t._v(" "),s("p",[t._v("因为网关项目没引入 MyBatis 等操作数据库的类库，如果该操作较为复杂，可以由 backend 增删改查项目提供接口，我们直接调用，不用重复写逻辑了。")]),t._v(" "),s("ul",[s("li",[t._v("HTTP 请求（用 HTTPClient、用 RestTemplate、Feign）")]),t._v(" "),s("li",[t._v("RPC（Dubbo）")])]),t._v(" "),s("h4",{attrs:{id:"问题-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题-2"}},[t._v("#")]),t._v(" 问题")]),t._v(" "),s("p",[t._v("预期等模拟接口调用完成，才记录响应日志、统计调用次数。")]),t._v(" "),s("p",[t._v("但现实是 chain.filter 方法立刻返回了，直到 filter 过滤器 return 后（此时已经记录了响应日志）才调用了模拟接口。")]),t._v(" "),s("p",[t._v("**原因是：**chain.filter 是个异步操作，理解为前端的 promise")]),t._v(" "),s("p",[t._v("**解决方案：**利用 response 装饰者，"),s("strong",[t._v("增强")]),t._v("原有 response 的处理能力")]),t._v(" "),s("p",[t._v("参考博客：https://blog.csdn.net/qq_19636353/article/details/126759522（以这个为主）")]),t._v(" "),s("p",[t._v("其他参考：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://blog.csdn.net/m0_67595943/article/details/124667975",target:"_blank",rel:"noopener noreferrer"}},[t._v("网关 在GlobalFilter 拿出返回数据response"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://blog.csdn.net/zx156955/article/details/121670681",target:"_blank",rel:"noopener noreferrer"}},[t._v("SpringCloud-Gateway统一处理返回参数"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://blog.csdn.net/qq_39529562/article/details/108911983",target:"_blank",rel:"noopener noreferrer"}},[t._v("对请求参数解密，返回参数加密处理_springcloud 针对全局返回报文加密"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"第六阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第六阶段"}},[t._v("#")]),t._v(" 第六阶段")]),t._v(" "),s("h3",{attrs:{id:"主要内容-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主要内容-6"}},[t._v("#")]),t._v(" 主要内容：")]),t._v(" "),s("ol",[s("li",[t._v("实现统一的接口鉴权和计费（RPC、Dubbo讲解）")])]),t._v(" "),s("h3",{attrs:{id:"网关业务逻辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网关业务逻辑"}},[t._v("#")]),t._v(" 网关业务逻辑")]),t._v(" "),s("p",[t._v("问题：网关项目比较存粹，没有操作数据库的包，并且还要调用我们之前写过的代码？复制粘贴维护麻烦\n理想：直接请求到其他项目的方法")]),t._v(" "),s("h4",{attrs:{id:"怎么调用其他项目的方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#怎么调用其他项目的方法"}},[t._v("#")]),t._v(" "),s("strong",[t._v("怎么调用其他项目的方法？")])]),t._v(" "),s("ol",[s("li",[t._v("复制代码和依赖，环境")]),t._v(" "),s("li",[t._v("HTTP请求（提供接口，供其他项目调用）")]),t._v(" "),s("li",[t._v("RPC（Remote Procedure Call）远程过程调用")]),t._v(" "),s("li",[t._v("把公共的代码打个jar包，其他项目去引用")])]),t._v(" "),s("blockquote",[s("p",[t._v("面试常问：HTTP 请求和 RPC 有什么区别")])]),t._v(" "),s("h4",{attrs:{id:"http-请求怎么调用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-请求怎么调用"}},[t._v("#")]),t._v(" "),s("strong",[t._v("HTTP 请求怎么调用？")])]),t._v(" "),s("ol",[s("li",[t._v("提供方提供一个接口（地址，请求方法，参数，返回值）")]),t._v(" "),s("li",[t._v("调用方使用 HTTP Client 之类的代码包去发送 HTTP 请求")])]),t._v(" "),s("h3",{attrs:{id:"rpc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rpc"}},[t._v("#")]),t._v(" "),s("strong",[t._v("RPC")])]),t._v(" "),s("p",[t._v("作用：像调用本地方法一样去调用远程方法")]),t._v(" "),s("p",[s("strong",[t._v("和直接 HTTP 调用的区别，RPC 优点：")])]),t._v(" "),s("ol",[s("li",[t._v("对开发者更透明,减少很多的沟通成本")]),t._v(" "),s("li",[t._v("RPC 向远程服务器发送请求时，未必使用 HTTP 协议，比如还可以使用 TCP/IP，性能更高。（内部服务更实适用）")])]),t._v(" "),s("p",[t._v("RPC 调用模型：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20230514220826747","data-src":"https://cmty256.github.io/imgs-blog/images/image-20230514220826747.png",loading:"lazy"}})]),t._v(" "),s("p",[s("strong",[t._v("注意： 这里注册中心只提供信息，并不会帮助调用，实际调用还是提供者那边")])]),t._v(" "),s("h3",{attrs:{id:"dubbo-框架-rpc-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dubbo-框架-rpc-实现"}},[t._v("#")]),t._v(" Dubbo 框架（RPC 实现）")]),t._v(" "),s("p",[t._v("其他 RPC 框架：GRPC、TRPC")]),t._v(" "),s("p",[t._v("最好的学习方式：阅读官方文档")]),t._v(" "),s("p",[t._v("https://dubbo.incubator.apache.org/zh/docs3-v2/java-sdk/quick-start/spring-boot/")]),t._v(" "),s("h4",{attrs:{id:"两种使用方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#两种使用方式"}},[t._v("#")]),t._v(" 两种使用方式")]),t._v(" "),s("ol",[s("li",[t._v("Spring Boot代码（注解+编程式）：写Java接口，服务提供者和消费者都去引用这个接口\n偏程导")]),t._v(" "),s("li",[t._v("DL(接口调用语言)：创建一个公共的接口定义文件，服务提供者和消费者读取这个文件。优点是跨语言，所有的框架都认识")])]),t._v(" "),s("p",[t._v("底层是Triple协议：\nhttps://dubbo.incubator.apache.org/zh/docs3-v2/java-sdk/concepts-and-architecture/triple/")]),t._v(" "),s("h4",{attrs:{id:"官方的示例项目学习"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#官方的示例项目学习"}},[t._v("#")]),t._v(" 官方的示例项目学习")]),t._v(" "),s("p",[t._v("zookeeper 注册中心：通过内嵌的方式运行，更方便")]),t._v(" "),s("p",[t._v("最先启动注册中心（EmbeddedZooKeeper，内嵌的注册中心），然后启动服务提供者（ProviderApplication），再启动服务消费者（ConsumerApplication）")]),t._v(" "),s("h4",{attrs:{id:"整合运用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#整合运用"}},[t._v("#")]),t._v(" 整合运用")]),t._v(" "),s("ol",[s("li",[t._v("backend项目作为"),s("strong",[t._v("服务提供者")]),t._v("，提供3个方法：\n"),s("ol",[s("li",[t._v("实际情况应该是去数据库中查是否已分配给用户")]),t._v(" "),s("li",[t._v("从数据库中查询模拟接口是否存在，以及请求方法是否匹配（还可以校验请求参数）")]),t._v(" "),s("li",[t._v("调用成功，接口调用次数+1 invokeCount")])])]),t._v(" "),s("li",[t._v("gateway项日作为"),s("strong",[t._v("服务调用者")]),t._v("，调用这3个方法")])]),t._v(" "),s("p",[t._v("zooKeeper 会有版本问题，解决起来比较麻烦")]),t._v(" "),s("p",[t._v("建议用 Nacos！")]),t._v(" "),s("p",[t._v("整合 Nacos 注册中心：https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/registry/nacos/")]),t._v(" "),s("p",[s("strong",[t._v("注意：")])]),t._v(" "),s("ol",[s("li",[t._v("服务接口类必须要在同一个包下，建议是抽象出一个公共项目（放接口、实体类等）")]),t._v(" "),s("li",[t._v("设置注解（比如启动类的 EnableDubbo、接口实现类和 Bean 引用的注解）")]),t._v(" "),s("li",[t._v("添加配置")]),t._v(" "),s("li",[t._v("服务调用项目和提供者项目尽量引入相同的依赖和配置")])]),t._v(" "),s("p",[s("strong",[t._v("添加依赖")])]),t._v(" "),s("p",[t._v("依赖从官方示例项目中复制粘贴过来的不行，要从 maven 仓库中找来相应的版本依赖")]),t._v(" "),s("p",[t._v("在 cmapi-backend、cmapi-gateway 中添加如下依赖")]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.dubbo"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("dubbo"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("3.0.9"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.alibaba.nacos"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("nacos-client"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("2.2.0"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("h2",{attrs:{id:"第七阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第七阶段"}},[t._v("#")]),t._v(" 第七阶段")]),t._v(" "),s("h3",{attrs:{id:"主要内容-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主要内容-7"}},[t._v("#")]),t._v(" 主要内容：")]),t._v(" "),s("ol",[s("li",[t._v("开发抽象公共服务")]),t._v(" "),s("li",[t._v("实现网关核心业务流程")]),t._v(" "),s("li",[t._v("开发管理员接口分析功能")]),t._v(" "),s("li",[t._v("上线分析和扩展")])]),t._v(" "),s("h3",{attrs:{id:"梳理网关业务逻辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#梳理网关业务逻辑"}},[t._v("#")]),t._v(" 梳理网关业务逻辑")]),t._v(" "),s("p",[t._v("以下操作可以复用：")]),t._v(" "),s("ol",[s("li",[t._v("去数据库中查是否已分配给用户秘钥（ak、sk 是否合法）\n"),s("ul",[s("li",[t._v("先根据 ak 判断用户是否存在，查到 secretKey")]),t._v(" "),s("li",[t._v("对比 sk 和用户传的加密后的 sk 是否一致")])])]),t._v(" "),s("li",[t._v("从数据库中查询模拟接口是否存在，以及请求方法是否匹配（还可以校验请求参数）")]),t._v(" "),s("li",[t._v("调用成功，接口调用次数+ 1 invokeCount")])]),t._v(" "),s("h3",{attrs:{id:"临时问题-如何获取接口转发服务器的地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#临时问题-如何获取接口转发服务器的地址"}},[t._v("#")]),t._v(" 临时问题：如何获取接口转发服务器的地址")]),t._v(" "),s("p",[t._v("思路：网关启动时，获取所有的接口信息，维护到内存的 hashmap 中；有请求时，根据请求的 url 路径或者其他参数（比如 host 请求头）来判断应该转发到哪台服务器、以及用于校验接口是否存在")]),t._v(" "),s("h3",{attrs:{id:"抽象公共服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#抽象公共服务"}},[t._v("#")]),t._v(" 抽象公共服务")]),t._v(" "),s("p",[t._v("项目名: cmapi-common\n目的是让方法、实体类在多个项目间复用，减少重复编写")]),t._v(" "),s("p",[t._v("服务抽取:")]),t._v(" "),s("ol",[s("li",[t._v("数据库中查是否已分配给用户秘钥 (根据 accessKey 拿到用户信息，返回用户信息，为空表示不存在)")]),t._v(" "),s("li",[t._v("从数据库中查询模拟接口是否存在(请求路径、请求方法、请求参数，返回接口信息，为空表示不存在)")]),t._v(" "),s("li",[t._v("接口调用次数 + 1invokeCount (accessKey、secretKey (标识用户)，请求接口路径")])]),t._v(" "),s("p",[t._v("步骤:")]),t._v(" "),s("ol",[s("li",[t._v("新建干净的 maven 项目，只保留必要的公共依赖")]),t._v(" "),s("li",[t._v("抽取 service 和实体类")]),t._v(" "),s("li",[t._v("install 本地 maven 包")]),t._v(" "),s("li",[t._v("让服务提供者引入 common 包，测试是否正常运行")]),t._v(" "),s("li",[t._v("让服务消费者引入 common 包")])]),t._v(" "),s("h3",{attrs:{id:"统计分析功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统计分析功能"}},[t._v("#")]),t._v(" 统计分析功能")]),t._v(" "),s("h4",{attrs:{id:"需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[t._v("#")]),t._v(" 需求")]),t._v(" "),s("p",[t._v("各接口的总调用次数占比(饼图)取调用最多的前 3 个接口，从而分析出哪些接口没有人用(降低资源、或者下线)，高频接口(增加资源、提高收费)用饼图展示。\nHs实现")]),t._v(" "),s("h5",{attrs:{id:"前端-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端-2"}},[t._v("#")]),t._v(" 前端")]),t._v(" "),s("p",[t._v("强烈推荐用现成的库!!!\n比如:")]),t._v(" "),s("ul",[s("li",[t._v("ECharts: https://echarts.apache.org/zh/index.html (推荐)")]),t._v(" "),s("li",[t._v("AntV: https://antv.vision/zh (推荐)")]),t._v(" "),s("li",[t._v("BizCharts")])]),t._v(" "),s("p",[t._v("用法贼简单!\n1.看官网\n2。找到快速入门、按文档去引入库\n3.进入示例页面\n4。找到你要的图\n5.在线调试\n6.复制代码\n7.改为真实数据")]),t._v(" "),s("p",[t._v("如果是 React 项目，用这个库: https://github.com/hustcc/echarts-for-react")]),t._v(" "),s("h5",{attrs:{id:"后端-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后端-2"}},[t._v("#")]),t._v(" 后端")]),t._v(" "),s("p",[t._v("写一个接口，得到下列示例数据:\n接口 A: 2次\n接口 B: 3次")]),t._v(" "),s("p",[t._v("步骤:\n1、SOL 查的调用数据: select interfacelnfold. sum/totalNum) as totalNum from user interface infogroup by interfacelnfold order by totalNum desc limit 3.\n2、业务层去关联查询接口信息")]),t._v(" "),s("h3",{attrs:{id:"上线计划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上线计划"}},[t._v("#")]),t._v(" 上线计划")]),t._v(" "),s("p",[t._v("前端: 参考之前用户中心或伙伴匹配系统的上线方式\n后端:")]),t._v(" "),s("ul",[s("li",[t._v("backend 项目: web 项目，部署 spring boot 的jar 包(对外的)")]),t._v(" "),s("li",[t._v("gateway 网关项目: web 项目，部署 spring boot 的jar 包 (对外的)interface 模拟接口项目: web 项目，部署 spring boot 的iar 包(建议对外暴露的)")])]),t._v(" "),s("p",[s("strong",[t._v("关键: 网络必须要连通")]),t._v("\n如果自己学习用: 单个服务器部署这三个项目就足够")]),t._v(" "),s("p",[t._v("如果你是搞大事，多个服务器建议在 "),s("strong",[t._v("同一内网")]),t._v("，内网交互会更快、且更安全")]),t._v(" "),s("h3",{attrs:{id:"扩展思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#扩展思路"}},[t._v("#")]),t._v(" 扩展思路")]),t._v(" "),s("p",[s("strong",[t._v("1. 用户可以申请更换签名")])]),t._v(" "),s("p",[s("strong",[t._v("2. 怎么让其他用户也上传接口?")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("需要提供一个机制(界面)，让用户输入自己的接口 host (服务器地址) 、接口信息，将接口信息写入数据库。可以在 interfacelnfo 表里加个 host 字段，区分服务器地址，让接口提供者更灵活地接入系统。")])]),t._v(" "),s("li",[s("p",[t._v("将接口信息写入数据库之前，要对接口进行校验(比如检查他的地址是否遵循规则，测试调用)，保证他是正常的。")])]),t._v(" "),s("li",[s("p",[t._v("将接口信息写入数据库之前遵循咱们的要求(并且使用咱们的 sdk)，")])]),t._v(" "),s("li",[s("p",[t._v("在接入时，平台需要测试调用这个接口，保证他是正常的。")])])]),t._v(" "),s("p",[s("strong",[t._v("3. 网关校验是否还有调用次数")]),t._v("\n需要考虑并发问题，防止瞬间调用超额")]),t._v(" "),s("p",[s("strong",[t._v("4. 网关优化")]),t._v("\n比如增加限流/降级保护，提高性能等。还可以考搭配 Nginx 网关使用。")]),t._v(" "),s("p",[s("strong",[t._v("5. 功能增强")]),t._v("\n可以针对不同的请求头或者接口类型来设计前端界面和表单，便于用户调用，获得更好的体验。可以参考 swagger、postman、knife4j 的页面")])])}),[],!1,null,null,null);s.default=e.exports}}]);