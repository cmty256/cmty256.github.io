(window.webpackJsonp=window.webpackJsonp||[]).push([[180],{506:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"springboot-整合-rocketmq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springboot-整合-rocketmq"}},[s._v("#")]),s._v(" SpringBoot 整合 RocketMQ")]),s._v(" "),a("p",[s._v("SpringBoot 提供了快捷操作 RocketMQ 的 "),a("code",[s._v("RocketMQTemplate")]),s._v(" 对象。")]),s._v(" "),a("h2",{attrs:{id:"_1、引入依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、引入依赖"}},[s._v("#")]),s._v(" 1、引入依赖")]),s._v(" "),a("p",[s._v("注意依赖的版本需要和 RocketMQ 的版本相同。")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.apache.rocketmq"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("rocketmq-spring-boot-starter"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2.1.1"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_2、编写配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、编写配置文件"}},[s._v("#")]),s._v(" 2、编写配置文件")]),s._v(" "),a("p",[a("code",[s._v("application.properties")]),s._v(" 版本：")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用名称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("spring.application.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("demo11-message-spring-rocketmq")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应⽤服务 WEB 访问端⼝")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("9111")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nameserver地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("rocketmq.name-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("192.168.207.129:9876")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置⽣产者组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("rocketmq.producer.group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("producer-demo-group1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("code",[s._v("application.yml")]),s._v(" 版本：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demo11"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("spring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rocketmq\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9111")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rocketmq")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nameserver地址")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.207.129"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("producer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置⽣产者组")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("group1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"_3、编写生产者发送普通消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、编写生产者发送普通消息"}},[s._v("#")]),s._v(" 3、编写生产者发送普通消息")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Slf4j")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyProducer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Resource")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RocketMQTemplate")]),s._v(" rocketMQTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 发送消息\n     *\n     * @param topic   主题\n     * @param message 消息\n     */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" topic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        rocketMQTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("convertAndSend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"_4、编写单元测试发送消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、编写单元测试发送消息"}},[s._v("#")]),s._v(" 4、编写单元测试发送消息")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Slf4j")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SpringBootTest")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyProducerTest")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Resource")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyProducer")]),s._v(" myProducer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testSendMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" topic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-boot-topic"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello rocketmq springboot message!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        myProducer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"消息发送成功！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("如果遇到报错：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("sendDefaultImpl")]),s._v(" 呼叫超时")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Caused by: org.apache.rocketmq.remoting.exception.RemotingTooMuchRequestException: sendDefaultImpl call "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v("\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DefaultMQProducerImpl.java:717"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tat org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DefaultMQProducerImpl.java:1426"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tat org.apache.rocketmq.client.producer.DefaultMQProducer.send"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DefaultMQProducer.java:370"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tat org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("RocketMQTemplate.java:688"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("原因分析：")]),s._v(" "),a("ul",[a("li",[s._v("启动 namesrv，broke 没有指定 ip 或者是没开启。")]),s._v(" "),a("li",[s._v("或者 ip 配置错误")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cmty256.github.io/picx-images-hosting/microservice/image.8z6r4cc06v.jpg",loading:"lazy"}})]),s._v(" "),a("p",[s._v("运行成功后，可视化控制台：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cmty256.github.io/picx-images-hosting/microservice/image.6pnqkuyjdc.jpg",loading:"lazy"}})]),s._v(" "),a("h2",{attrs:{id:"_5、创建消费者程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、创建消费者程序"}},[s._v("#")]),s._v(" 5、创建消费者程序")]),s._v(" "),a("p",[s._v("新建一个模块，在里面编写消费者代码（也可以在生产者模块中编写）")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("引入依赖")])]),s._v(" "),a("li",[a("p",[s._v("编写配置文件")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#（如果生产者和消费者在同一个模块，这块不用写）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用名称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("spring.application.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("my-boot-consumer-demo")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应⽤服务 WEB 访问端⼝")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("8081")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nameserver地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("rocketmq.name-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("192.168.194.134:9876")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("编写消费者类")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Slf4j")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RocketMQMessageListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("consumerGroup "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-boot-consumer-group1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("topic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-boot-topic"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyConsumer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RocketMQListener")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("onMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"收到的消息：{}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("p",[a("strong",[s._v("运行结果")]),s._v("：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cmty256.github.io/picx-images-hosting/microservice/image.83a9owv6ud.jpg",loading:"lazy"}})]),s._v(" "),a("h2",{attrs:{id:"_6、发送事务消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、发送事务消息"}},[s._v("#")]),s._v(" 6、发送事务消息")]),s._v(" "),a("p",[s._v("RocketMQ 的事务消息通过"),a("strong",[s._v("两阶段提交 + 事务状态回查机制")]),s._v("，实现了 "),a("strong",[s._v("消息和本地事务操作的强一致性")]),s._v("，是微服务架构中实现可靠消息最终一致性的重要方案。")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("在生产者类里编写方法")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 发送事务消息\n     *\n     * @param topic 主题\n     * @param msg   消息\n     * @throws InterruptedException 中断异常\n     */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessageInTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" topic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" tags "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TagA"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TagB"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TagC"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TagD"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TagE"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建一个消息对象，并通过调用withPayload()方法，向消息对象中添加了一个负载，即要发送的字符串类型的数据")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("withPayload")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// topic 和 tag 整合成一个字符串")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" destination "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" topic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('":"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" tags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" tags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 第一个destination是消息要发送的目的地topic，第二个destination是消息携带的业务数据")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionSendResult")]),s._v(" sendResult "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rocketMQTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessageInTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("destination"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" destination"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[sendMessageInTransaction]sendResult: {}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sendResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 暂停10毫秒，以模拟消息的发送和处理过程所需要的时间")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("重写事务监听器")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Slf4j")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RocketMQTransactionListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rocketMQTemplateBeanName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rocketMQTemplate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyTransactionListener")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RocketMQLocalTransactionListener")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RocketMQLocalTransactionState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("executeLocalTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" destination "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 把spring的message转换成RocketMQ的message")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("common"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("Message")]),s._v(" message1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RocketMQUtil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("convertToRocketMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringMessageConverter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                destination"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                message\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取message1上的tag对内容")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" tags "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" message1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringUtils")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("contains")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TagA"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"执行本地事务，提交事务"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 返回提交事务状态，表示允许消费者消费该消息")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RocketMQLocalTransactionState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMMIT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringUtils")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("contains")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TagB"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"执行本地事务，回滚事务"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 返回回滚事务状态，表示该消息将被删除，不允许消费")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RocketMQLocalTransactionState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLLBACK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"执行本地事务，中间状态"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 返回中间状态，表示需要回查才能确定状态")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RocketMQLocalTransactionState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UNKNOWN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 事务回查")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RocketMQLocalTransactionState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkLocalTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"_7、编写单元测试发送事务消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、编写单元测试发送事务消息"}},[s._v("#")]),s._v(" 7、编写单元测试发送事务消息")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testSendMessageInTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" topic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-boot-topic"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello rocketmq transaction springboot message"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        myProducer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessageInTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"事务消息发送成功！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("strong",[s._v("运行结果")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.071  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.c.project.mq.MyTransactionListener     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 执行本地事务，提交事务\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.074  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyProducer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendMessageInTransaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("sendResult: SendResult "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendStatus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SEND_OK, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("240E06B001C00812000000000000085645EC61064425645C4CEA0000, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("offsetMsgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("null, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("messageQueue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MessageQueue "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-boot-topic, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueOffset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.095  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.c.project.mq.MyTransactionListener     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 执行本地事务，回滚事务\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.096  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyProducer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendMessageInTransaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("sendResult: SendResult "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendStatus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SEND_OK, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("240E06B001C00812000000000000085645EC61064425645C4ECD0002, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("offsetMsgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("null, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("messageQueue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MessageQueue "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-boot-topic, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueOffset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.118  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.c.project.mq.MyTransactionListener     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 执行本地事务，中间状态\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.118  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MessageThread_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyConsumer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 收到的消息：hello rocketmq transaction springboot message\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.120  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyProducer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendMessageInTransaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("sendResult: SendResult "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendStatus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SEND_OK, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("240E06B001C00812000000000000085645EC61064425645C4EE30006, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("offsetMsgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("null, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("messageQueue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MessageQueue "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-boot-topic, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueOffset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.164  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.c.project.mq.MyTransactionListener     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 执行本地事务，中间状态\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.165  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyProducer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendMessageInTransaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("sendResult: SendResult "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendStatus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SEND_OK, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("240E06B001C00812000000000000085645EC61064425645C4EFF000A, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("offsetMsgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("null, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("messageQueue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MessageQueue "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-boot-topic, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueOffset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("103")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.180  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.c.project.mq.MyTransactionListener     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 执行本地事务，中间状态\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.181  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyProducer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendMessageInTransaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("sendResult: SendResult "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendStatus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SEND_OK, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("240E06B001C00812000000000000085645EC61064425645C4F27000F, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("offsetMsgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("null, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("messageQueue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MessageQueue "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-boot-topic, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueOffset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.203  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.c.project.mq.MyTransactionListener     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 执行本地事务，提交事务\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.204  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyProducer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendMessageInTransaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("sendResult: SendResult "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendStatus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SEND_OK, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("240E06B001C00812000000000000085645EC61064425645C4F390012, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("offsetMsgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("null, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("messageQueue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MessageQueue "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-boot-topic, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueOffset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.219  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.c.project.mq.MyTransactionListener     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 执行本地事务，回滚事务\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.220  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyProducer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendMessageInTransaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("sendResult: SendResult "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendStatus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SEND_OK, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("240E06B001C00812000000000000085645EC61064425645C4F4E0015, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("offsetMsgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("null, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("messageQueue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MessageQueue "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-boot-topic, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueOffset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("106")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.233  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MessageThread_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyConsumer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 收到的消息：hello rocketmq transaction springboot message\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.235  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.c.project.mq.MyTransactionListener     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 执行本地事务，中间状态\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.236  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyProducer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendMessageInTransaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("sendResult: SendResult "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendStatus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SEND_OK, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("240E06B001C00812000000000000085645EC61064425645C4F5E0018, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("offsetMsgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("null, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("messageQueue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MessageQueue "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-boot-topic, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueOffset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("107")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.249  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.c.project.mq.MyTransactionListener     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 执行本地事务，中间状态\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.548  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyProducer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendMessageInTransaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("sendResult: SendResult "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendStatus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SEND_OK, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("240E06B001C00812000000000000085645EC61064425645C4F6E001E, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("offsetMsgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("null, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("messageQueue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MessageQueue "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-boot-topic, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueOffset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("108")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.562  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.c.project.mq.MyTransactionListener     "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 执行本地事务，中间状态\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.563  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyProducer       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendMessageInTransaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("sendResult: SendResult "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sendStatus"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SEND_OK, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("240E06B001C00812000000000000085645EC61064425645C50A70021, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("offsetMsgId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("null, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("messageQueue")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MessageQueue "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-boot-topic, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("queueOffset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("109")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-05-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":42:51.573  INFO "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17900")]),s._v(" --- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" com.chenmeng.project.mq.MyProducerTest   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 事务消息发送成功！\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("事务消息的步骤详解：")]),s._v(" "),a("p",[s._v("步骤详解")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("发送 Half 消息（prepare 消息）")]),s._v(" "),a("ul",[a("li",[s._v("Producer 先发送一个Half 消息到 Broker，此时消费者不可见。")])])]),s._v(" "),a("li",[a("p",[s._v("执行本地事务")]),s._v(" "),a("ul",[a("li",[s._v("Producer 在发送 Half 消息后，（事务监听器）立即执行本地事务操作（如插入订单、扣款等）。")])])]),s._v(" "),a("li",[a("p",[s._v("提交事务状态")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("如果本地事务成功：调用 commitMessage() 告诉 Broker 提交该消息，消费者可见；")])]),s._v(" "),a("li",[a("p",[s._v("如果失败：调用 rollbackMessage() 告诉 Broker 丢弃该消息；")])]),s._v(" "),a("li",[a("p",[s._v("如果返回 UNKNOWN，Broker 之后会进行事务回查。")])])])]),s._v(" "),a("li",[a("p",[s._v("Broker 回查事务状态")]),s._v(" "),a("ul",[a("li",[s._v("如果长时间未收到 Commit 或 Rollback，Broker 会定时调用 Producer 的 事务状态回查方法 来确认事务最终结果。")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);