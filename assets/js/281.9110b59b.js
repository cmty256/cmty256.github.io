(window.webpackJsonp=window.webpackJsonp||[]).push([[281],{612:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"知识梳理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#知识梳理"}},[s._v("#")]),s._v(" 知识梳理")]),s._v(" "),t("h2",{attrs:{id:"基础业务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础业务"}},[s._v("#")]),s._v(" 基础业务")]),s._v(" "),t("h3",{attrs:{id:"拦截器与-aop"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拦截器与-aop"}},[s._v("#")]),s._v(" 拦截器与 AOP")]),s._v(" "),t("ul",[t("li",[s._v("拦截器只能拦截 Controller")]),s._v(" "),t("li",[s._v("而 AOP 不仅可以拦截 Controller，还可以拦截业务逻辑层")]),s._v(" "),t("li",[s._v("用途之一：打印请求参数和返回结果")])]),s._v(" "),t("h3",{attrs:{id:"数据库准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库准备"}},[s._v("#")]),s._v(" 数据库准备")]),s._v(" "),t("ul",[t("li",[s._v("MySQL 8.0")]),s._v(" "),t("li",[s._v("本地数据库 & 云数据库 二选一")])]),s._v(" "),t("blockquote",[t("p",[s._v("推荐开发和生产部署都用云数据库，本次会介绍 serverless 版数据库极大减少成本。")])]),s._v(" "),t("p",[t("strong",[s._v("重点：专库专用，忌用 root")])]),s._v(" "),t("h4",{attrs:{id:"本地数据库准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本地数据库准备"}},[s._v("#")]),s._v(" 本地数据库准备")]),s._v(" "),t("ol",[t("li",[s._v("新增数据库 train")]),s._v(" "),t("li",[s._v("新增用户 train，配置权限只能操作 train 数据库")])]),s._v(" "),t("p",[s._v("可利用【可视化工具】创建使用（Navicat, Dbeaver)，sql 预览如下：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("train"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@`localhost`")]),s._v(" IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" caching_sha2_password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Alter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Routine")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Routine")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Temporary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Tables")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("View")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Delete")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Drop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Grant")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Option")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Insert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Lock")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Tables")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("References")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Select")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("View")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Trigger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Update")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("chenmeng\\_train"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("train"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@`localhost`")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"云数据库的好处"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#云数据库的好处"}},[s._v("#")]),s._v(" 云数据库的好处")]),s._v(" "),t("ul",[t("li",[s._v("免去环境搭建，版本任选")]),s._v(" "),t("li",[s._v("方便多台电脑协作开发")]),s._v(" "),t("li",[s._v("相当于雇了一帮运维")]),s._v(" "),t("li",[t("strong",[s._v("总结：花钱买时间")])])]),s._v(" "),t("h4",{attrs:{id:"购买云数据库-rds"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#购买云数据库-rds"}},[s._v("#")]),s._v(" 购买云数据库 RDS")]),s._v(" "),t("p",[t("strong",[s._v("阿里云官方小店")]),s._v("可以买各种阿里云的产品，而且价格会比【官方】的便宜，非常适合新人。且官网购买时，没有最低配置的选择项，所以推荐在【阿里云官方小店】购买云产品。")]),s._v(" "),t("p",[t("strong",[s._v("地址：")]),t("a",{attrs:{href:"https://partner.aliyun.com/shop/1704506477397431",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://partner.aliyun.com/shop/1704506477397431"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("em",[s._v("正常购买的情况")])]),s._v(" "),t("ul",[t("li",[s._v("按年买比较划算，一年大概是四百多")])]),s._v(" "),t("p",[t("em",[s._v("学习专用，可以选择买 Serverless 版的 RDS")])]),s._v(" "),t("ul",[t("li",[s._v("按量计费，首月免费")]),s._v(" "),t("li",[s._v("关闭连接后，会暂停计费")])]),s._v(" "),t("h4",{attrs:{id:"serverless-版的-rds"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#serverless-版的-rds"}},[s._v("#")]),s._v(" Serverless 版的 RDS")]),s._v(" "),t("p",[s._v("购买 Serverless 版的 RDS")]),s._v(" "),t("ul",[t("li",[s._v("需配置白名单，设置可外网访问")]),s._v(" "),t("li",[s._v("配置专库专用")])]),s._v(" "),t("h3",{attrs:{id:"版本问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#版本问题"}},[s._v("#")]),s._v(" 版本问题")]),s._v(" "),t("p",[t("em",[s._v("为什么开发时，JDK 及各种框架都不建议用最新版本？")])]),s._v(" "),t("p",[s._v("其中一个大原因，就是怕其依赖的第三方没有配套升级，导致不兼容。这也是为什么 JDK1.8 还是主流版本，因为本身稳，第三方框架也稳。")]),s._v(" "),t("blockquote",[t("p",[s._v("springboot 3 集成的 Mybatis 框架也必须是 3.0.0 版本或以上。")])]),s._v(" "),t("h3",{attrs:{id:"mybatis-生成器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mybatis-生成器"}},[s._v("#")]),s._v(" Mybatis 生成器")]),s._v(" "),t("p",[t("em",[s._v("注意规范")])]),s._v(" "),t("ul",[t("li",[s._v("开发规范：生成器生成的 4 个文件都不能手动修改")]),s._v(" "),t("li",[s._v("自定义 SQL 需要写到自己的 mapper 里，不能放在生成的 mapper 里")]),s._v(" "),t("li",[s._v("生成器只能生成单表增删改查")])]),s._v(" "),t("h3",{attrs:{id:"自定义异常类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义异常类"}},[s._v("#")]),s._v(" 自定义异常类")]),s._v(" "),t("p",[s._v("为了区分业务异常和系统异常，需要增加自定义异常类。")]),s._v(" "),t("h3",{attrs:{id:"详解雪花算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#详解雪花算法"}},[s._v("#")]),s._v(" 详解雪花算法")]),s._v(" "),t("p",[t("strong",[s._v("12 bit - 序列号")]),s._v("：同一毫秒时间戳下，可以生成 2^12=4096 个不重复 id")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// todo")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"雪花算法问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#雪花算法问题"}},[s._v("#")]),s._v(" 雪花算法问题")]),s._v(" "),t("p",[t("em",[s._v("数据中心，机器 ID 怎么设置？")])]),s._v(" "),t("ul",[t("li",[s._v("利用 redis 自增序列")]),s._v(" "),t("li",[s._v("利用数据库，为每台机器分配 workld，保存 ip 和 workld 的关系")])]),s._v(" "),t("p",[t("em",[s._v("时钟回拨")])]),s._v(" "),t("ul",[t("li",[s._v("机器时间是 3 点，北京时间是 2 点")]),s._v(" "),t("li",[s._v("此时需要把机器时间调回 2 点，那么 2 点 ~ 3 点的 ID 会重新再生成一遍")])]),s._v(" "),t("h4",{attrs:{id:"特点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#特点"}},[s._v("#")]),s._v(" 特点")]),s._v(" "),t("p",[s._v("全局唯一，有序增长，生成效率高。")]),s._v(" "),t("h3",{attrs:{id:"短信验证码登录流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#短信验证码登录流程"}},[s._v("#")]),s._v(" 短信验证码登录流程")]),s._v(" "),t("p",[s._v("两种短信攻击方式：")]),s._v(" "),t("ol",[t("li",[s._v("同一个手机号不断发短信")]),s._v(" "),t("li",[s._v("用不同的手机号不断发短信")])]),s._v(" "),t("p",[s._v("解决办法：")]),s._v(" "),t("ul",[t("li",[s._v("获取验证码之前，使用图形验证码防止短信攻击")])]),s._v(" "),t("p",[s._v("图形验证码的制作：")]),s._v(" "),t("ul",[t("li",[s._v("应该返回图片，而不是验证码字符串")])]),s._v(" "),t("p",[s._v("提升用户体验：")]),s._v(" "),t("ul",[t("li",[s._v("第一次登录不需要输入图片验证码，")]),s._v(" "),t("li",[s._v("如果第一次输入密码校验失败，就启用【图片验证码】")])]),s._v(" "),t("h3",{attrs:{id:"单点登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单点登录"}},[s._v("#")]),s._v(" 单点登录")]),s._v(" "),t("h4",{attrs:{id:"两种单点登录实现方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#两种单点登录实现方案"}},[s._v("#")]),s._v(" 两种单点登录实现方案")]),s._v(" "),t("ol",[t("li",[s._v("redis + token\n"),t("ul",[t("li",[s._v("token 是指一个无意义的，随机的字符串")]),s._v(" "),t("li",[t("strong",[s._v("后端")]),s._v("校验用户名密码之后，生成 token 后放入 redis")]),s._v(" "),t("li",[t("strong",[s._v("前端")]),s._v("将 token 放入 header（利用 "),t("code",[s._v("store")]),s._v("）")]),s._v(" "),t("li",[s._v("其他页面请求校验时，从 header 获取 token，然后根据 token 到 redis 获取数据进行判断，有数据则登录校验成功。（主要是看 token 是否已失效）")])])]),s._v(" "),t("li",[s._v("jwt\n"),t("ul",[t("li",[s._v("jwt 生成的 token 是有意义的")]),s._v(" "),t("li",[s._v("使用工具包来校验 token")])])])]),s._v(" "),t("h4",{attrs:{id:"操作细节"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作细节"}},[s._v("#")]),s._v(" 操作细节")]),s._v(" "),t("p",[s._v("1、前端在用户登录之后保存登录信息")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 变量提交：保存登录信息, 即 token")]),s._v("\n          store"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"setMember"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("2、修改 axios 全局拦截器")]),s._v(" "),t("p",[s._v("为请求 headers 增加 token，并返回配置")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("axios"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interceptors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'请求参数：'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" _token "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" store"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("member"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("headers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("token "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"请求headers增加token:"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" _token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("error")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Promise"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"jwt-单点登录原理与存在的问题及解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jwt-单点登录原理与存在的问题及解决方案"}},[s._v("#")]),s._v(" JWT 单点登录原理与存在的问题及解决方案")]),s._v(" "),t("blockquote",[t("p",[s._v("Hutool 对 JWT 的介绍："),t("a",{attrs:{href:"https://hutool.cn/docs/#/jwt/%E6%A6%82%E8%BF%B0?id=%E7%94%B1%E6%9D%A5",target:"_blank",rel:"noopener noreferrer"}},[s._v("概述 (hutool.cn)"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("存在的问题分析：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("token 被解密")]),s._v(" "),t("ul",[t("li",[s._v("加盐值（密钥），每个项目的盐值不能一样，避免一个项目被破解，全部项目都被破解")])])]),s._v(" "),t("li",[t("p",[s._v("token 被拿到第三方使用")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("简单来说就是: 自己的产品，被别人包了一个界面，做成他们收费的产品。（比如 ChatGPT 聊天机器人，外表包装成一个小程序，实际上是利用开发者设置的 token 去官网请求信息）")])]),s._v(" "),t("li",[t("p",[s._v("没啥好办法，只能使用限流（检测流量大的情况）")])])])])]),s._v(" "),t("h3",{attrs:{id:"线程本地变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#线程本地变量"}},[s._v("#")]),s._v(" 线程本地变量")]),s._v(" "),t("p",[t("em",[s._v("方案：")])]),s._v(" "),t("ol",[t("li",[s._v("首先，利用 "),t("code",[s._v("拦截器")]),s._v(" 在接口入口处拦截请求；")]),s._v(" "),t("li",[s._v("然后，在 "),t("code",[s._v("拦截器")]),s._v(" 中获取会员信息，并放到 "),t("code",[s._v("线程本地变量")]),s._v("；")]),s._v(" "),t("li",[s._v("最后，就可以在 controller、service 直接"),t("strong",[s._v("从线程本地变量获取会员信息")]),s._v("来使用了。")])]),s._v(" "),t("p",[t("em",[s._v("其他方案：")])]),s._v(" "),t("ul",[t("li",[s._v("可以在 controller 入口通过 "),t("code",[s._v("request")]),s._v(" 获得 header，进而获得 token 及会员信息")]),s._v(" "),t("li",[s._v("但这种方案实现起来比较麻烦，需要引入使用 "),t("code",[s._v("request")])])]),s._v(" "),t("h3",{attrs:{id:"批量生成功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#批量生成功能"}},[s._v("#")]),s._v(" 批量生成功能")]),s._v(" "),t("p",[t("strong",[s._v("批量生成")]),s._v("的功能一定要考虑几个问题:")]),s._v(" "),t("ul",[t("li",[s._v("能不能支持重复生成？")]),s._v(" "),t("li",[s._v("事务")])]),s._v(" "),t("p",[s._v("重复生成的两种做法")]),s._v(" "),t("ol",[t("li",[s._v("存在就跳过")]),s._v(" "),t("li",[s._v("先删除已有数据再插入（此项目用这个）")])]),s._v(" "),t("h3",{attrs:{id:"定时调度"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定时调度"}},[s._v("#")]),s._v(" 定时调度")]),s._v(" "),t("h4",{attrs:{id:"为什么需要定时调度"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要定时调度"}},[s._v("#")]),s._v(" 为什么需要定时调度？")]),s._v(" "),t("p",[s._v("定时调度在企业级系统中非常重要，比如以下几个场景：")]),s._v(" "),t("ul",[t("li",[s._v("统计报表")]),s._v(" "),t("li",[s._v("功能补偿")]),s._v(" "),t("li",[s._v("不紧急的大批量任务")])]),s._v(" "),t("h4",{attrs:{id:"定时任务三大要素"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定时任务三大要素"}},[s._v("#")]),s._v(" 定时任务三大要素")]),s._v(" "),t("ol",[t("li",[s._v("执行的内容: 功能逻辑")]),s._v(" "),t("li",[s._v("执行的策略: "),t("code",[s._v("cron")]),s._v(" 表达式（从左到右，用空格隔开: 秒 分 小时 月份中的日期 月份 星期中的日期 年份 -- 7）")]),s._v(" "),t("li",[s._v("开关: 开启定时任务")])]),s._v(" "),t("h4",{attrs:{id:"实现方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现方案"}},[s._v("#")]),s._v(" 实现方案")]),s._v(" "),t("blockquote",[t("p",[s._v("SpringBoot 自带的定时任务和 quartz 的不同")])]),s._v(" "),t("h5",{attrs:{id:"springboot-自带的定时任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#springboot-自带的定时任务"}},[s._v("#")]),s._v(" SpringBoot 自带的定时任务")]),s._v(" "),t("ul",[t("li",[s._v("适合小项目，快速实现定时任务")]),s._v(" "),t("li",[s._v("需要开启定时任务注解 "),t("code",[s._v("@EnableScheduling")])]),s._v(" "),t("li",[s._v("适合单体应用，不适合集群（"),t("strong",[s._v("增加分布式锁，可解决集群问题")]),s._v("）")]),s._v(" "),t("li",[s._v("无法实时更改定时任务状态和策略")])]),s._v(" "),t("h5",{attrs:{id:"quartz"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#quartz"}},[s._v("#")]),s._v(" quartz")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("可并发执行")])]),s._v(" "),t("li",[t("p",[s._v("可加注解禁止并发执行："),t("code",[s._v("@DisallowConcurrentExecution")])])]),s._v(" "),t("li",[t("p",[s._v("多节点场景下会"),t("strong",[s._v("轮询")]),s._v("执行定时任务")])])]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("并发执行")]),s._v("：上一周期还没执行完，下一周期又开始了")])]),s._v(" "),t("h3",{attrs:{id:"时间字段问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#时间字段问题"}},[s._v("#")]),s._v(" 时间字段问题")]),s._v(" "),t("p",[s._v("两个注解："),t("code",[s._v("@DateTimeFormat")]),s._v(" 和 "),t("code",[s._v("@JsonFormat")])]),s._v(" "),t("p",[s._v("注意：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("GET")]),s._v(" 请求中，请求体的时间字段不能用 "),t("code",[s._v("@JsonFormat")]),s._v("，需要使用 "),t("code",[s._v("@DateTimeFormat")])]),s._v(" "),t("li",[s._v("GET 请求的日期是"),t("strong",[s._v("拼接在 URL 里的")]),s._v("，需要用 spring 自带的 "),t("code",[s._v('@DateTimeFormat(pattern="yyyy-MM-dd")')]),s._v("，后端才能"),t("strong",[s._v("接收")]),s._v("到参数。")])]),s._v(" "),t("h3",{attrs:{id:"视图和存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#视图和存储过程"}},[s._v("#")]),s._v(" 视图和存储过程")]),s._v(" "),t("p",[s._v("视图和存储过程：在以前的项目中，经常用到，"),t("strong",[s._v("因为依数据库内部的算力，就可以帮我们做很多复杂的功能，但因为会占用较多的数据库资源")]),s._v("，所以逐渐淘汰了，服务端资源不够可以加机器，数据库就不好加了，所以数据库资源很珍贵，这也是"),t("strong",[s._v("为什么会有数据缓存")]),s._v("。")]),s._v(" "),t("p",[s._v("视图依赖于计算，存储过程不好维护！！！")]),s._v(" "),t("h3",{attrs:{id:"超卖问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#超卖问题"}},[s._v("#")]),s._v(" 超卖问题")]),s._v(" "),t("p",[t("strong",[s._v("需配合 Jmeter 压力测试")])]),s._v(" "),t("h4",{attrs:{id:"_1、关键字-synchronized"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、关键字-synchronized"}},[s._v("#")]),s._v(" 1、关键字 synchronized")]),s._v(" "),t("p",[s._v("直接用关键字 "),t("code",[s._v("synchronized")]),s._v(" 给方法体加锁，会有两个问题：")]),s._v(" "),t("ol",[t("li",[s._v("锁的粗粒度太大，会导致售卖效率不高(可以容忍);")]),s._v(" "),t("li",[s._v("在"),t("strong",[s._v("多节点")]),s._v("（多台服务器）的情况下，还是会出现【超卖】(不能容忍)")])]),s._v(" "),t("blockquote",[t("p",[s._v("可以用 Mysql 数据库来加锁，但是"),t("strong",[s._v("性能不高")]),s._v("。")])]),s._v(" "),t("h4",{attrs:{id:"_2、redis-实现分布式锁"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、redis-实现分布式锁"}},[s._v("#")]),s._v(" 2、redis 实现分布式锁")]),s._v(" "),t("p",[s._v("使用类型："),t("code",[s._v("String")]),s._v(" 类型")]),s._v(" "),t("p",[t("code",[s._v("setIfAbsent")]),s._v(" 就是对应 redis 的 "),t("code",[s._v("setnx")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取分布式锁")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" lockKey "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisKeyPreEnum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CONFIRM_ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DateUtil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("formatDate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dto"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getDate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" dto"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTrainCode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// setIfAbsent就是对应redis的setnx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Boolean")]),s._v(" setIfAbsent "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redisTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setIfAbsent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lockKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" lockKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("分布式锁常见的问题：")])]),s._v(" "),t("p",[s._v("（1）"),t("em",[s._v("没拿到锁的线程把别人的锁给删了。")])]),s._v(" "),t("blockquote",[t("p",[s._v("如果加锁的动作放在 "),t("code",[s._v("try")]),s._v(" 里，释放锁的操作放在 "),t("code",[s._v("finally")]),s._v("，并且用户没拿到锁之后抛出异常，"),t("code",[s._v("finally")]),s._v(" 里面依旧释放锁，就会到导致 "),t("em",[s._v("没拿到锁的线程把别人的锁给删了")]),s._v(" 的问题。")])]),s._v(" "),t("p",[s._v("把释放锁移出 "),t("code",[s._v("finally")]),s._v(" 不是最优解，解法有以下两种")]),s._v(" "),t("ol",[t("li",[s._v("加锁的动作不要放在 "),t("code",[s._v("try")]),s._v(" 里")]),s._v(" "),t("li",[s._v("加锁时，将当前线程 ID 放到锁对应的 "),t("code",[s._v("value")]),s._v(" 中，删除时，先去获取 "),t("code",[s._v("value")]),s._v("，比对 "),t("code",[s._v("value")]),s._v(" 值和当前线程 ID 一致才能删除")])]),s._v(" "),t("p",[s._v("（2）"),t("em",[s._v("过期时间短导致锁失效，两个线程一起执行任务，最后超卖")])]),s._v(" "),t("blockquote",[t("p",[s._v("解决方案有：“"),t("strong",[s._v("看门狗")]),s._v("”")]),s._v(" "),t("p",[s._v("假设过期时间为 60 秒，当倒计时到 30 秒的时候，自动刷新过期时间，所以永远不会出现"),t("strong",[s._v("超时问题")]),s._v("。")]),s._v(" "),t("p",[t("em",[s._v("如果主线程出现异常，锁的过期时间会一直刷新吗？")])]),s._v(" "),t("p",[s._v("不会。这是使用"),t("strong",[s._v("守护线程")]),s._v("的好处。")]),s._v(" "),t("p",[s._v("使用守护线程的好处是：会随主线程的结束而结束，所以不会出现一直重置成 60 秒，永不过期的问题。")]),s._v(" "),t("p",[s._v("使用守护线程的方式不需要手写，可以集成 "),t("code",[s._v("Redisson")]),s._v("。")])]),s._v(" "),t("h4",{attrs:{id:"_3、使用-redisson-看门狗解决锁超时的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、使用-redisson-看门狗解决锁超时的问题"}},[s._v("#")]),s._v(" 3、使用 Redisson 看门狗解决锁超时的问题")]),s._v(" "),t("p",[t("code",[s._v("Redisson")]),s._v(" 可以实现分布式锁，并且自带 “"),t("strong",[s._v("看门狗")]),s._v("” 方案。（项目中比较常用）")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cmty256.github.io/picx-images-hosting/project/image.1lboqnplms.png",loading:"lazy"}})]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cmty256.github.io/picx-images-hosting/project/image.esdi231ik.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("（3）"),t("em",[s._v("使用 Redisson 解决了【超时】的问题，但是会有【redis宕机】的问题。")])]),s._v(" "),t("blockquote",[t("p",[s._v("在 redis 集群中，"),t("strong",[s._v("redis 宕机")]),s._v(" 会导致锁互斥失效的问题。")]),s._v(" "),t("p",[s._v("比如，线程 a 拿到了锁，然后执行任务。突然 redis 宕机了，然后 redis 集群重新选出了主节点，线程 b 此时发起请求拿到了锁，这就导致了"),t("strong",[s._v("锁互斥失效")]),s._v("的问题。")])]),s._v(" "),t("p",[s._v("解决方案：使用 "),t("strong",[s._v("redis 红锁")]),s._v("（实际项目中不常用）")]),s._v(" "),t("p",[s._v("红锁的获取方式是：")]),s._v(" "),t("ul",[t("li",[s._v("假设现在有 5 台机器，那么线程 1 需要获取 ceil(5/2) = 3 把锁才算获取锁成功。这样就即使有某台 redis 宕机了，其他线程也获取不了锁了，从而解决 "),t("strong",[s._v("redis 宕机")]),s._v("问题。")]),s._v(" "),t("li",[s._v("获取的时候还需按顺序获取，以避免造成"),t("strong",[s._v("死锁")]),s._v("问题。")]),s._v(" "),t("li",[s._v("锁宕机之后，机器不能马上重启。假设超时时间为 5s 钟，则重启时间至少也为 5s 钟，获取锁的时间也不能超过 5s 钟。")])]),s._v(" "),t("blockquote",[t("p",[s._v("**当锁宕机后，机器不能马上重启或者切换主备。**这是因为锁可能处于一种不确定的状态，如果机器在锁未释放的情况下重启，可能会导致数据不一致或其他问题。")]),s._v(" "),t("p",[s._v("假设超时时间为 5s 钟，则重启时间至少也为 5s 钟，这是为了"),t("strong",[s._v("确保在重启之前，锁有足够的时间超时释放")]),s._v("。如果重启时间太短，可能会导致锁在机器重启后仍然被占用，从而导致其他线程无法获取锁。")]),s._v(" "),t("p",[s._v("获取锁的时间也不能超过 5s 钟，这是为了"),t("strong",[s._v("避免线程在获取锁时出现长时间的阻塞")]),s._v("。如果获取锁的时间太长，可能会导致其他线程长时间等待，从而影响系统的性能和响应时间。")])]),s._v(" "),t("p",[s._v("可阅读："),t("a",{attrs:{href:"https://cmty256.github.io/pages/54616e/#redis-%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E9%9B%86%E7%BE%A4%E6%83%85%E5%86%B5%E4%B8%8B%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7",target:"_blank",rel:"noopener noreferrer"}},[s._v("如何解决集群情况下分布式锁的可靠性 | cmty256.github.io"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("（4）"),t("em",[s._v("使用红锁，可能会带来以下问题：")])]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("性能问题")]),s._v("：红锁需要在多个 Redis 节点上进行通信和协调，这可能会导致性能下降，特别是在高并发环境下。")]),s._v(" "),t("li",[s._v("复杂性增加：红锁的实现相对复杂，需要处理多个节点之间的通信、故障检测和恢复等问题，增加了系统的复杂性。")]),s._v(" "),t("li",[s._v("数据不一致性：在分布式环境中，由于网络延迟、节点故障等原因，可能会导致锁的获取和释放出现不一致的情况，从而影响系统的正确性。")]),s._v(" "),t("li",[t("strong",[s._v("单点故障")]),s._v("：如果 Redis 节点出现故障，可能会导致整个分布式锁系统不可用，从而影响系统的可用性。")]),s._v(" "),t("li",[s._v("成本问题：使用 Redis 分布式锁需要额外的 Redis 节点和网络资源，增加了系统的成本。")])]),s._v(" "),t("h3",{attrs:{id:"机器人刷票问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#机器人刷票问题"}},[s._v("#")]),s._v(" 机器人刷票问题")]),s._v(" "),t("p",[s._v("使用 "),t("strong",[s._v("令牌大闸")]),s._v(" 防止机器人抢票")]),s._v(" "),t("ul",[t("li",[s._v("分布式锁和限流都不能解决机器人刷票的问题，1000 个请求抢票，900 个限流快速失败，另外 100 个有可能是同一个人在刷库")]),s._v(" "),t("li",[s._v("没有余票时，需要查库存才能知道没票，会影响性能，不如查令牌余量来得快®")])]),s._v(" "),t("h2",{attrs:{id:"mq-的使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mq-的使用"}},[s._v("#")]),s._v(" MQ 的使用")]),s._v(" "),t("p",[s._v("项目中的用途：")]),s._v(" "),t("ul",[t("li",[s._v("使用 MQ，将购票流程一分为二")]),s._v(" "),t("li",[s._v("增加排队购票功能")])]),s._v(" "),t("blockquote",[t("p",[s._v("踩坑小记")])]),s._v(" "),t("p",[s._v("实现 RocketMQ 发送，")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("spring.factories 功能在 Spring Boot 3 会被移除（即使依赖包内的自动配置失效），需要手动引入配置\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("解决方案：")]),s._v(" "),t("p",[s._v("1、resources 下 创建目录文件")]),s._v(" "),t("p",[t("code",[s._v("META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports")])]),s._v(" "),t("p",[s._v("2、文件内容填写")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("org.apache.rocketmq.spring.autoconfigure.RocketMQAutoConfiguration\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("非必要的时候，可以通过开启 SpringBoot 异步注解（"),t("code",[s._v("Async")]),s._v("）来异步执行方法。")])]),s._v(" "),t("h2",{attrs:{id:"事务问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事务问题"}},[s._v("#")]),s._v(" 事务问题")]),s._v(" "),t("ol",[t("li",[s._v("尽量做短事务，不要做常事务，否则会大量占用 数据库资源")]),s._v(" "),t("li",[s._v("本类方法间的调用，事务不生效")])]),s._v(" "),t("h2",{attrs:{id:"微服务组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#微服务组件"}},[s._v("#")]),s._v(" 微服务组件")]),s._v(" "),t("h3",{attrs:{id:"网关模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#网关模块"}},[s._v("#")]),s._v(" 网关模块")]),s._v(" "),t("h4",{attrs:{id:"依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖"}},[s._v("#")]),s._v(" 依赖")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[s._v("        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.cloud"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-starter-gateway"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("注意：")]),s._v(" "),t("ul",[t("li",[s._v("gateway 只有一个依赖，不能引入 common，也不能入 starter-web")]),s._v(" "),t("li",[s._v("网关是基于 netty 的，所以不需要引入 starter-web")])]),s._v(" "),t("h4",{attrs:{id:"配置路由转发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置路由转发"}},[s._v("#")]),s._v(" 配置路由转发")]),s._v(" "),t("p",[t("strong",[s._v("生产发布时，只有 gateway 需要配置【外网IP】，其它模块都只开放【内网】访问，【外网】访问不了，保证应用安全。")])]),s._v(" "),t("h4",{attrs:{id:"输出请求日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#输出请求日志"}},[s._v("#")]),s._v(" 输出请求日志")]),s._v(" "),t("p",[s._v("要输出请求日志需要增加"),t("strong",[s._v("启动参数")]),s._v("（VM选项）：")]),s._v(" "),t("blockquote",[t("p",[s._v("-Dreactor.netty.http.server.accessLogEnabled=true")])]),s._v(" "),t("p",[s._v("日志输出：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":07.087 INFO  r.netty.http.server.AccessLog :279  reactor-http-nio-2                    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 - - "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03/12月/2023:21:15:06 +0800"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /member/hello HTTP/1.1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("243")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"fegin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fegin"}},[s._v("#")]),s._v(" Fegin")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Feign")]),s._v(" 是 Netflix 公司开发的一个"),t("strong",[s._v("声明式的 REST 调用客户端")]),s._v("，SpringCloud 的早期，就是将各种第三方组件，整合到 SpringBoot 项日里，形成了 SpringCloud，现在慢慢的把第三方组件替换成自研的组件，比如 gateway 组件")]),s._v(" "),t("li",[t("code",[s._v("OpenFeign")]),s._v(" 是在 Feign 的基础上，增加 SpringMVC 注解，让代码写起来像在写 Controller")])]),s._v(" "),t("blockquote",[t("p",[s._v("使用 "),t("code",[s._v("spring.application.name")]),s._v(" 可以给各应用起一个名字，方便应用之间互相认识，在"),t("strong",[s._v("注册中心、配置中心、路由、服务调用、限流")]),s._v("等微服务组件中，都会用到。")])]),s._v(" "),t("h3",{attrs:{id:"注册中心与配置中心"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注册中心与配置中心"}},[s._v("#")]),s._v(" 注册中心与配置中心")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("注册中心")]),s._v("和"),t("strong",[s._v("配置中心")]),s._v("可以用不同的组件")])]),s._v(" "),t("ol",[t("li",[s._v("注册中心：通讯录，让应用之间相互认识\n"),t("ul",[t("li",[s._v("健康检查（可以主动的让某一节点下线，常用于发布前下线）")]),s._v(" "),t("li",[s._v("路由转发（gateway 也可以根据 ip 进行路由转发，但是后期为了控制成本，会对机器做动态扩容，此时 ip 就不固定了）")]),s._v(" "),t("li",[s._v("远程调用（按名字调用）")])])]),s._v(" "),t("li",[s._v("配置中心：动态修改线上配置\n"),t("ul",[t("li",[s._v("开关")]),s._v(" "),t("li",[s._v("域值")]),s._v(" "),t("li",[s._v("枚举项")])])])]),s._v(" "),t("p",[s._v("一般 "),t("code",[s._v("application.yml")]),s._v(" 用来放 SpringBoot 的配置；"),t("code",[s._v("bootstrap.yml")]),s._v(" 用来放 SpringCloud 的配置。")]),s._v(" "),t("p",[t("strong",[s._v("命名空间")]),s._v(" -- 可用作项目隔离")]),s._v(" "),t("p",[t("strong",[s._v("集群")]),s._v(" -- 平时生产发布时，可以对某一节点做下线处理，再重新部署；按应用名（注册中心名）来做负载均衡路由转发(相同应用名，会轮询访问)")]),s._v(" "),t("p",[s._v("即使 nacos 挂掉，网关一样能够根据应用名进行路由转发")]),s._v(" "),t("h3",{attrs:{id:"seata-分布式事务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#seata-分布式事务"}},[s._v("#")]),s._v(" Seata 分布式事务")]),s._v(" "),t("blockquote",[t("p",[s._v("官网首页："),t("a",{attrs:{href:"https://seata.apache.org/zh-cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Apache Seata"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://spring-cloud-alibaba-group.github.io/zh-cn/docs/2022.0.0.0-RC2/user-guide/seata/quick-start/",target:"_blank",rel:"noopener noreferrer"}},[s._v("快速开始 | Spring Cloud Alibaba (spring-cloud-alibaba-group.github.io)"),t("OutboundLink")],1)])]),s._v(" "),t("h4",{attrs:{id:"四种模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四种模式"}},[s._v("#")]),s._v(" 四种模式")]),s._v(" "),t("ol",[t("li",[s._v("AT 模式，默认，简单，需要增加 undo_log 表，生成反向 SQL，性能高\n"),t("ul",[t("li",[s._v("回滚后，原来没数据的，现在还是没数据")])])]),s._v(" "),t("li",[s._v("TCC 模式，try、confirm/cancel，三个阶段的代码都得自己实现，Seata 只负责调度\n"),t("ul",[t("li",[s._v("对业务代码侵入性较强，必要时可能还要修改数据库")])])]),s._v(" "),t("li",[s._v("SAGA 模式，长事务解决方案，需要程序员自己编写两阶段代码(AT 模式不需要写第二阶段)\n"),t("ul",[t("li",[s._v("基于状态机来实现的，需要一个 JSON 文件，可异步执行")])])]),s._v(" "),t("li",[s._v("XA 模式，XA 协议是由 X/Open 组织提出的分布式事务处理规范，基于数据库的 XA 协议来实现 2PC 又称为 XA 方案，适用于"),t("strong",[s._v("强一致性的场景")]),s._v("，比如金融、银行等\n"),t("ul",[t("li",[s._v("需要数据库本身支持XA协议，可以跨数据库")])])])]),s._v(" "),t("h4",{attrs:{id:"at-模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#at-模式"}},[s._v("#")]),s._v(" AT 模式")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("seata 的 AT 模式会"),t("strong",[s._v("自动生成反向 sql")]),s._v("，且没有反引号 "),t("code",[s._v("``")]),s._v("，所以要求"),t("strong",[s._v("表里不能有关键字")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("AT 模式会有个"),t("strong",[s._v("全局锁")]),s._v("，用于"),t("strong",[s._v("防止脏读")]),s._v("，线程 1 的事务修改了库存，但还没提交事务，线程 2 读库存时，读的还是原来的库存。")])])]),s._v(" "),t("h3",{attrs:{id:"sentinel-降级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sentinel-降级"}},[s._v("#")]),s._v(" Sentinel 降级")]),s._v(" "),t("ul",[t("li",[s._v("Sentinel 限流降级")]),s._v(" "),t("li",[s._v("Sentinel 熔断降级")])]),s._v(" "),t("blockquote",[t("p",[s._v("一句话理解："),t("strong",[s._v("限流")]),s._v("是做在被调用方，"),t("strong",[s._v("熔断")]),s._v("是做在调用方")]),s._v(" "),t("p",[s._v("官方文档："),t("a",{attrs:{href:"https://sentinelguard.io/zh-cn/docs/introduction.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("introduction | Sentinel (sentinelguard.io)"),t("OutboundLink")],1)])]),s._v(" "),t("h4",{attrs:{id:"常见的限流算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见的限流算法"}},[s._v("#")]),s._v(" 常见的限流算法")]),s._v(" "),t("ol",[t("li",[s._v("静态窗口限流")]),s._v(" "),t("li",[s._v("动态窗口限流")]),s._v(" "),t("li",[s._v("漏桶限流")]),s._v(" "),t("li",[s._v("令牌桶限流")]),s._v(" "),t("li",[s._v("令牌大闸")])]),s._v(" "),t("blockquote",[t("p",[s._v("例如: 当前是第 2.5 秒")]),s._v(" "),t("p",[s._v("静态: 统计第 2 秒到现在的请求数")]),s._v(" "),t("p",[s._v("动态: 统计第 1.5 秒到现在的请求数")])]),s._v(" "),t("h4",{attrs:{id:"流控效果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#流控效果"}},[s._v("#")]),s._v(" 流控效果")]),s._v(" "),t("ol",[t("li",[s._v("快速失败\n"),t("ul",[t("li",[s._v("即降级")])])]),s._v(" "),t("li",[s._v("Warm Up（预热）\n"),t("ul",[t("li",[s._v("coldFactor 为 3，即请求 QPS 从(阈值/3)开始，*经多少预热时长才逐渐升至设定的QPS阈值？*比如阈值是 100，时长是 10 秒，则从 33 开始经过 10 秒上升到 100。")])])]),s._v(" "),t("li",[s._v("排队等待\n"),t("ul",[t("li",[s._v("适合短时高峰，可加个超时时间，慢慢消费掉请求")])])])]),s._v(" "),t("h4",{attrs:{id:"流控模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#流控模式"}},[s._v("#")]),s._v(" 流控模式")]),s._v(" "),t("ol",[t("li",[s._v("直接")]),s._v(" "),t("li",[s._v("关联\n"),t("ul",[t("li",[s._v("对目标的限流是有条件的，需要关联的资源限流时，目标才会限流")]),s._v(" "),t("li",[s._v("两个关联的资源必须同时启动才能生效")])])]),s._v(" "),t("li",[s._v("链路")])]),s._v(" "),t("blockquote",[t("p",[s._v("配置"),t("code",[s._v("入口资源")]),s._v("的时候，需要在资源名称前面加个 "),t("code",[s._v("/")])])]),s._v(" "),t("h3",{attrs:{id:"spring-cloud-alibaba"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-alibaba"}},[s._v("#")]),s._v(" spring cloud alibaba")]),s._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://github.com/alibaba/spring-cloud-alibaba?tab=readme-ov-file",target:"_blank",rel:"noopener noreferrer"}},[s._v("alibaba/spring-cloud-alibaba：Spring Cloud Alibaba为阿里巴巴中间件的分布式解决方案提供一站式应用开发解决方案。 (github.com)"),t("OutboundLink")],1)])]),s._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://sca.aliyun.com/zh-cn/docs/2022.0.0.0/best-practice/spring-boot-to-spring-cloud",target:"_blank",rel:"noopener noreferrer"}},[s._v("Spring Boot 单体应用升级 Spring Cloud 微服务最佳实践 | Spring Cloud Alibaba (aliyun.com)"),t("OutboundLink")],1)])])]),s._v(" "),t("h2",{attrs:{id:"常见的缓存有哪些"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见的缓存有哪些"}},[s._v("#")]),s._v(" 常见的缓存有哪些？")]),s._v(" "),t("ol",[t("li",[s._v("Mybatis 的一级缓存和二级缓存")]),s._v(" "),t("li",[s._v("本地缓存")]),s._v(" "),t("li",[s._v("分布式缓存（redis）")]),s._v(" "),t("li",[s._v("前端 h5 的 sessionStorage（会话缓存）")]),s._v(" "),t("li",[s._v("前端 h5 发 localStorage")])]),s._v(" "),t("p",[t("strong",[s._v("非常适合【读多写少】的场景。")])]),s._v(" "),t("h3",{attrs:{id:"详解-mybatis-的一级缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#详解-mybatis-的一级缓存"}},[s._v("#")]),s._v(" 详解 Mybatis 的一级缓存")]),s._v(" "),t("p",[s._v("在当前会话中自动使用。一级缓存可以帮助我们减少重复的数据库查询。")]),s._v(" "),t("p",[t("strong",[s._v("示例一：会执行两条 SQL 语句")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrainQueryVO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Train")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" trainList "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LOG")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"再查一次"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        trainList "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BeanUtil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("copyToList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trainList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrainQueryVO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Train")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrainExample")]),s._v(" trainExample "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrainExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        trainExample"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderByClause")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code asc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" trainMapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectByExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trainExample"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[t("strong",[s._v("示例二：只会执行一次 SQL 语句，也就是第一个 selectAll() 方法")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Transactional")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rollbackFor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrainQueryVO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Train")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" trainList "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LOG")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"再查一次"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        trainList "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BeanUtil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("copyToList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trainList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrainQueryVO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Train")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrainExample")]),s._v(" trainExample "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrainExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        trainExample"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderByClause")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code asc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" trainMapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectByExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trainExample"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[t("strong",[s._v("如何关闭一级缓存？")])]),s._v(" "),t("p",[s._v("在配置文件中修改 Mybatis 缓存策略，有两个选项：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("statement")]),s._v(" -- SQL 级别，每执行一条 SQL 语句都会清除缓存")]),s._v(" "),t("li",[t("code",[s._v("session")]),s._v(" -- 会话级别，关闭会话时才会清除缓存")])]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mybatis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configuration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("local-cache-scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" statement\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"详解-mybatis-的二级缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#详解-mybatis-的二级缓存"}},[s._v("#")]),s._v(" 详解 Mybatis 的二级缓存")]),s._v(" "),t("ol",[t("li",[s._v("默认没有开启，开启条件为对应的实体类需要实现序列化，并且在 mapper.xml 下添加 "),t("code",[s._v("<cache></cache>")]),s._v(" 标签\n"),t("ul",[t("li",[s._v("当一个类需要保存起来，下次再还原成类时就需要序列化，或者需要远程传输，比如放到 redis 里，也需要序列化")]),s._v(" "),t("li",[s._v("在【命名空间 "),t("code",[s._v("namespace")]),s._v("】内添加缓存标签")])])]),s._v(" "),t("li",[s._v("每一个 mapper 的二级缓存都是不一样的")])]),s._v(" "),t("p",[t("strong",[s._v("什么时候二级缓存会失效？")])]),s._v(" "),t("p",[s._v("对同个 namespace 做增删改操作时，二级缓存就会清空。")]),s._v(" "),t("p",[t("strong",[s._v("缺点")])]),s._v(" "),t("p",[s._v("在实际项目中很少会使用二级缓存。")]),s._v(" "),t("p",[s._v("假设现在有【两个节点】，同时执行了一条一样的查询操作，并缓存了起来，第一个节点接着执行了删除操作，那么下一次再执行这个查询操作的时候，第一个节点就会从数据库中重新查询，而第二个节点则是直接使用二级缓存，这就导致了两个节点查询出来的【数据可能不一致】。")]),s._v(" "),t("h3",{attrs:{id:"springboot-的内置缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#springboot-的内置缓存"}},[s._v("#")]),s._v(" SpringBoot 的内置缓存")]),s._v(" "),t("p",[t("strong",[s._v("1、添加依赖")])]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--spring内置缓存--\x3e")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-cache"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("strong",[s._v("2、开启使用缓存")])]),s._v(" "),t("p",[s._v("启动类中，添加 "),t("code",[s._v("@EnableCaching")]),s._v(" 注解")]),s._v(" "),t("p",[t("strong",[s._v("作用")]),s._v("：本地缓存可以解决 mybatis 二级缓存需要修改 mapper 的问题，但同样存在多个节点缓存不一样的问题（数据不一致）。")]),s._v(" "),t("p",[t("strong",[s._v("使用小记：")])]),s._v(" "),t("p",[t("em",[s._v("1、使用缓存注解")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// value 可自定义")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Cacheable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"业务类名.方法名"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("解释：")]),s._v(" "),t("p",[s._v("开辟一块空间，根据不同的请求参数，空间内会缓存多个结果。会根据请求参数生成一个 key，需要对请求参数生成 hashCode 和 equals 方法，用于生成 key。")]),s._v(" "),t("p",[t("em",[s._v("2、缓存刷新注解")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@CachePut")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"业务类名.方法名"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("解释：")]),s._v(" "),t("p",[s._v("结合上一个注解一起使用，此注解会刷新缓存，每次都查询数据库")]),s._v(" "),t("h3",{attrs:{id:"分布式缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分布式缓存"}},[s._v("#")]),s._v(" 分布式缓存")]),s._v(" "),t("p",[s._v("比如 redis，不建议在 common 模块下直接引入相关依赖，不方便后期统计哪些模块使用了 redis。")]),s._v(" "),t("p",[t("strong",[s._v("使用 redis 解决了两个问题：")])]),s._v(" "),t("ol",[t("li",[s._v("提高访问速度，mysql 单机 QPS 约为 2000，redis 约 10 万")]),s._v(" "),t("li",[s._v("解决多节点共享缓存，机器重启也不会丢缓存数据")])]),s._v(" "),t("blockquote",[t("p",[s._v("redis 常用于放用户的登录信息，早期没有 redis 时，登录信息都放在 session 中，应用一重启，登录就没有了，多节点 session 又是另一个头大的问题。")])]),s._v(" "),t("h3",{attrs:{id:"前端使用缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前端使用缓存"}},[s._v("#")]),s._v(" 前端使用缓存")]),s._v(" "),t("p",[s._v("第一次请求调用后端接口，然后将数据存入会话缓存，下次用户查询数据时就会直接从浏览器会话缓存中获取数据。")]),s._v(" "),t("ul",[t("li",[s._v("关闭网站，重新进入即可获取最新数据")]),s._v(" "),t("li",[s._v("现实中的场景，比如做了什么配置的改动，就会要求重新登录，这样就可以重新查询最新数据并缓存。")])]),s._v(" "),t("h3",{attrs:{id:"缓存问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存问题"}},[s._v("#")]),s._v(" 缓存问题")]),s._v(" "),t("p",[t("strong",[s._v("缓存击穿")]),s._v("：一个热点的 key 失效后，导致大量请求直接访问数据库。")]),s._v(" "),t("p",[s._v("解决方法：")]),s._v(" "),t("ol",[t("li",[s._v("写一个定时任务，定时刷新缓存。（可避免缓存超时失效问题，但缓存机器坏了就不能解决了）")]),s._v(" "),t("li",[s._v("针对数据库查询，增加分布式锁，100 个请求，只有一个拿到锁，去查数据库，其它 99 个请求都快速失败，"),t("strong",[s._v("告诉用户稍候重试")]),s._v(" -- 相当于查询失败，不能让请求一直等待，会占用大量资源。（可解决缓存机器坏了的情况）")])]),s._v(" "),t("p",[s._v("**缓存穿透：**去缓存里取数据，因数据库本身就没数据而造成缓存穿透。")]),s._v(" "),t("p",[s._v("解决方法：")]),s._v(" "),t("ol",[t("li",[s._v("给缓存设置空值，并给数据库查询加分布式锁")])]),s._v(" "),t("p",[s._v("**缓存雪崩：**由于短时间内，大量的 key 失效导致数据库压力剧增。")]),s._v(" "),t("h3",{attrs:{id:"缓存在高并发场景中的生产问题分享"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存在高并发场景中的生产问题分享"}},[s._v("#")]),s._v(" 缓存在高并发场景中的生产问题分享")]),s._v(" "),t("p",[s._v("**场景：**每天的会员数很多，百万级别，但每个会员一天只会有几次请求，一个会员信息在同一次请求中，会被用到多次，且会员信息较大")]),s._v(" "),t("p",[s._v("**问题 1：**多次调用查询会员方法，组装信息多，多次访问数据库")]),s._v(" "),t("p",[s._v("*解决：*使用本地缓存，1 分钟有效（请求不多且不频繁，没必要使用第三方组件(Redis)，且会增加 io 消耗）")]),s._v(" "),t("p",[s._v("**问题 2：**fullgc(stop the world) 频繁，导致短时间内大量请求失败")]),s._v(" "),t("p",[s._v("*解决：*去掉本地缓存，"),t("strong",[s._v("使用线程本地变量")])]),s._v(" "),t("h4",{attrs:{id:"何谓-full-gc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#何谓-full-gc"}},[s._v("#")]),s._v(" 何谓 Full GC ?")]),s._v(" "),t("blockquote",[t("p",[s._v("这问题的描述涉及到 Java 虚拟机（JVM）垃圾回收（Garbage Collection）的概念。")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Full GC（Full Garbage Collection）：")]),s._v(" Full GC 是指进行一次完整的垃圾回收，包括新生代和老年代。这通常会触发一次"),t("em",[s._v("长时间的停顿")]),s._v("（Stop-the-World）。在这个停顿期间，所有的应用线程都被暂停，垃圾回收线程负责清理整个堆内存。")]),s._v(" "),t("li",[t("strong",[s._v("Stop-the-World：")]),s._v(" 在进行垃圾回收时，为了确保一致性和安全，"),t("em",[s._v("Java 应用线程会被暂停")]),s._v("。这个停顿的时间就是 Stop-the-World 时间。对于 Full GC，这个停顿时间较长，可能导致应用在这段时间内无法响应请求。")])]),s._v(" "),t("blockquote",[t("p",[s._v("频繁的 Full GC 可能是由于以下原因之一导致：")])]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("内存不足：")]),s._v(" 当堆内存中的对象越来越多，且垃圾回收器无法及时清理出足够的空间时，就会频繁触发 Full GC。")]),s._v(" "),t("li",[t("strong",[s._v("对象生命周期长：")]),s._v(" 如果系统中存在大量生命周期较长的对象，它们可能会晋升到老年代，导致老年代空间不足时频繁进行 Full GC。")]),s._v(" "),t("li",[t("strong",[s._v("堆大小不合适")]),s._v(" 如果分配给 Java 应用的堆内存不足以容纳应用的工作负载，也可能导致频繁的 Full GC。")])]),s._v(" "),t("p",[s._v("解决这个问题可能需要调整堆大小、优化代码以减少对象生命周期，或者考虑使用不同的垃圾回收算法。要深入了解问题的具体原因，可能需要进行性能分析和监控，使用工具如 Java Mission Control、VisualVM 等。")]),s._v(" "),t("h4",{attrs:{id:"场景问题分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#场景问题分析"}},[s._v("#")]),s._v(" 场景问题分析")]),s._v(" "),t("p",[t("strong",[s._v("1. 缓存过期时间过短导致频繁失效：")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("问题描述：")]),s._v(" 如果本地缓存的过期时间设置得很短，而且缓存中的数据量很大，可能会导致频繁失效和重新加载，增加 GC 的负担。")]),s._v(" "),t("li",[t("strong",[s._v("解决方案：")]),s._v(" 考虑调整缓存的过期时间，使其更适应实际业务需求。过短的缓存时间可能不划算，因为它会导致频繁的缓存加载。")])]),s._v(" "),t("p",[t("strong",[s._v("2. 缓存对象大小过大：")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("问题描述：")]),s._v(" 会员信息较大，如果缓存中的对象占用大量内存，会增加 GC 的频率和负担。")]),s._v(" "),t("li",[t("strong",[s._v("解决方案：")]),s._v(" 考虑对缓存中的大对象进行优化，可能可以使用更节省内存的数据结构，或者对大对象进行分片处理。")])]),s._v(" "),t("p",[t("strong",[s._v("3. 缓存数据并发更新问题：")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("问题描述：")]),s._v(" 如果缓存中的数据需要频繁更新，可能存在并发更新的问题，导致缓存不一致。")]),s._v(" "),t("li",[t("strong",[s._v("解决方案：")]),s._v(" 可以考虑使用更高级别的缓存方案，例如分布式缓存，以解决并发更新和一致性的问题。")])]),s._v(" "),t("p",[t("strong",[s._v("4. 线程本地变量可能带来的问题：")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("问题描述：")]),s._v(" 使用线程本地变量可能会导致资源泄漏和对资源的持有时间过长，需要小心管理线程本地变量的生命周期。")]),s._v(" "),t("li",[t("strong",[s._v("解决方案：")]),s._v(" 确保在线程本地变量的使用中适时清理和释放资源，防止长时间持有导致的问题。")])]),s._v(" "),t("h2",{attrs:{id:"查看端口占用问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看端口占用问题"}},[s._v("#")]),s._v(" 查看端口占用问题")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("前言")]),s._v("：打开酷狗音乐，会占用 "),t("code",[s._v("8000")]),s._v(" 端口")])]),s._v(" "),t("p",[s._v("Windows 排查端口占用问题：")]),s._v(" "),t("p",[s._v("1、查看被占用端口对应的 PID")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -aon"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("findstr "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[端口号]"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("2、查看指定 PID 的进程")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("tasklist"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("findstr "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[PID]"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("3、结束进程")]),s._v(" "),t("p",[s._v("强制（"),t("code",[s._v("/F")]),s._v(" 参数）杀死 pid 为 9088 的所有进程包括子进程（"),t("code",[s._v("/T")]),s._v(" 参数）：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("taskkill /T /F /PID "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9088")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("参考文章："),t("a",{attrs:{href:"https://www.runoob.com/w3cnote/windows-finds-port-usage.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Windows下如何查看某个端口被谁占用 | 菜鸟教程 (runoob.com)"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"接口隔离"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#接口隔离"}},[s._v("#")]),s._v(" 接口隔离")]),s._v(" "),t("p",[s._v("控台接口、会员接口、第三方接口等，做"),t("strong",[s._v("接口隔离")]),s._v("，不要混用。")]),s._v(" "),t("h2",{attrs:{id:"跨域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[s._v("#")]),s._v(" 跨域")]),s._v(" "),t("p",[s._v("跨域是指:")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("前后端不在同一个域。")])]),s._v(" "),t("li",[t("p",[s._v("IP 一样，端口不一样，也算跨域。")])])]),s._v(" "),t("h2",{attrs:{id:"日志的使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志的使用"}},[s._v("#")]),s._v(" 日志的使用")]),s._v(" "),t("p",[s._v("在各种分支，循环，关键业务点，都打上日志，从日志就能看出代码执行到哪里了")]),s._v(" "),t("h3",{attrs:{id:"日志流水号的打印"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志流水号的打印"}},[s._v("#")]),s._v(" 日志流水号的打印")]),s._v(" "),t("ol",[t("li",[s._v("日志流水号不能放在 AOP 里面打印，因为"),t("strong",[s._v("拦截器比 AOP 的优先级高")]),s._v("。")]),s._v(" "),t("li",[s._v("所以可以新建一个 "),t("code",[s._v("日志拦截器")]),s._v(" 来专门打印日志流水号。")])]),s._v(" "),t("h2",{attrs:{id:"前端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前端"}},[s._v("#")]),s._v(" 前端")]),s._v(" "),t("h3",{attrs:{id:"前端模块的搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前端模块的搭建"}},[s._v("#")]),s._v(" 前端模块的搭建")]),s._v(" "),t("ul",[t("li",[s._v("脚手架：Vue CLI 5 = Vue + 一大堆第三方组件")]),s._v(" "),t("li",[s._v("Vue 3：页面开发基于 Vue 3")]),s._v(" "),t("li",[s._v("Ant Design Vue 3：阿里团队开源的基于 Vue 的 UI 组件")])]),s._v(" "),t("blockquote",[t("p",[s._v("UI 组件有很多可选，一种是选择基于 CSS 的，如：Bootstrap，适合各种前端框架。")]),s._v(" "),t("p",[s._v("一种是选择基于 Vue 的 UI 组件，只能用于 Vue 框架。")])]),s._v(" "),t("h3",{attrs:{id:"文件讲解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件讲解"}},[s._v("#")]),s._v(" 文件讲解")]),s._v(" "),t("p",[s._v("在 Vue3 项目中，"),t("code",[s._v("App.vue")]),s._v(" 和 "),t("code",[s._v("main.js")]),s._v(" 都是核心文件，它们各自承担不同的职责。")]),s._v(" "),t("h4",{attrs:{id:"app-vue"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#app-vue"}},[s._v("#")]),s._v(" App.vue")]),s._v(" "),t("p",[t("code",[s._v("App.vue")]),s._v(" 是"),t("strong",[s._v("项目的主组件")]),s._v("，它是 Vue 应用程序的起点，也是所有其他子组件的父组件。")]),s._v(" "),t("p",[t("code",[s._v("App.vue")]),s._v(" 的作用包括：")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("布局设计")]),s._v("：通常，"),t("code",[s._v("App.vue")]),s._v(" 用于定义整个应用程序的基本布局结构。例如，可能包含导航栏、侧边栏、页脚等基本布局元素。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("提供数据/方法")]),s._v("：虽然不常见，但有时可能会在 "),t("code",[s._v("App.vue")]),s._v(" 中定义一些共享的数据属性或方法，供其子组件使用。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("渲染子组件")]),s._v("："),t("code",[s._v("App.vue")]),s._v(" 中的模板会作为顶级内容被渲染到浏览器中，因此可以通过在模板中插入其他组件 "),t("code",[s._v("<component>")]),s._v(" 标签来展示各个功能模块。")])])]),s._v(" "),t("h4",{attrs:{id:"main-js"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#main-js"}},[s._v("#")]),s._v(" main.js")]),s._v(" "),t("p",[t("code",[s._v("main.js")]),s._v(" 是"),t("strong",[s._v("整个项目的入口文件")]),s._v("，它主要负责以下几个方面：")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("实例化 Vue 应用")]),s._v("：使用 "),t("code",[s._v("createApp()")]),s._v(" 函数创建一个新的 Vue 应用程序实例。这是将 Vue 与实际 HTML 页面关联起来的地方。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("注册全局组件")]),s._v("：在这个文件中，你可以注册在整个项目中都可以使用的全局组件，这通常通过调用 "),t("code",[s._v("app.component()")]),s._v(" 方法来实现。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("安装插件")]),s._v("：如果你的项目依赖于一些外部插件（如状态管理库Vuex、路由库Vue Router等），你可以在 "),t("code",[s._v("main.js")]),s._v(" 中安装它们，通常是通过调用 "),t("code",[s._v("app.use()")]),s._v(" 方法。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("挂载根组件")]),s._v("：最后一步是在 DOM 中指定一个挂载点，并将 Vue 应用程序实例挂载到这个元素上，通常通过调用 "),t("code",[s._v("app.mount()")]),s._v(" 方法完成。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("设置全局变量或配置")]),s._v("：根据需要，可以在这里定义全局变量或修改 Vue 的一些默认配置。")])])]),s._v(" "),t("blockquote",[t("p",[s._v("总之")])]),s._v(" "),t("ol",[t("li",[t("code",[s._v("main.js")]),s._v(" 主要负责初始化和配置整个 Vue 应用程序，")]),s._v(" "),t("li",[s._v("而 "),t("code",[s._v("App.vue")]),s._v(" 则更多地关注应用程序的实际 UI 结构和呈现。")])]),s._v(" "),t("h4",{attrs:{id:"package-json"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#package-json"}},[s._v("#")]),s._v(" package.json")]),s._v(" "),t("p",[s._v("类似 maven 的 pom.xml，用于引入依赖")]),s._v(" "),t("h4",{attrs:{id:"package-lock-json"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#package-lock-json"}},[s._v("#")]),s._v(" package-lock.json")]),s._v(" "),t("p",[s._v("用于锁定版本号")]),s._v(" "),t("ul",[t("li",[s._v("锁定当前依赖的版本")]),s._v(" "),t("li",[s._v("锁定当前依赖的第三方依赖的版本")])]),s._v(" "),t("h4",{attrs:{id:"store"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#store"}},[s._v("#")]),s._v(" store")]),s._v(" "),t("h3",{attrs:{id:"vuecli-多环境配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vuecli-多环境配置"}},[s._v("#")]),s._v(" VueCLI 多环境配置")]),s._v(" "),t("h4",{attrs:{id:"创建文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建文件"}},[s._v("#")]),s._v(" 创建文件")]),s._v(" "),t("p",[s._v("创建 "),t("code",[s._v(".env.dev")]),s._v(" 和 "),t("code",[s._v(".env.prod")]),s._v(" 文件。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("NODE_ENV")]),s._v(" 是内置变量")]),s._v(" "),t("li",[s._v("自定义变量用 "),t("code",[s._v("VUE_APP_")]),s._v(" 开头")])]),s._v(" "),t("p",[t("em",[s._v("1、配置开发环境：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("NODE_ENV=development\nVUE_APP_SERVER=http://localhost:8000\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("em",[s._v("2、配置上产环境")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("NODE_ENV=production\nVUE_APP_SERVER=http://train-server.jiawablog.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"打印日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打印日志"}},[s._v("#")]),s._v(" 打印日志")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("main.js")]),s._v(" 文件下，添加以下内容")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 给axios添加基础URL, 配置之后所有axios请求都会自动带上这个URL")]),s._v("\naxios"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("defaults"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("baseURL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VUE_APP_SERVER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打印当前环境配置")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'环境：'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'服务端：'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VUE_APP_SERVER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"配置运行参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置运行参数"}},[s._v("#")]),s._v(" 配置运行参数")]),s._v(" "),t("p",[s._v("修改 "),t("code",[s._v("package.json")]),s._v(" 文件")]),s._v(" "),t("p",[s._v("以【开发环境】为例：在运行脚本（"),t("code",[s._v('"scripts"')]),s._v("）中添加参数："),t("code",[s._v("--mode dev")])]),s._v(" "),t("p",[t("em",[s._v("完整参数如下：")])]),s._v(" "),t("p",[s._v("【开发环境】和【生产环境】分开配置")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"web-dev"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vue-cli-service serve --mode dev --port 9000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"web-prod"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vue-cli-service serve --mode prod --port 9000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build-web-prod"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vue-cli-service build --mode prod"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lint"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vue-cli-service lint"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"引入公共组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#引入公共组件"}},[s._v("#")]),s._v(" 引入公共组件")]),s._v(" "),t("p",[s._v("引入公共组件时，不要直接复制粘贴引入。")]),s._v(" "),t("ol",[t("li",[s._v("应该让编译器自动补全")]),s._v(" "),t("li",[s._v("自动补全，会自动引入 "),t("code",[s._v("import")]),s._v(" 语句")]),s._v(" "),t("li",[s._v("会自动引入 "),t("code",[s._v("components")]),s._v(" 属性值")])]),s._v(" "),t("h3",{attrs:{id:"解决浏览器刷新问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决浏览器刷新问题"}},[s._v("#")]),s._v(" 解决浏览器刷新问题")]),s._v(" "),t("h4",{attrs:{id:"设置会话存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置会话存储"}},[s._v("#")]),s._v(" 设置会话存储")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("public.js.")]),s._v(" 目录下创建 "),t("code",[s._v("session-storage.js")]),s._v(" 文件")]),s._v(" "),t("li",[s._v("vuex 配合 h5 的"),t("strong",[s._v("会话存储")]),s._v("（"),t("em",[s._v("sessionStorage")]),s._v("）解决浏览器刷新问题。")])]),s._v(" "),t("h4",{attrs:{id:"引入-js-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#引入-js-文件"}},[s._v("#")]),s._v(" 引入 js 文件")]),s._v(" "),t("p",[s._v("坐标："),t("code",[s._v("public.js")]),s._v(" 目录下的 "),t("code",[s._v("index.html")]),s._v(" 文件")]),s._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("<%= BASE_URL %>js/session-storage.js"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("注意 js 前面没有斜杆。")]),s._v(" "),t("h4",{attrs:{id:"使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),t("p",[s._v("1、登录成功后设置会话存储值")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 给变量赋值, _member 是外部传进来的参数")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("mutations")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMember")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" _member")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("member "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _member"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 存入会话存储, 设置值")]),s._v("\n      window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SessionStorage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MEMBER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" _member"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("2、变量获取值")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建全局变量")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 从会话存储中获取值")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("member")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SessionStorage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MEMBER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("设计细节：")]),s._v(" "),t("p",[t("code",[s._v("|| {}")]),s._v(" 的使用：空对象的设置，避免了会话存储中没有值时引发的，"),t("strong",[s._v("空指针异常")])]),s._v(" "),t("h3",{attrs:{id:"避免用户通过修改路径而访问主页"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#避免用户通过修改路径而访问主页"}},[s._v("#")]),s._v(" 避免用户通过修改路径而访问主页")]),s._v(" "),t("h4",{attrs:{id:"为路由页面增加登录拦截"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为路由页面增加登录拦截"}},[s._v("#")]),s._v(" 为路由页面增加登录拦截")]),s._v(" "),t("p",[s._v("1、设置登录开关")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("\t  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("component")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../views/main.vue'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置登录开关")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("meta")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("loginRequire")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("2、路由登录拦截逻辑处理")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 路由登录拦截")]),s._v("\nrouter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("beforeEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("to"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 要不要对meta.loginRequire属性做监控拦截")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("matched"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("some")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("item")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"是否需要登录校验："')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("meta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loginRequire "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("meta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loginRequire\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" _member "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" store"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("member"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"页面登录校验开始："')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" _member"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("_member"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("token"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"用户未登录或登录超时！"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            notification"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"未登录或登录超时"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/login'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h4",{attrs:{id:"与后端交互的拦截"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#与后端交互的拦截"}},[s._v("#")]),s._v(" 与后端交互的拦截")]),s._v(" "),t("p",[s._v("操作方法：在 axios 拦截器拦截响应时，进行"),t("strong",[s._v("响应状态码")]),s._v(" 401 判断。（单纯设置这部分内容，不做登录拦截，"),t("strong",[s._v("用户会看到静态页面")]),s._v("）")]),s._v(" "),t("p",[s._v("核心判断：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 判断状态码是401 跳转到登录页")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("401")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"未登录或登录超时，跳到登录页"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    store"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"setMember"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    notification"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"未登录或登录超时"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("push")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/login'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("全部代码：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("axios"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interceptors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("response")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'返回结果：'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("error")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'返回错误：'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" response "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 判断状态码是401 跳转到登录页")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("401")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"未登录或登录超时，跳到登录页"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    store"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"setMember"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    notification"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"未登录或登录超时"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("push")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/login'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Promise"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"规则配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#规则配置"}},[s._v("#")]),s._v(" 规则配置")]),s._v(" "),t("p",[t("em",[s._v("坐标：")])]),s._v(" "),t("p",[t("code",[s._v("package.json")]),s._v(" 的 "),t("code",[s._v('"eslintConfig"')]),s._v(" 属性中")]),s._v(" "),t("p",[t("em",[s._v("规则代码：")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"rules"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"vue/multi-word-component-names"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"no-undef"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("em",[s._v("规则解析：")])]),s._v(" "),t("p",[s._v("在 ESLint 配置中，规则的设置是为了确保代码的一致性和避免潜在的问题。")]),s._v(" "),t("p",[s._v("以上两个规则的作用如下：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("vue/multi-word-component-names")]),s._v("：\n"),t("ul",[t("li",[s._v("这个规则是 Vue.js 的一个特定规则，用于检查组件名称是否符合最佳实践。默认情况下，该规则要求组件名必须包含多个单词（即由空格分隔）。这是为了提高代码的可读性和一致性。")]),s._v(" "),t("li",[s._v("通过将这个规则设置为 "),t("code",[s._v("0")]),s._v("，你可以"),t("strong",[s._v("关闭这个规则，允许单词或任何其他类型的组件名称")]),s._v("。这样做的原因可能是项目中有特殊的命名约定，或者开发团队认为单个单词的组件名称足够清晰和易于理解。")])])]),s._v(" "),t("li",[t("code",[s._v("no-undef")]),s._v("：\n"),t("ul",[t("li",[s._v("这是一个通用的 JavaScript 规则，用于禁止使用未声明的变量。如果启用了这个规则，ESLint 将会警告你在代码中使用但没有先声明的变量。")]),s._v(" "),t("li",[s._v("通过将这个规则设置为 "),t("code",[s._v("0")]),s._v("，你可以"),t("strong",[s._v("关闭这个规则，允许在代码中使用未声明的变量")]),s._v("。这可能是因为你的项目有一些全局变量或其他依赖库定义了这些变量，或者你希望在某些情况下允许使用未声明的变量。")]),s._v(" "),t("li",[s._v("不设置并且使用未声明变量的话，运行时会报错。比如使用全局变量的时候。")])])])]),s._v(" "),t("h3",{attrs:{id:"小技巧"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小技巧"}},[s._v("#")]),s._v(" 小技巧")]),s._v(" "),t("p",[s._v("做页面修改时，比如抽象公共组件使用时，修改一些【显然易见】的词，来检查代码修改是否生效，避免查询到的是缓存。")]),s._v(" "),t("h3",{attrs:{id:"收获"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#收获"}},[s._v("#")]),s._v(" 收获")]),s._v(" "),t("ul",[t("li",[s._v("学会纯前端项目的搭建")]),s._v(" "),t("li",[s._v("理解前后端分离架构")])]),s._v(" "),t("h2",{attrs:{id:"编程规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编程规范"}},[s._v("#")]),s._v(" 编程规范")]),s._v(" "),t("p",[s._v("内部变量(局部变量)：使用 "),t("code",[s._v("_")]),s._v(" 开头")]),s._v(" "),t("p",[s._v("程序设计："),t("strong",[s._v("约定优于配置")])]),s._v(" "),t("h2",{attrs:{id:"思考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#思考"}},[s._v("#")]),s._v(" 思考")]),s._v(" "),t("ol",[t("li",[s._v("程序员需要经常反思自己写过的代码，有没有 BUG ？")]),s._v(" "),t("li",[s._v("能不能提升性能？")]),s._v(" "),t("li",[s._v("能不能提高开发效率？")]),s._v(" "),t("li",[s._v("能不能扩展出新功能？")])]),s._v(" "),t("h2",{attrs:{id:"项目部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#项目部署"}},[s._v("#")]),s._v(" 项目部署")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("阿里云资源准备：RDS(数据库)、ECS（相当于一台 Linux 服务器）、OSS（对象存储，可配置域名，可部署前端）、SLB（相当于一个配置公网的东西）、Redis 等")]),s._v(" "),t("ul",[t("li",[s._v("生产的 ECS 中，可以配置只开放 gateway 的 8000 端口，其它 8001，8002 端口都不开放，这样就不用担心外部请求绕过 gateway，直接访问 member 模块（端口根据自己的项目来定）")])])]),s._v(" "),t("li",[t("p",[s._v("前后端的发布：JDK、Nacos、SpringBoot、Vue CLI")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("生产必备：多节点与域名配置")])]),s._v(" "),t("ul",[t("li",[s._v("多节点是服务高可用最基本的要求，否则，一旦我们遇到服务器宕机、服务器升级重启、应用发布，此时，服务就不可用了。")]),s._v(" "),t("li",[s._v("多节点要求：应用时无状态的（思考 session 和 token）。")]),s._v(" "),t("li",[s._v("无状态：应用内没有保存特殊的数据，比如将登录信息保存在 session 里，这种就是保存了和别的节点不一样的数据，属于有状态的应用。")])])])]),s._v(" "),t("p",[t("strong",[s._v("CDN 配置")])]),s._v(" "),t("ul",[t("li",[s._v("配置 CDN 加速域名")]),s._v(" "),t("li",[s._v("CDN 也是按流量付费，但流量费会比 OSS 便宜，所以配置 CDN 会更划算，又快又便宜")]),s._v(" "),t("li",[s._v("CDN 费用：外部流量费（大头），回源流量费")])]),s._v(" "),t("p",[t("strong",[s._v("Https 配置")])]),s._v(" "),t("ul",[t("li",[s._v("需要 SSL 证书 或自定义证书")]),s._v(" "),t("li",[s._v("阿里云可免费领取证书，每年有 20 个额度")])])])}),[],!1,null,null,null);t.default=e.exports}}]);