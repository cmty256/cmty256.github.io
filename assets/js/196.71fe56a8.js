(window.webpackJsonp=window.webpackJsonp||[]).push([[196],{524:function(t,a,s){"use strict";s.r(a);var n=s(1),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"apollo-入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apollo-入门"}},[t._v("#")]),t._v(" Apollo 入门")]),t._v(" "),a("h2",{attrs:{id:"apollo-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apollo-简介"}},[t._v("#")]),t._v(" Apollo 简介")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/README",target:"_blank",rel:"noopener noreferrer"}},[t._v("Apollo"),a("OutboundLink")],1),t._v(" 是携程开源的一款 "),a("strong",[t._v("分布式配置中心")]),t._v("，用于集中管理应用配置，支持热更新、权限控制、灰度发布等功能，适用于微服务架构中配置管理的场景。")]),t._v(" "),a("blockquote",[a("p",[t._v("Apollo 的主要特点包括")])]),t._v(" "),a("ul",[a("li",[t._v("配置 "),a("strong",[t._v("集中管理")]),t._v("，可视化修改；")]),t._v(" "),a("li",[t._v("支持 "),a("strong",[t._v("实时推送（热更新）")]),t._v("，客户端自动刷新；")]),t._v(" "),a("li",[t._v("支持配置 "),a("strong",[t._v("灰度发布")]),t._v("；")]),t._v(" "),a("li",[t._v("支持多环境、多集群、多命名空间；")]),t._v(" "),a("li",[t._v("提供 "),a("strong",[t._v("版本回滚")]),t._v(" 功能；")]),t._v(" "),a("li",[t._v("支持 "),a("strong",[t._v("权限管理与审计日志")]),t._v("。")])]),t._v(" "),a("blockquote",[a("p",[t._v("Apollo 支持 4 个维度管理 Key-Value 格式的配置")])]),t._v(" "),a("ol",[a("li",[t._v("application (应用)")]),t._v(" "),a("li",[t._v("environment (环境)")]),t._v(" "),a("li",[t._v("cluster (集群)")]),t._v(" "),a("li",[t._v("namespace (命名空间)")])]),t._v(" "),a("h2",{attrs:{id:"apollo-核心概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apollo-核心概念"}},[t._v("#")]),t._v(" Apollo 核心概念")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("application (应用)")]),t._v(" "),a("ul",[a("li",[t._v("这个很好理解，就是实际使用配置的应用，Apollo 客户端在运行时需要知道当前应用是谁，从而可以去获取对应的配置")]),t._v(" "),a("li",[t._v("关键字：appId")])])]),t._v(" "),a("li",[a("strong",[t._v("environment (环境)")]),t._v(" "),a("ul",[a("li",[t._v("配置对应的环境，Apollo 客户端在运行时需要知道当前应用处于哪个环境，从而可以去获取应用的配置")]),t._v(" "),a("li",[t._v("关键字：env")])])]),t._v(" "),a("li",[a("strong",[t._v("cluster (集群)")]),t._v(" "),a("ul",[a("li",[t._v("一个应用下不同实例的分组，比如典型的可以按照数据中心分，把上海机房的应用实例分为一个集群，把北京机房的应用实例分为另一个集群。")]),t._v(" "),a("li",[t._v("关键字：cluster")])])]),t._v(" "),a("li",[a("strong",[t._v("namespace (命名空间)")]),t._v(" "),a("ul",[a("li",[t._v("一个应用下不同配置的分组，可以简单地把 namespace 类比为文件，不同类型的配置存放在不同的文件中，如数据库配置文件，RPC 配置文件，应用自身的配置文件等")]),t._v(" "),a("li",[t._v("关键字：namespaces")])])])]),t._v(" "),a("p",[t._v("关系："),a("strong",[t._v("应用包含多个环境，环境包含多个集群，集群中包含多个命名空间")])]),t._v(" "),a("blockquote",[a("p",[t._v("命名空间注意事项")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("命名空间名全局唯一")]),t._v("（比如两个应用不能都创建一个叫 "),a("code",[t._v("common.json")]),t._v(" 的公共命名空间）；")]),t._v(" "),a("li",[a("strong",[t._v("公共命名空间建议统一在一个配置应用下维护")]),t._v("，比如 "),a("code",[t._v("common-config")]),t._v("；")]),t._v(" "),a("li",[t._v("公共命名空间中的 key 如果与私有命名空间冲突，以 "),a("strong",[t._v("私有命名空间优先")]),t._v("；")]),t._v(" "),a("li",[t._v("一个应用可以同时引用多个公共命名空间。")])]),t._v(" "),a("blockquote",[a("p",[t._v("命名空间实战建议")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("场景")]),t._v(" "),a("th",[t._v("建议类型")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("每个服务自己的业务配置")]),t._v(" "),a("td",[t._v("私有命名空间")])]),t._v(" "),a("tr",[a("td",[t._v("多服务共享的 Redis、限流、开关等")]),t._v(" "),a("td",[t._v("公共命名空间")])]),t._v(" "),a("tr",[a("td",[t._v("想以模块区分配置，如 log4j.yaml")]),t._v(" "),a("td",[t._v("私有或公共皆可，取决于是否共享")])]),t._v(" "),a("tr",[a("td",[t._v("想全局维护一些规则")]),t._v(" "),a("td",[t._v("公共命名空间")])])])]),t._v(" "),a("h2",{attrs:{id:"核心组件和架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心组件和架构"}},[t._v("#")]),t._v(" 核心组件和架构")]),t._v(" "),a("p",[t._v("Apollo 的核心由以下几个模块组成：")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("Config Service")]),t._v("：提供配置读取、推送服务（对客户端）。")]),t._v(" "),a("li",[a("strong",[t._v("Admin Service")]),t._v("：提供配置管理功能（供 Portal 使用）。")]),t._v(" "),a("li",[a("strong",[t._v("Portal")]),t._v("：可视化管理界面。")]),t._v(" "),a("li",[a("strong",[t._v("客户端 SDK")]),t._v("：集成在服务中，实现配置读取和监听更新。")])]),t._v(" "),a("p",[t._v("Apollo 架构图如下：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("          +-----------+         +-----------------+\n          |  Apollo   |<-------\x3e|  Config Service |\n          |  Portal   |         +-----------------+\n               |\n         +-------------+\n         | AdminService|\n         +-------------+\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("客户端部署后，会通过 SDK 向 Config Service 拉取配置，并可实时监听配置变更。")]),t._v(" "),a("h2",{attrs:{id:"apollo-与-nacos-的对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apollo-与-nacos-的对比"}},[t._v("#")]),t._v(" Apollo 与 Nacos 的对比")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("特性")]),t._v(" "),a("th",[t._v("Apollo")]),t._v(" "),a("th",[t._v("Nacos")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("所属")]),t._v(" "),a("td",[t._v("携程开源")]),t._v(" "),a("td",[t._v("阿里开源")])]),t._v(" "),a("tr",[a("td",[t._v("配置热更新")]),t._v(" "),a("td",[t._v("支持（默认开启）")]),t._v(" "),a("td",[t._v("支持（需依赖 Spring Cloud）")])]),t._v(" "),a("tr",[a("td",[t._v("多命名空间支持")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("支持")])]),t._v(" "),a("tr",[a("td",[t._v("灰度发布")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("不支持")])]),t._v(" "),a("tr",[a("td",[t._v("权限管理")]),t._v(" "),a("td",[t._v("支持")]),t._v(" "),a("td",[t._v("简单支持")])]),t._v(" "),a("tr",[a("td",[t._v("集群部署难度")]),t._v(" "),a("td",[t._v("相对复杂")]),t._v(" "),a("td",[t._v("较简单")])]),t._v(" "),a("tr",[a("td",[t._v("配置格式支持")]),t._v(" "),a("td",[t._v("支持 Properties、YAML、JSON、XML 等")]),t._v(" "),a("td",[t._v("支持 Properties、YAML、JSON")])]),t._v(" "),a("tr",[a("td",[t._v("服务注册与发现")]),t._v(" "),a("td",[t._v("不支持（只管配置）")]),t._v(" "),a("td",[t._v("支持（服务发现与配置中心二合一）")])])])]),t._v(" "),a("p",[t._v("简而言之：")]),t._v(" "),a("ul",[a("li",[t._v("Apollo 更注重 "),a("strong",[t._v("配置管理能力")]),t._v("，尤其适合配置量大、管理复杂的项目；")]),t._v(" "),a("li",[t._v("Nacos 是一个 "),a("strong",[t._v("配置中心 + 注册中心")]),t._v(" 的统一平台，更适合 Spring Cloud 项目。")])]),t._v(" "),a("h2",{attrs:{id:"apollo-快速上手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apollo-快速上手"}},[t._v("#")]),t._v(" Apollo 快速上手")]),t._v(" "),a("blockquote",[a("p",[t._v("官方文档："),a("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/deployment/quick-start",target:"_blank",rel:"noopener noreferrer"}},[t._v("Quick Start"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[t._v("#")]),t._v(" 环境准备")]),t._v(" "),a("p",[t._v("官方提供了 "),a("a",{attrs:{href:"https://github.com/apolloconfig/apollo-quick-start",target:"_blank",rel:"noopener noreferrer"}},[t._v("apollo-quick-start 项目"),a("OutboundLink")],1),t._v("，可以使用 Docker 快速部署。")]),t._v(" "),a("h4",{attrs:{id:"windows-环境启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#windows-环境启动"}},[t._v("#")]),t._v(" windows 环境启动")]),t._v(" "),a("p",[a("strong",[t._v("在 git bash 中")]),t._v("，执行下面的启动命令：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SPRING_PROFILES_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github,database-discovery,auth"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 ApolloConfigDB 数据库连接")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("unset")]),t._v(" SPRING_SQL_CONFIG_INIT_MODE\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SPRING_CONFIG_DATASOURCE_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jdbc:mysql://localhost:3306/apolloconfigdb?useUnicode=true&characterEncoding=utf8&useSSL=false"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SPRING_CONFIG_DATASOURCE_USERNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SPRING_CONFIG_DATASOURCE_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123456"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 ApolloPortalDB 数据库连接")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("unset")]),t._v(" SPRING_SQL_PORTAL_INIT_MODE\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SPRING_PORTAL_DATASOURCE_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jdbc:mysql://localhost:3306/apolloportaldb?useUnicode=true&characterEncoding=utf8&useSSL=false"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SPRING_PORTAL_DATASOURCE_USERNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SPRING_PORTAL_DATASOURCE_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123456"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" apollo-all-in-one.jar\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("p",[t._v("或者执行启动脚本命令：")]),t._v(" "),a("ul",[a("li",[t._v("⚠️注意：这种命令启动无法直接通过 "),a("code",[t._v("Ctrl + c")]),t._v(" 来关闭项目")])]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动")]),t._v("\n./demo.sh start\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭")]),t._v("\n./demo.sh stop\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("启动成功后：")]),t._v(" "),a("ul",[a("li",[t._v("Portal 地址: "),a("a",{attrs:{href:"http://localhost:8070/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:8070"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("默认账号: "),a("code",[t._v("apollo")]),t._v(" / "),a("code",[t._v("admin")])])]),t._v(" "),a("h3",{attrs:{id:"创建配置示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建配置示例"}},[t._v("#")]),t._v(" 创建配置示例")]),t._v(" "),a("p",[t._v("进入 Portal：")]),t._v(" "),a("ol",[a("li",[t._v("创建一个新的应用（App Id 如 "),a("code",[t._v("demo-java-app")]),t._v("）；")]),t._v(" "),a("li",[t._v("创建命名空间，如 "),a("code",[t._v("application")]),t._v("；")]),t._v(" "),a("li",[t._v("添加配置项：\n"),a("ul",[a("li",[a("code",[t._v("user.name = apollo")])]),t._v(" "),a("li",[a("code",[t._v("user.age = 25")])])])])]),t._v(" "),a("p",[t._v("发布配置后，客户端即可拉取。")]),t._v(" "),a("h3",{attrs:{id:"客户端接入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端接入"}},[t._v("#")]),t._v(" 客户端接入")]),t._v(" "),a("p",[t._v("以 Spring Boot 为例，引入依赖：")]),t._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.ctrip.framework.apollo"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("apollo-client"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("2.2.0"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("在 "),a("code",[t._v("application.properties")]),t._v(" 中配置：")]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("app.id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("demo-java-app")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("apollo.meta")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("http://localhost:8080")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("读取配置方式有两种：")]),t._v(" "),a("h4",{attrs:{id:"方式一-使用-value"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式一-使用-value"}},[t._v("#")]),t._v(" 方式一：使用 "),a("code",[t._v("@Value")])]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${user.name}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" userName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h4",{attrs:{id:"方式二-使用-config-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式二-使用-config-api"}},[t._v("#")]),t._v(" 方式二：使用 "),a("code",[t._v("Config")]),t._v(" API")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Config")]),t._v(" config "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConfigService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAppConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" userName "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user.name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"defaultName"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h4",{attrs:{id:"支持配置变更监听"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持配置变更监听"}},[t._v("#")]),t._v(" 支持配置变更监听")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addChangeListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("changeEvent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" changeEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("changedKeys")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConfigChange")]),t._v(" change "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" changeEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getChange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Found change - key: %s, oldValue: %s, newValue: %s%n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            change"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPropertyName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" change"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOldValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" change"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getNewValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("h3",{attrs:{id:"使用-spring-boot-starter-推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-spring-boot-starter-推荐"}},[t._v("#")]),t._v(" 使用 Spring Boot Starter（推荐）")]),t._v(" "),a("p",[t._v("引入 Starter：")]),t._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.ctrip.framework.apollo"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("apollo-client-config-spring-boot-starter"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("2.2.0"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("Spring Boot 项目将自动启用 Apollo 配置，"),a("code",[t._v("application.properties")]),t._v(" 中配置好 "),a("code",[t._v("app.id")]),t._v(" 和 "),a("code",[t._v("apollo.meta")]),t._v(" 即可。")]),t._v(" "),a("h2",{attrs:{id:"实践建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实践建议"}},[t._v("#")]),t._v(" 实践建议")]),t._v(" "),a("ul",[a("li",[t._v("配置分类建议使用多个命名空间（如 DB 配置、线程池配置、开关配置分开管理）；")]),t._v(" "),a("li",[t._v("线上配置发布建议启用审计、灰度发布功能，避免全量影响；")]),t._v(" "),a("li",[t._v("定期使用回滚功能测试变更的安全性；")]),t._v(" "),a("li",[t._v("警惕误删配置项，可以启用强制发布审核流程。")])]),t._v(" "),a("h2",{attrs:{id:"学习参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学习参考"}},[t._v("#")]),t._v(" 学习参考")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/535843707",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置中心：Apollo入门了解 - 知乎"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.jianshu.com/p/6cf4b15ba82f",target:"_blank",rel:"noopener noreferrer"}},[t._v("apollo quick start操作 - 简书"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);