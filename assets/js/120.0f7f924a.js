(window.webpackJsonp=window.webpackJsonp||[]).push([[120],{454:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"异步注解-async"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#异步注解-async"}},[t._v("#")]),t._v(" 异步注解 @Async")]),t._v(" "),s("h2",{attrs:{id:"_1、启动类开启异步线程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、启动类开启异步线程"}},[t._v("#")]),t._v(" 1、启动类开启异步线程")]),t._v(" "),s("p",[s("code",[t._v("启动类")]),t._v(" 上添加或者 "),s("code",[t._v("自定义线程池")]),t._v(" 上添加注解："),s("code",[t._v("@EnableAsync")])]),t._v(" "),s("h2",{attrs:{id:"_2、配置线程池"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、配置线程池"}},[t._v("#")]),t._v(" 2、配置线程池")]),t._v(" "),s("p",[t._v("示例：")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 全局异步任务配置类\n *\n * @author chenmeng\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Slf4j")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableAsync")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalAsyncConfig")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AsyncConfigurer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 创建自定义异步线程池\n     *\n     * @return Executor\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"asyncExecutor"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executor")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("asyncExecutor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1、核心线程数")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" corePoolSize "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2、最大线程数")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" maxPoolSize "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3、非核心线程空闲存活时间")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" keepAliveTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60L")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4、时间单位: 秒")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),t._v(" unit "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 5、工作队列")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BlockingQueue")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" workQueue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LinkedBlockingQueue")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 6、设置线程工厂（线程名称格式）")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadFactory")]),t._v(" threadFactory "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadFactoryBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setNameFormat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"async-pool-%d"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 7、设置拒绝策略")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolExecutor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CallerRunsPolicy")]),t._v(" rejectedExecutionHandler "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolExecutor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CallerRunsPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolExecutor")]),t._v(" executor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolExecutor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                corePoolSize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                maxPoolSize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                keepAliveTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                unit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                workQueue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                threadFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                rejectedExecutionHandler\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 允许核心线程超时")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("allowCoreThreadTimeOut")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executor")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAsyncExecutor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回自定义线程池")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("asyncExecutor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AsyncUncaughtExceptionHandler")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAsyncUncaughtExceptionHandler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置异步执行时的异常处理器")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalAsyncUncaughtExceptionHandler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalAsyncUncaughtExceptionHandler")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AsyncUncaughtExceptionHandler")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleUncaughtException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),t._v(" ex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Method")]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@NotNull")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[handleUncaughtException][method({}) params({}) 发生异常]"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Arrays")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("deepToString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br"),s("span",{staticClass:"line-number"},[t._v("52")]),s("br"),s("span",{staticClass:"line-number"},[t._v("53")]),s("br"),s("span",{staticClass:"line-number"},[t._v("54")]),s("br"),s("span",{staticClass:"line-number"},[t._v("55")]),s("br"),s("span",{staticClass:"line-number"},[t._v("56")]),s("br"),s("span",{staticClass:"line-number"},[t._v("57")]),s("br"),s("span",{staticClass:"line-number"},[t._v("58")]),s("br"),s("span",{staticClass:"line-number"},[t._v("59")]),s("br"),s("span",{staticClass:"line-number"},[t._v("60")]),s("br"),s("span",{staticClass:"line-number"},[t._v("61")]),s("br"),s("span",{staticClass:"line-number"},[t._v("62")]),s("br"),s("span",{staticClass:"line-number"},[t._v("63")]),s("br"),s("span",{staticClass:"line-number"},[t._v("64")]),s("br"),s("span",{staticClass:"line-number"},[t._v("65")]),s("br"),s("span",{staticClass:"line-number"},[t._v("66")]),s("br"),s("span",{staticClass:"line-number"},[t._v("67")]),s("br"),s("span",{staticClass:"line-number"},[t._v("68")]),s("br"),s("span",{staticClass:"line-number"},[t._v("69")]),s("br")])]),s("p",[t._v("在这个配置类中，我们完成了以下内容：")]),t._v(" "),s("ol",[s("li",[t._v("通过 "),s("code",[t._v("@Configuration")]),t._v(" 注解标注这个类是一个配置类。")]),t._v(" "),s("li",[t._v("通过 "),s("code",[t._v("@EnableAsync")]),t._v(" 注解开启异步支持。")]),t._v(" "),s("li",[t._v("实现 "),s("code",[t._v("AsyncConfigurer")]),t._v(" 接口，以自定义异步执行器和异常处理器。")]),t._v(" "),s("li",[t._v("创建了一个 "),s("code",[t._v("ThreadPoolExecutor")]),t._v(" 作为自定义线程池，配置了核心线程数、最大线程数、空闲存活时间、工作队列等参数。")]),t._v(" "),s("li",[t._v("使用 "),s("code",[t._v("ThreadFactoryBuilder")]),t._v(" 创建了一个命名的线程工厂。")]),t._v(" "),s("li",[t._v("设置了拒绝策略为 "),s("code",[t._v("CallerRunsPolicy")]),t._v("，这意味着如果线程池达到饱和状态，任务将由调用者线程执行。")]),t._v(" "),s("li",[t._v("实现了自定义的异常处理器 "),s("code",[t._v("SimpleAsyncUncaughtExceptionHandler")]),t._v("，用于处理异步方法执行中的未捕获异常。")])]),t._v(" "),s("h2",{attrs:{id:"_3、方法体上添加异步注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、方法体上添加异步注解"}},[t._v("#")]),t._v(" 3、方法体上添加异步注解")]),t._v(" "),s("p",[s("strong",[t._v("示例")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Async")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[s("strong",[t._v("注意事项")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("在内部类之间的方法调用，此注解无效，不会有异步线程")]),t._v(" "),s("li",[t._v("需要外部的类来调用这个异步方法才会开启异步线程")])]),t._v(" "),s("h2",{attrs:{id:"_4、不使用自定义线程池可能引起的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、不使用自定义线程池可能引起的问题"}},[t._v("#")]),t._v(" 4、不使用自定义线程池可能引起的问题")]),t._v(" "),s("p",[t._v("在 Spring 框架中，"),s("code",[t._v("@Async")]),t._v(" 注解可以用于异步执行方法。")]),t._v(" "),s("p",[t._v("当你使用 "),s("code",[t._v("@Async")]),t._v(" 注解时，如果不自定义线程池，Spring 会为你自动创建一个默认的线程池。这个默认线程池是由 "),s("code",[t._v("SimpleAsyncTaskExecutor")]),t._v(" 管理的，它为每个任务创建一个新的线程。")]),t._v(" "),s("p",[t._v("虽然这可以工作，但可能会遇到以下问题：")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("无限制的线程创建")]),t._v("："),s("code",[t._v("SimpleAsyncTaskExecutor")]),t._v(" 会为每个任务创建一个新的线程，而没有最大线程数的限制。如果异步任务的数量非常多，这可能导致大量的线程被创建，消耗大量的系统资源，最终可能导致 "),s("code",[t._v("OutOfMemoryError")]),t._v(" 或降低系统性能。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("线程管理")]),t._v("：由于每次调用都会创建新线程，没有线程复用，这可能会导致线程管理上的开销，尤其是在高并发场景下。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("调试和监控困难")]),t._v("：默认线程池创建的线程名称没有明确的命名规则，这可能会使得在日志中或监控工具中跟踪异步任务变得困难。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("资源竞争")]),t._v("：大量的线程可能会引起CPU和内存资源的激烈竞争，尤其是在JVM和操作系统层面上的上下文切换。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("安全性问题")]),t._v("：如果异步任务执行的时间过长，而默认线程池没有适当的管理策略，可能会因为线程过多而影响到系统的稳定性和安全性。")])])]),t._v(" "),s("p",[t._v("为了避免这些问题，建议自定义线程池。自定义线程池可以提供以下优势：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("可控的线程数量")]),t._v("：通过配置最大线程数来限制并发执行的任务数量，避免过度创建线程。")]),t._v(" "),s("li",[s("strong",[t._v("线程复用")]),t._v("：线程池可以重用已存在的线程来执行新的任务，减少了线程创建和销毁的开销。")]),t._v(" "),s("li",[s("strong",[t._v("优雅的关闭")]),t._v("：可以配置线程池的关闭策略，确保在应用程序关闭时，正在执行的任务能够优雅地完成或中断。")]),t._v(" "),s("li",[s("strong",[t._v("更好的监控和调试")]),t._v("：自定义线程池可以设置有意义的线程名称，便于在日志和监控系统中识别和跟踪。")])]),t._v(" "),s("p",[t._v("在 Spring 中自定义线程池通常涉及到配置一个 "),s("code",[t._v("ThreadPoolTaskExecutor")]),t._v(" 或者实现一个 "),s("code",[t._v("AsyncConfigurer")]),t._v(" 接口，并定义线程池的各种参数，如核心线程数、最大线程数、队列容量等。这样可以更好地控制异步任务的执行和资源的使用。")]),t._v(" "),s("h2",{attrs:{id:"如何自定义一个适合我项目的线程池"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何自定义一个适合我项目的线程池"}},[t._v("#")]),t._v(" 如何自定义一个适合我项目的线程池？")]),t._v(" "),s("p",[t._v("自定义线程池以适应您的项目需求，需要考虑以下几个关键因素：")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("核心线程数（Core Pool Size）")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("核心线程是线程池中始终保持活跃的线程，即使它们处于空闲状态。通常，核心线程数取决于任务的类型（CPU密集型、IO密集型或混合型）以及系统的并发需求。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("最大线程数（Maximum Pool Size）")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("最大线程数是线程池中允许的最大线程数。当所有核心线程都在忙碌时，并且任务队列已满，线程池会创建新的线程，直到达到这个数值。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("工作队列（Work Queue）")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("工作队列用于存储等待执行的任务。队列的大小可以是有限或无限的。选择合适的队列类型（如 "),s("code",[t._v("ArrayBlockingQueue")]),t._v("、"),s("code",[t._v("LinkedBlockingQueue")]),t._v("、"),s("code",[t._v("SynchronousQueue")]),t._v(" 等）对于控制线程池的行为至关重要。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("线程存活时间（Keep-Alive Time）")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("当线程池中的线程数超过核心线程数时，非核心线程在空闲状态下可以存活的时间。这个参数可以用来控制线程的生命周期，以避免长时间保持不必要的线程。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("时间单位（Time Unit）")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("设置线程存活时间的单位")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("线程工厂（Thread Factory）")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("线程工厂用于创建新线程。通过自定义线程工厂，可以设置线程的名称、优先级和其他属性，这有助于调试和监控。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("拒绝策略（Rejected Execution Handler）")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("当任务太多，无法被线程池及时处理时，拒绝策略决定了如何处理这些额外的任务。常见的拒绝策略包括 "),s("code",[t._v("ThreadPoolExecutor.AbortPolicy")]),t._v("、"),s("code",[t._v("CallerRunsPolicy")]),t._v("、"),s("code",[t._v("DiscardPolicy")]),t._v(" 和 "),s("code",[t._v("DiscardOldestPolicy")]),t._v("。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("任务类型")]),t._v("：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("根据任务的特性（CPU密集型、IO密集型或混合型）来调整线程池的参数。CPU 密集型任务通常需要较少的线程，而 IO 密集型任务可能需要更多的线程。")])]),t._v(" "),s("li",[s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 示例")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executor")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAsyncExecutor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolTaskExecutor")]),t._v(" executor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolTaskExecutor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCorePoolSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("determineCorePoolSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据任务类型确定核心线程数")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMaxPoolSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("determineMaxPoolSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据任务类型确定最大线程数")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setQueueCapacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("determineQueueCapacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据任务类型确定队列容量")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setThreadNamePrefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"async-task-"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 线程名称前缀")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRejectedExecutionHandler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolExecutor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CallerRunsPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拒绝策略")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initialize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("determineCorePoolSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据任务类型和系统资源确定核心线程数")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 例如，对于CPU密集型任务，可以返回Runtime.getRuntime().availableProcessors();")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对于IO密集型任务，可以返回更高的值")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("determineMaxPoolSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据任务类型和系统资源确定最大线程数")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("determineQueueCapacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据任务类型确定队列容量")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br")])])])])])]),t._v(" "),s("h2",{attrs:{id:"为什么需要自定义线程池"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要自定义线程池"}},[t._v("#")]),t._v(" 为什么需要自定义线程池？")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("@Async")]),t._v(" 默认使用 "),s("code",[t._v("SimpleAsyncTaskExecutor")])])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("SimpleAsyncTaskExecutor")]),t._v(" 的问题\n"),s("ul",[s("li",[s("code",[t._v("@Async")]),t._v(" 默认使用 "),s("strong",[t._v("无界线程池")]),t._v("，"),s("strong",[t._v("每次请求都会创建新线程")]),t._v("，可能会导致"),s("strong",[t._v("线程资源耗尽")]),t._v("，最终引发 "),s("code",[t._v("OOM")]),t._v("。")]),t._v(" "),s("li",[s("strong",[t._v("没有线程复用机制")]),t._v("，对高并发业务不友好。")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("自定义线程池的好处")])]),t._v(" "),s("ol",[s("li",[t._v("解决默认线程池的局限性\n"),s("ul",[s("li",[t._v("自定义线程池可以"),s("strong",[t._v("控制线程数量")]),t._v("、"),s("strong",[t._v("防止资源耗尽")]),t._v("，提高系统的"),s("strong",[t._v("吞吐量和稳定性")]),t._v("。")])])]),t._v(" "),s("li",[t._v("提高 "),s("code",[t._v("@Async")]),t._v(" 任务执行的可控性\n"),s("ul",[s("li",[t._v("默认 "),s("code",[t._v("@Async")]),t._v(" 线程池可能会"),s("strong",[t._v("无限创建线程")]),t._v("，自定义线程池后，可以"),s("strong",[t._v("设定最大线程数，防止应用崩溃")]),t._v("。")])])])]),t._v(" "),s("h2",{attrs:{id:"线程池参数的调优建议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#线程池参数的调优建议"}},[t._v("#")]),t._v(" 线程池参数的调优建议")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数")]),t._v(" "),s("th",[t._v("作用")]),t._v(" "),s("th",[t._v("推荐值（取决于业务场景）")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("corePoolSize")])]),t._v(" "),s("td",[t._v("核心线程数，长期存活")]),t._v(" "),s("td",[s("strong",[t._v("CPU 密集型：CPU 核心数")]),t._v("，"),s("strong",[t._v("IO 密集型：2 * CPU 核心数")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("maxPoolSize")])]),t._v(" "),s("td",[t._v("最大线程数")]),t._v(" "),s("td",[s("code",[t._v("corePoolSize * 2")]),t._v(" 或更多（高并发场景）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("queueCapacity")])]),t._v(" "),s("td",[t._v("任务队列大小")]),t._v(" "),s("td",[s("code",[t._v("corePoolSize * 10")]),t._v("（视情况而定）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("keepAliveTime")])]),t._v(" "),s("td",[t._v("非核心线程存活时间")]),t._v(" "),s("td",[t._v("60s")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ThreadFactory")])]),t._v(" "),s("td",[t._v("自定义线程名称")]),t._v(" "),s("td",[t._v("方便排查问题")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("RejectedExecutionHandler")])]),t._v(" "),s("td",[t._v("线程池满时的策略")]),t._v(" "),s("td",[s("strong",[t._v("CallerRunsPolicy")]),t._v("（让调用线程执行任务）")])])])]),t._v(" "),s("h3",{attrs:{id:"重点参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重点参数"}},[t._v("#")]),t._v(" 重点参数")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数")]),t._v(" "),s("th",[t._v("作用")]),t._v(" "),s("th",[t._v("推荐配置")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("corePoolSize")]),t._v(" "),s("td",[t._v("核心线程数，常驻线程数")]),t._v(" "),s("td",[t._v("通常设置为 CPU 核心数 + N（N 视业务情况，通常 0~2）")])]),t._v(" "),s("tr",[s("td",[t._v("maxPoolSize")]),t._v(" "),s("td",[t._v("最大线程数")]),t._v(" "),s("td",[t._v("通常为 "),s("code",[t._v("corePoolSize * 2~4")]),t._v("（具体看业务峰值）")])]),t._v(" "),s("tr",[s("td",[t._v("queueCapacity")]),t._v(" "),s("td",[t._v("队列容量，缓存等待任务")]),t._v(" "),s("td",[t._v("通常设置为 "),s("code",[t._v("500~10000")]),t._v("，根据 QPS 及任务量调整")])]),t._v(" "),s("tr",[s("td",[t._v("keepAliveSeconds")]),t._v(" "),s("td",[t._v("非核心线程空闲存活时间")]),t._v(" "),s("td",[t._v("建议设置为 "),s("code",[t._v("30~60秒")])])]),t._v(" "),s("tr",[s("td",[t._v("threadNamePrefix")]),t._v(" "),s("td",[t._v("线程名前缀，便于监控和排查问题")]),t._v(" "),s("td",[t._v("业务相关前缀，例如 "),s("code",[t._v("order-executor-")])])]),t._v(" "),s("tr",[s("td",[t._v("rejectedExecutionHandler")]),t._v(" "),s("td",[t._v("拒绝策略（超出 maxPoolSize + queueCapacity）")]),t._v(" "),s("td",[t._v("通常选用 "),s("code",[t._v("CallerRunsPolicy")]),t._v("，防止丢消息")])])])]),t._v(" "),s("p",[t._v("更多拒绝策略相关的内容："),s("a",{attrs:{href:"https://cmty256.github.io/pages/040070/#%E8%AE%B2%E8%AE%B2%E6%9C%89%E5%93%AA%E4%BA%9B%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5",target:"_blank",rel:"noopener noreferrer"}},[t._v("线程池详解 | 沉梦听雨的编程指南"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"动态配置-vs-固定配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#动态配置-vs-固定配置"}},[t._v("#")]),t._v(" 动态配置 vs 固定配置")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("优点")]),t._v(" "),s("th",[t._v("缺点")]),t._v(" "),s("th",[t._v("使用场景")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("固定配置")]),t._v(" "),s("td",[t._v("稳定可靠，线程池规模明确，利于运维和监控")]),t._v(" "),s("td",[t._v("高并发时可能资源浪费或不足，无法根据硬件动态调整（缺乏灵活性）")]),t._v(" "),s("td",[t._v("并发压力可预估，流量稳定的系统")])]),t._v(" "),s("tr",[s("td",[t._v("动态配置")]),t._v(" "),s("td",[t._v("可自动适应机器配置，充分利用CPU资源")]),t._v(" "),s("td",[t._v("在业务高峰期仍需手动扩容调优")]),t._v(" "),s("td",[t._v("部署在多规格服务器、资源敏感型系统")])])])]),t._v(" "),s("p",[t._v("动态配置示例：")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myExecutor"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolTaskExecutor")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("myExecutor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolTaskExecutor")]),t._v(" executor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolTaskExecutor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 动态配置（根据可用的 JVM 处理器数）")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" cores "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runtime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRuntime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("availableProcessors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCorePoolSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cores"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMaxPoolSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cores "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setQueueCapacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cores "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 固定配置（可根据配置文件动态传参）")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// executor.setCorePoolSize(10);")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// executor.setMaxPoolSize(20);")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// executor.setQueueCapacity(200);")]),t._v("\n\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setThreadNamePrefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myExecutor-"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setKeepAliveSeconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRejectedExecutionHandler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolExecutor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CallerRunsPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initialize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" executor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br")])]),s("h2",{attrs:{id:"io密集型-vs-cpu密集型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#io密集型-vs-cpu密集型"}},[t._v("#")]),t._v(" IO密集型 vs CPU密集型")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("特点")]),t._v(" "),s("th",[t._v("典型场景")]),t._v(" "),s("th",[t._v("线程数建议")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("CPU密集型")])]),t._v(" "),s("td",[s("strong",[t._v("主要消耗 CPU 运算资源")]),t._v("，线程大部分时间在做计算")]),t._v(" "),s("td",[t._v("加密解密、图像处理、压缩解压、数据分析、复杂算法")]),t._v(" "),s("td",[s("strong",[t._v("线程数 ≈ CPU核心数 + 1")]),t._v(" （一般 ≤ 核心数 × 2）")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("IO密集型")])]),t._v(" "),s("td",[s("strong",[t._v("主要在等待 IO 操作")]),t._v("（磁盘、网络、数据库）")]),t._v(" "),s("td",[t._v("文件读写、数据库操作、网络请求、RPC调用、接口聚合")]),t._v(" "),s("td",[s("strong",[t._v("线程数 ≈ 核心数 × 2 ~ 核心数 × 4")])])])])]),t._v(" "),s("h3",{attrs:{id:"如何快速判断"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何快速判断"}},[t._v("#")]),t._v(" 如何快速判断？")]),t._v(" "),s("p",[s("strong",[t._v("1. 看业务流程")])]),t._v(" "),s("ul",[s("li",[t._v("是否大量涉及磁盘读写、网络请求？ → IO密集型")]),t._v(" "),s("li",[t._v("是否纯 CPU 计算、几乎无 IO？ → CPU密集型")])]),t._v(" "),s("p",[s("strong",[t._v("2. 用性能监控工具")]),t._v(" 可以通过 "),s("strong",[t._v("top、htop、jstack")]),t._v(" 等工具观察：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("CPU占用高，Load Average接近或超过核心数")]),t._v(" → CPU密集")]),t._v(" "),s("li",[s("strong",[t._v("CPU占用低，线程经常处于 WAITING、TIMED_WAITING 状态")]),t._v(" → IO密集")])]),t._v(" "),s("p",[s("strong",[t._v("3. 代码逻辑特征")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("循环大量计算")]),t._v(" → CPU密集")]),t._v(" "),s("li",[s("strong",[t._v("多次调用第三方接口、文件读写、数据库交互")]),t._v(" → IO密集")])]),t._v(" "),s("h3",{attrs:{id:"为什么要区分"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要区分"}},[t._v("#")]),t._v(" 为什么要区分？")]),t._v(" "),s("p",[t._v("因为 "),s("strong",[t._v("线程池配置策略不同")]),t._v("：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("CPU密集型")]),t._v("：不宜设置过多线程，避免上下文切换带来的开销。")]),t._v(" "),s("li",[s("strong",[t._v("IO密集型")]),t._v("：线程阻塞等待 IO，所以需要"),s("strong",[t._v("多开一些线程")]),t._v("，以提高吞吐。")])]),t._v(" "),s("h3",{attrs:{id:"实际企业开发举例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实际企业开发举例"}},[t._v("#")]),t._v(" 实际企业开发举例")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("业务")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("线程池设置建议")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("视频转码、图片处理")]),t._v(" "),s("td",[t._v("CPU密集型")]),t._v(" "),s("td",[s("code",[t._v("核心数 + 1")])])]),t._v(" "),s("tr",[s("td",[t._v("日志收集、异步写库、发送消息队列")]),t._v(" "),s("td",[t._v("IO密集型")]),t._v(" "),s("td",[s("code",[t._v("核心数 × 2~4")])])]),t._v(" "),s("tr",[s("td",[t._v("Web接口聚合调用第三方服务")]),t._v(" "),s("td",[t._v("IO密集型")]),t._v(" "),s("td",[s("code",[t._v("核心数 × 2~3")])])])])]),t._v(" "),s("h2",{attrs:{id:"学习参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#学习参考"}},[t._v("#")]),t._v(" 学习参考")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://blog.csdn.net/weixin_47390965/article/details/129368573",target:"_blank",rel:"noopener noreferrer"}},[t._v("Springboot之@Async异步指定自定义线程池使用_async指定线程池-CSDN博客"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/Async-Job/?self",target:"_blank",rel:"noopener noreferrer"}},[t._v("芋道 Spring Boot 异步任务入门 | 芋道源码 —— 纯源码解析博客"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://javaguide.cn/system-design/framework/spring/async.html#async-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90",target:"_blank",rel:"noopener noreferrer"}},[t._v("Async 注解原理分析 | JavaGuide"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);