(window.webpackJsonp=window.webpackJsonp||[]).push([[199],{540:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"resilience4j-å…¥é—¨ä¸å®æˆ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#resilience4j-å…¥é—¨ä¸å®æˆ˜"}},[s._v("#")]),s._v(" Resilience4j å…¥é—¨ä¸å®æˆ˜")]),s._v(" "),t("h2",{attrs:{id:"å¼•è¨€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¼•è¨€"}},[s._v("#")]),s._v(" å¼•è¨€")]),s._v(" "),t("p",[s._v("æ„å»ºé«˜å¯ç”¨å¾®æœåŠ¡çš„å®¹é”™åˆ©å™¨")]),s._v(" "),t("p",[s._v("åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ•…éšœæ˜¯å¸¸æ€è€Œéä¾‹å¤–ã€‚å¦‚ä½•ä¼˜é›…åœ°å¤„ç†æœåŠ¡è°ƒç”¨å¤±è´¥ã€é¿å…é›ªå´©æ•ˆåº”ï¼Œæ˜¯æ¯ä¸ª Java å¾®æœåŠ¡å¼€å‘è€…å¿…é¡»é¢å¯¹çš„é—®é¢˜ã€‚Resilience4j ä½œä¸ºè½»é‡çº§ã€å‡½æ•°å¼ã€é¢å‘ Java 8+ çš„å®¹é”™åº“ï¼Œæ­£é€æ¸æˆä¸º Spring Cloud ç”Ÿæ€ä¸­ Hystrix çš„ä¸»æµæ›¿ä»£æ–¹æ¡ˆã€‚æœ¬æ–‡å°†å¸¦ä½ å…¨é¢æŒæ¡ Resilience4j çš„æ ¸å¿ƒæ¨¡å—ã€ä½¿ç”¨æ–¹å¼åŠæœ€ä½³å®è·µã€‚")]),s._v(" "),t("blockquote",[t("p",[s._v("ğŸ“š å®˜æ–¹æ–‡æ¡£ï¼šhttps://resilience4j.readme.io/\nğŸ§ª ç¤ºä¾‹ä»£ç ï¼šhttps://github.com/resilience4j/resilience4j-spring-boot2-demo")])]),s._v(" "),t("h2",{attrs:{id:"ä¸ºä»€ä¹ˆé€‰æ‹©-resilience4j"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆé€‰æ‹©-resilience4j"}},[s._v("#")]),s._v(" ä¸ºä»€ä¹ˆé€‰æ‹© Resilience4jï¼Ÿ")]),s._v(" "),t("p",[s._v("åœ¨ Hystrix å®£å¸ƒåœæ­¢ç»´æŠ¤åï¼Œç¤¾åŒºæ€¥éœ€ä¸€ä¸ªç°ä»£åŒ–çš„å®¹é”™è§£å†³æ–¹æ¡ˆã€‚Resilience4j åº”è¿è€Œç”Ÿï¼Œå…¶ä¼˜åŠ¿åŒ…æ‹¬ï¼š")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("è½»é‡æ— ä¾èµ–")]),s._v("ï¼šä¸å¼ºåˆ¶ä¾èµ–ä»»ä½•æ¡†æ¶ï¼ˆå¦‚ Springï¼‰ï¼Œå¯ç‹¬ç«‹ä½¿ç”¨ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("å‡½æ•°å¼ç¼–ç¨‹é£æ ¼")]),s._v("ï¼šåŸºäº Vavrï¼ˆåŸ Javaslangï¼‰å‡½æ•°å¼åº“ï¼Œæ”¯æŒ Lambda è¡¨è¾¾å¼ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("æ¨¡å—åŒ–è®¾è®¡")]),s._v("ï¼šæŒ‰éœ€å¼•å…¥æ‰€éœ€åŠŸèƒ½ï¼ˆç†”æ–­ã€é™æµã€é‡è¯•ç­‰ï¼‰ï¼Œé¿å…â€œå¤§è€Œå…¨â€ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("ä¸ Spring Boot æ·±åº¦é›†æˆ")]),s._v("ï¼šé€šè¿‡ "),t("code",[s._v("spring-boot-starter")]),s._v(" å¿«é€Ÿé…ç½®ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("ä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡")]),s._v("ï¼šå¤©ç„¶æ”¯æŒ Micrometerï¼Œæ— ç¼å¯¹æ¥ Prometheus + Grafanaã€‚")])]),s._v(" "),t("h2",{attrs:{id:"resilience4j-æ ¸å¿ƒæ¨¡å—æ¦‚è§ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#resilience4j-æ ¸å¿ƒæ¨¡å—æ¦‚è§ˆ"}},[s._v("#")]),s._v(" Resilience4j æ ¸å¿ƒæ¨¡å—æ¦‚è§ˆ")]),s._v(" "),t("p",[s._v("Resilience4j æä¾›å…­å¤§æ ¸å¿ƒç»„ä»¶ï¼Œå¯å•ç‹¬æˆ–ç»„åˆä½¿ç”¨ï¼š")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("æ¨¡å—")]),s._v(" "),t("th",[s._v("åŠŸèƒ½")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("strong",[s._v("CircuitBreaker")])]),s._v(" "),t("td",[s._v("ç†”æ–­å™¨ï¼šå¿«é€Ÿå¤±è´¥ï¼Œé˜²æ­¢çº§è”æ•…éšœ")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("RateLimiter")])]),s._v(" "),t("td",[s._v("é™æµå™¨ï¼šæ§åˆ¶å•ä½æ—¶é—´å†…çš„è¯·æ±‚æ•°")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("Retry")])]),s._v(" "),t("td",[s._v("é‡è¯•æœºåˆ¶ï¼šå¯¹å¤±è´¥æ“ä½œè‡ªåŠ¨é‡è¯•")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("Bulkhead")])]),s._v(" "),t("td",[s._v("éš”ç¦»èˆ±ï¼šé™åˆ¶å¹¶å‘æ•°ï¼Œé˜²æ­¢å•ä¸ªæœåŠ¡è€—å°½èµ„æº")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("TimeLimiter")])]),s._v(" "),t("td",[s._v("è¶…æ—¶æ§åˆ¶ï¼šé™åˆ¶å¼‚æ­¥æ“ä½œçš„æœ€å¤§ç­‰å¾…æ—¶é—´")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("Cache")])]),s._v(" "),t("td",[s._v("ç¼“å­˜ï¼šå¯¹ç»“æœè¿›è¡Œç¼“å­˜ï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰")])])])]),s._v(" "),t("blockquote",[t("p",[s._v("ğŸ’¡ å®é™…é¡¹ç›®ä¸­æœ€å¸¸ç”¨çš„æ˜¯å‰å››é¡¹ã€‚")])]),s._v(" "),t("h2",{attrs:{id:"ç†”æ–­å™¨çŠ¶æ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç†”æ–­å™¨çŠ¶æ€"}},[s._v("#")]),s._v(" ç†”æ–­å™¨çŠ¶æ€")]),s._v(" "),t("p",[s._v("åœ¨ Resilience4j ä¸­ï¼Œ**ç†”æ–­å™¨ï¼ˆCircuit Breakerï¼‰**æœ‰ä¸‰ç§æ ¸å¿ƒçŠ¶æ€ï¼Œç”¨äºæ§åˆ¶å¯¹å¤–éƒ¨æœåŠ¡çš„è°ƒç”¨è¡Œä¸ºï¼Œé˜²æ­¢æ•…éšœè”“å»¶ã€‚")]),s._v(" "),t("p",[s._v("è¿™ä¸‰ç§çŠ¶æ€åˆ†åˆ«æ˜¯ï¼š")]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"_1-å…³é—­çŠ¶æ€-closed-çŠ¶æ€å€¼é€šå¸¸ä¸º-0"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å…³é—­çŠ¶æ€-closed-çŠ¶æ€å€¼é€šå¸¸ä¸º-0"}},[s._v("#")]),s._v(" 1. å…³é—­çŠ¶æ€ï¼ˆClosed / çŠ¶æ€å€¼é€šå¸¸ä¸º 0ï¼‰")]),s._v(" "),t("ul",[t("li",[s._v("âœ… "),t("strong",[s._v("æ­£å¸¸å·¥ä½œçŠ¶æ€")]),s._v("ã€‚")]),s._v(" "),t("li",[s._v("æ‰€æœ‰è¯·æ±‚éƒ½æ­£å¸¸å‘é€åˆ°ä¸‹æ¸¸æœåŠ¡ã€‚")]),s._v(" "),t("li",[s._v("ç†”æ–­å™¨ä¼š"),t("strong",[s._v("ç›‘æ§è°ƒç”¨çš„æˆåŠŸä¸å¤±è´¥æƒ…å†µ")]),s._v("ï¼ˆä¾‹å¦‚ï¼šè®°å½•æœ€è¿‘ N æ¬¡è°ƒç”¨çš„å¤±è´¥ç‡ï¼‰ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("è§¦å‘æ¡ä»¶")]),s._v("ï¼šå½“å¤±è´¥ç‡è¶…è¿‡è®¾å®šé˜ˆå€¼ï¼ˆå¦‚ "),t("code",[s._v("failure-rate-threshold: 50%")]),s._v("ï¼‰ä¸”æ»¡è¶³æœ€å°è¯·æ±‚æ•°ï¼ˆ"),t("code",[s._v("minimum-number-of-calls")]),s._v("ï¼‰ï¼Œç†”æ–­å™¨ä¼š"),t("strong",[s._v("è·³è½¬åˆ°â€œæ‰“å¼€â€çŠ¶æ€")]),s._v("ã€‚")])]),s._v(" "),t("blockquote",[t("p",[s._v("ğŸ“Œ ç±»æ¯”ï¼šç”µè·¯æ­£å¸¸é€šç”µï¼Œç¯äº®ç€ã€‚")])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"_2-æ‰“å¼€çŠ¶æ€-open-çŠ¶æ€å€¼é€šå¸¸ä¸º-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ‰“å¼€çŠ¶æ€-open-çŠ¶æ€å€¼é€šå¸¸ä¸º-1"}},[s._v("#")]),s._v(" 2. æ‰“å¼€çŠ¶æ€ï¼ˆOpen / çŠ¶æ€å€¼é€šå¸¸ä¸º 1ï¼‰")]),s._v(" "),t("ul",[t("li",[s._v("âŒ "),t("strong",[s._v("ç†”æ–­å·²è§¦å‘ï¼Œæ‹’ç»æ‰€æœ‰è¯·æ±‚")]),s._v("ã€‚")]),s._v(" "),t("li",[s._v("æ‰€æœ‰å¯¹è¯¥æœåŠ¡çš„è°ƒç”¨"),t("strong",[s._v("ç«‹å³å¤±è´¥")]),s._v("ï¼Œä¸ä¼šçœŸæ­£å‘å‡ºè¯·æ±‚ï¼ˆé¿å…åŠ é‡ä¸‹æ¸¸è´Ÿæ‹…ï¼‰ã€‚")]),s._v(" "),t("li",[s._v("ç›´æ¥æŠ›å‡º "),t("code",[s._v("CallNotPermittedException")]),s._v("ï¼ˆæˆ–æ‰§è¡Œ fallback é€»è¾‘ï¼‰ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("ç›®çš„")]),s._v("ï¼šç»™ä¸‹æ¸¸æœåŠ¡â€œå–˜æ¯æ—¶é—´â€ï¼Œé˜²æ­¢é›ªå´©ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("è‡ªåŠ¨æ¢å¤æœºåˆ¶")]),s._v("ï¼šç»è¿‡ä¸€æ®µé¢„è®¾æ—¶é—´ï¼ˆ"),t("code",[s._v("wait-duration-in-open-state")]),s._v("ï¼Œå¦‚ 10 ç§’ï¼‰åï¼Œç†”æ–­å™¨ä¼š"),t("strong",[s._v("è‡ªåŠ¨è¿›å…¥â€œåŠå¼€â€çŠ¶æ€")]),s._v("ï¼Œå°è¯•æ¢å¤ã€‚")])]),s._v(" "),t("blockquote",[t("p",[s._v("ğŸ“Œ ç±»æ¯”ï¼šä¿é™©ä¸ç†”æ–­ï¼Œç”µè·¯æ–­å¼€ï¼Œç¯ç­äº†ã€‚")])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"_3-åŠå¼€çŠ¶æ€-half-open-çŠ¶æ€å€¼é€šå¸¸ä¸º-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-åŠå¼€çŠ¶æ€-half-open-çŠ¶æ€å€¼é€šå¸¸ä¸º-2"}},[s._v("#")]),s._v(" 3. åŠå¼€çŠ¶æ€ï¼ˆHalf-Open / çŠ¶æ€å€¼é€šå¸¸ä¸º 2ï¼‰")]),s._v(" "),t("ul",[t("li",[s._v("ğŸ” "),t("strong",[s._v("è¯•æ¢æ€§æ¢å¤çŠ¶æ€")]),s._v("ã€‚")]),s._v(" "),t("li",[s._v("å…è®¸"),t("strong",[s._v("æœ‰é™æ•°é‡çš„è¯·æ±‚")]),s._v("é€šè¿‡ï¼ˆç”± "),t("code",[s._v("permitted-number-of-calls-in-half-open-state")]),s._v(" æ§åˆ¶ï¼Œå¦‚ 3 ä¸ªï¼‰ã€‚")]),s._v(" "),t("li",[s._v("å¦‚æœè¿™äº›è¯•æ¢è¯·æ±‚"),t("strong",[s._v("å…¨éƒ¨æˆåŠŸ")]),s._v(" â†’ ç†”æ–­å™¨"),t("strong",[s._v("å›åˆ°â€œå…³é—­â€çŠ¶æ€")]),s._v("ï¼Œæ¢å¤æ­£å¸¸è°ƒç”¨ã€‚")]),s._v(" "),t("li",[s._v("å¦‚æœ"),t("strong",[s._v("ä»»ä¸€è¯·æ±‚å¤±è´¥")]),s._v(" â†’ ç†”æ–­å™¨"),t("strong",[s._v("é‡æ–°å›åˆ°â€œæ‰“å¼€â€çŠ¶æ€")]),s._v("ï¼Œç»§ç»­ç†”æ–­ã€‚")])]),s._v(" "),t("blockquote",[t("p",[s._v("ğŸ“Œ ç±»æ¯”ï¼šè½»è½»åˆä¸Šç”µé—¸ï¼Œçœ‹ç¯æ˜¯å¦è¿˜çƒ§ä¿é™©ä¸â€”â€”å¦‚æœæ­£å¸¸å°±å½»åº•æ¢å¤ä¾›ç”µï¼Œå¦åˆ™å†æ¬¡æ–­å¼€ã€‚")])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"çŠ¶æ€è½¬æ¢å›¾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#çŠ¶æ€è½¬æ¢å›¾"}},[s._v("#")]),s._v(" çŠ¶æ€è½¬æ¢å›¾")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("         [å¤±è´¥ç‡è¿‡é«˜]\n   Closed â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â†’ Open\n     â†‘                  |\n     |                  | [ç­‰å¾…è¶…æ—¶]\n     |                  â†“\n     â””â€”â€”â€”â€”â€”â€” Half-Open â†â€”â€”â€”â€”â€”â€”â”˜\n            â†‘      |\n            |æˆåŠŸ  |å¤±è´¥\n            â””â”€â”€â”€â”€â”€â”€â”˜\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("hr"),s._v(" "),t("h3",{attrs:{id:"åœ¨-resilience4j-ä¸­çš„çŠ¶æ€å€¼-ç”¨äºç›‘æ§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨-resilience4j-ä¸­çš„çŠ¶æ€å€¼-ç”¨äºç›‘æ§"}},[s._v("#")]),s._v(" åœ¨ Resilience4j ä¸­çš„çŠ¶æ€å€¼ï¼ˆç”¨äºç›‘æ§ï¼‰")]),s._v(" "),t("p",[s._v("å½“ä½ é›†æˆ Micrometer + Prometheus æ—¶ï¼ŒæŒ‡æ ‡ "),t("code",[s._v("resilience4j_circuitbreaker_state")]),s._v(" ä¼šæš´éœ²ä»¥ä¸‹æ•°å€¼ï¼š")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("çŠ¶æ€")]),s._v(" "),t("th",[s._v("æ•°å€¼")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("CLOSED")]),s._v(" "),t("td",[s._v("0")])]),s._v(" "),t("tr",[t("td",[s._v("OPEN")]),s._v(" "),t("td",[s._v("1")])]),s._v(" "),t("tr",[t("td",[s._v("HALF_OPEN")]),s._v(" "),t("td",[s._v("2")])])])]),s._v(" "),t("p",[s._v("ä¾‹å¦‚ï¼š")]),s._v(" "),t("div",{staticClass:"language-promql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-promql"}},[t("code",[s._v("resilience4j_circuitbreaker_state"),t("span",{pre:!0,attrs:{class:"token context-labels"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token label-value attr-value"}},[s._v('"userServiceCB"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("è¡¨ç¤º "),t("code",[s._v("userServiceCB")]),s._v(" ç†”æ–­å™¨å½“å‰å¤„äº"),t("strong",[s._v("æ‰“å¼€çŠ¶æ€")]),s._v("ï¼Œæ‰€æœ‰è°ƒç”¨è¢«æ‹’ç»ã€‚")]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"å°ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“"}},[s._v("#")]),s._v(" å°ç»“")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("çŠ¶æ€")]),s._v(" "),t("th",[s._v("æ˜¯å¦æ”¾è¡Œè¯·æ±‚")]),s._v(" "),t("th",[s._v("ä½œç”¨")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("strong",[s._v("å…³é—­")])]),s._v(" "),t("td",[s._v("âœ… æ˜¯")]),s._v(" "),t("td",[s._v("æ­£å¸¸è°ƒç”¨ï¼Œç›‘æ§å¤±è´¥ç‡")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("æ‰“å¼€")])]),s._v(" "),t("td",[s._v("âŒ å¦")]),s._v(" "),t("td",[s._v("å¿«é€Ÿå¤±è´¥ï¼Œä¿æŠ¤ä¸‹æ¸¸")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("åŠå¼€")])]),s._v(" "),t("td",[s._v("âš ï¸ æœ‰é™æ”¾è¡Œ")]),s._v(" "),t("td",[s._v("è¯•æ¢æœåŠ¡æ˜¯å¦æ¢å¤ï¼Œå†³å®šæ˜¯å¦é—­åˆ")])])])]),s._v(" "),t("h2",{attrs:{id:"å¿«é€Ÿä¸Šæ‰‹-spring-boot-é›†æˆ-resilience4j"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¿«é€Ÿä¸Šæ‰‹-spring-boot-é›†æˆ-resilience4j"}},[s._v("#")]),s._v(" å¿«é€Ÿä¸Šæ‰‹ï¼šSpring Boot é›†æˆ Resilience4j")]),s._v(" "),t("h3",{attrs:{id:"_1-æ·»åŠ ä¾èµ–-maven"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ·»åŠ ä¾èµ–-maven"}},[s._v("#")]),s._v(" 1. æ·»åŠ ä¾èµ–ï¼ˆMavenï¼‰")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("io.github.resilience4j"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("resilience4j-spring-boot2"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2.2.0"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- å¯é€‰ï¼šé›†æˆ Micrometer ç›‘æ§ --\x3e")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("io.micrometer"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("micrometer-core"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("blockquote",[t("p",[s._v("æ³¨æ„ï¼šSpring Boot 3 ç”¨æˆ·åº”ä½¿ç”¨ "),t("code",[s._v("resilience4j-spring-boot3")]),s._v("ã€‚")])]),s._v(" "),t("h3",{attrs:{id:"_2-é…ç½®æ–‡ä»¶-application-yml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-é…ç½®æ–‡ä»¶-application-yml"}},[s._v("#")]),s._v(" 2. é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resilience4j")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("circuitbreaker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instances")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("userServiceCB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("failure-rate-threshold")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¤±è´¥ç‡é˜ˆå€¼ï¼ˆ%ï¼‰")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minimum-number-of-calls")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æœ€å°è¯·æ±‚æ¬¡æ•°ï¼ˆæ‰è§¦å‘ç†”æ–­åˆ¤æ–­ï¼‰")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("wait-duration-in-open-state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10s    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç†”æ–­å¼€å¯åï¼Œç­‰å¾…å¤šä¹…è¿›å…¥åŠå¼€çŠ¶æ€")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("permitted-number-of-calls-in-half-open-state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åŠå¼€çŠ¶æ€ä¸‹ï¼Œè¯•æ¢è¯·æ±‚æ¬¡æ•°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sliding-window-size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ»‘åŠ¨çª—å£å¤§å°")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sliding-window-type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" COUNT_BASED    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åŸºäºè®¡æ•°ï¼ˆä¹Ÿå¯é€‰ TIME_BASEDï¼‰")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ratelimiter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instances")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("userServiceRL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limit-for-period")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ¯å‘¨æœŸå…è®¸10æ¬¡è¯·æ±‚")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limit-refresh-period")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1s            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å‘¨æœŸä¸º1ç§’")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout-duration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è·å–è®¸å¯çš„ç­‰å¾…è¶…æ—¶ï¼ˆ0è¡¨ç¤ºç«‹å³å¤±è´¥ï¼‰")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instances")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("userServiceRetry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-attempts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æœ€å¤šé‡è¯•3æ¬¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("wait-duration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 100ms                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é‡è¯•é—´éš”")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("h2",{attrs:{id:"å®æˆ˜-å››ç§æ ¸å¿ƒæ¨¡å¼ä»£ç ç¤ºä¾‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®æˆ˜-å››ç§æ ¸å¿ƒæ¨¡å¼ä»£ç ç¤ºä¾‹"}},[s._v("#")]),s._v(" å®æˆ˜ï¼šå››ç§æ ¸å¿ƒæ¨¡å¼ä»£ç ç¤ºä¾‹")]),s._v(" "),t("h3",{attrs:{id:"åœºæ™¯å‡è®¾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åœºæ™¯å‡è®¾"}},[s._v("#")]),s._v(" åœºæ™¯å‡è®¾")]),s._v(" "),t("p",[s._v("è°ƒç”¨ç”¨æˆ·æœåŠ¡ "),t("code",[s._v("getUserById(id)")]),s._v("ï¼Œéœ€æ·»åŠ å®¹é”™èƒ½åŠ›ã€‚")]),s._v(" "),t("h4",{attrs:{id:"_1-ç†”æ–­å™¨-circuitbreaker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç†”æ–­å™¨-circuitbreaker"}},[s._v("#")]),s._v(" 1. ç†”æ–­å™¨ï¼ˆCircuitBreakerï¼‰")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CircuitBreakerRegistry")]),s._v(" circuitBreakerRegistry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUserById")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CircuitBreaker")]),s._v(" cb "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" circuitBreakerRegistry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("circuitBreaker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userServiceCB"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Supplier")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" decorated "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CircuitBreaker")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decorateSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("externalCallToUserApi")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æä¾› fallback")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Try")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ofSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decorated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("recover")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("throwable "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Default User"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("blockquote",[t("p",[s._v("ä½¿ç”¨ "),t("code",[s._v('@CircuitBreaker(name = "userServiceCB", fallbackMethod = "fallback")')]),s._v(" æ³¨è§£æ›´ç®€æ´ï¼ˆéœ€å¯ç”¨ AOPï¼‰ã€‚")])]),s._v(" "),t("h4",{attrs:{id:"_2-é™æµå™¨-ratelimiter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-é™æµå™¨-ratelimiter"}},[s._v("#")]),s._v(" 2. é™æµå™¨ï¼ˆRateLimiterï¼‰")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUserWithRateLimit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RateLimiter")]),s._v(" rl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rateLimiterRegistry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rateLimiter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userServiceRL"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Supplier")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" decorated "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RateLimiter")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decorateSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("externalCallToUserApi")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Try")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ofSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decorated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("recover")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RequestNotPermitted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" e "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Too Many Requests!"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h4",{attrs:{id:"_3-é‡è¯•-retry"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-é‡è¯•-retry"}},[s._v("#")]),s._v(" 3. é‡è¯•ï¼ˆRetryï¼‰")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUserWithRetry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Retry")]),s._v(" retry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" retryRegistry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("retry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userServiceRetry"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Supplier")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" decorated "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Retry")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decorateSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("retry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("externalCallToUserApi")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Try")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ofSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decorated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è‡ªåŠ¨é‡è¯•ï¼Œæœ€ç»ˆæŠ›å‡ºå¼‚å¸¸æˆ–æˆåŠŸ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h4",{attrs:{id:"_4-ç»„åˆä½¿ç”¨-ç†”æ–­-é‡è¯•-é™æµ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-ç»„åˆä½¿ç”¨-ç†”æ–­-é‡è¯•-é™æµ"}},[s._v("#")]),s._v(" 4. ç»„åˆä½¿ç”¨ï¼šç†”æ–­ + é‡è¯• + é™æµ")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUserRobust")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CircuitBreaker")]),s._v(" cb "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" circuitBreakerRegistry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("circuitBreaker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userServiceCB"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RateLimiter")]),s._v(" rl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rateLimiterRegistry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rateLimiter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userServiceRL"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Retry")]),s._v(" retry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" retryRegistry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("retry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userServiceRetry"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Supplier")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" supplier "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("externalCallToUserApi")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Supplier")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" decorated "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decorateSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("supplier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" cb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" retry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Try")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ofSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decorated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("recover")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fallback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Supplier")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decorateSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Supplier")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" supplier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                         "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CircuitBreaker")]),s._v(" cb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                         "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RateLimiter")]),s._v(" rl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                         "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Retry")]),s._v(" retry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CircuitBreaker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decorateSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RateLimiter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decorateSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Retry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decorateSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("retry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" supplier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("blockquote",[t("p",[s._v("âš ï¸ æ³¨æ„è£…é¥°é¡ºåºï¼šé€šå¸¸ "),t("strong",[s._v("é™æµ â†’ ç†”æ–­ â†’ é‡è¯•")]),s._v("ï¼Œä½†éœ€æ ¹æ®ä¸šåŠ¡è°ƒæ•´ã€‚")])]),s._v(" "),t("h2",{attrs:{id:"æ³¨è§£é©±åŠ¨å¼€å‘-æ¨è"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ³¨è§£é©±åŠ¨å¼€å‘-æ¨è"}},[s._v("#")]),s._v(" æ³¨è§£é©±åŠ¨å¼€å‘ï¼ˆæ¨èï¼‰")]),s._v(" "),t("p",[s._v("Resilience4j æ”¯æŒé€šè¿‡æ³¨è§£ç®€åŒ–ä»£ç ï¼š")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Retry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userServiceRetry"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fallbackMethod "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fallback"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RateLimiter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userServiceRL"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@CircuitBreaker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userServiceCB"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fallbackMethod "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fallback"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUserById")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("externalCallToUserApi")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fallback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("warn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Fallback for user: {}, error: {}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Default User"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("blockquote",[t("p",[s._v("éœ€åœ¨å¯åŠ¨ç±»æ·»åŠ  "),t("code",[s._v("@EnableAspectJAutoProxy")]),s._v(" å¹¶ç¡®ä¿ AOP ç”Ÿæ•ˆã€‚")])]),s._v(" "),t("h2",{attrs:{id:"ç›‘æ§ä¸æŒ‡æ ‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘æ§ä¸æŒ‡æ ‡"}},[s._v("#")]),s._v(" ç›‘æ§ä¸æŒ‡æ ‡")]),s._v(" "),t("p",[s._v("Resilience4j è‡ªåŠ¨æš´éœ² Micrometer æŒ‡æ ‡ï¼Œä¾‹å¦‚ï¼š")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("resilience4j_circuitbreaker_state")]),s._v("ï¼šç†”æ–­å™¨çŠ¶æ€ï¼ˆ0=å…³é—­ï¼Œ1=æ‰“å¼€ï¼Œ2=åŠå¼€ï¼‰")]),s._v(" "),t("li",[t("code",[s._v("resilience4j_ratelimiter_available_permissions")]),s._v("ï¼šå‰©ä½™è®¸å¯æ•°")]),s._v(" "),t("li",[t("code",[s._v("resilience4j_retry_calls")]),s._v("ï¼šé‡è¯•æ¬¡æ•°ç»Ÿè®¡")])]),s._v(" "),t("p",[s._v("é…åˆ Prometheus + Grafanaï¼Œå¯æ„å»ºå®æ—¶å®¹é”™çœ‹æ¿ã€‚")]),s._v(" "),t("h2",{attrs:{id:"æœ€ä½³å®è·µå»ºè®®"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æœ€ä½³å®è·µå»ºè®®"}},[s._v("#")]),s._v(" æœ€ä½³å®è·µå»ºè®®")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("åˆç†è®¾ç½®ç†”æ–­å‚æ•°")]),s._v("ï¼šé¿å…è¿‡äºæ•æ„Ÿï¼ˆé¢‘ç¹ç†”æ–­ï¼‰æˆ–è¿Ÿé’ï¼ˆæ— æ³•ä¿æŠ¤ç³»ç»Ÿï¼‰ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("é‡è¯•éœ€å¹‚ç­‰")]),s._v("ï¼šç¡®ä¿è¢«è°ƒç”¨æ¥å£æ”¯æŒé‡å¤è¯·æ±‚ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("é™æµä¸ä¸šåŠ¡åŒ¹é…")]),s._v("ï¼šçªå‘æµé‡ vs å¹³ç¨³æµé‡ï¼Œé€‰æ‹© "),t("code",[s._v("TIME_BASED")]),s._v(" æˆ– "),t("code",[s._v("COUNT_BASED")]),s._v("ã€‚")]),s._v(" "),t("li",[t("strong",[s._v("fallback é€»è¾‘è½»é‡")]),s._v("ï¼šé¿å… fallback æœ¬èº«æˆä¸ºç“¶é¢ˆã€‚")]),s._v(" "),t("li",[t("strong",[s._v("ç»„åˆç­–ç•¥æœ‰é¡ºåº")]),s._v("ï¼šé€šå¸¸å…ˆé™æµï¼ˆå…¥å£æ§åˆ¶ï¼‰ï¼Œå†ç†”æ–­ï¼ˆæ•…éšœéš”ç¦»ï¼‰ï¼Œæœ€åé‡è¯•ï¼ˆæ¢å¤å°è¯•ï¼‰ã€‚")])])])}),[],!1,null,null,null);t.default=e.exports}}]);