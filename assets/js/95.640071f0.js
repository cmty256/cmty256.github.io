(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{426:function(s,a,t){"use strict";t.r(a);var r=t(1),e=Object(r.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"讲讲索引失效问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#讲讲索引失效问题"}},[s._v("#")]),s._v(" 讲讲索引失效问题")]),s._v(" "),a("p",[s._v("在数据库中，索引是优化查询性能的重要工具。然而，某些情况下，即使为字段创建了索引，查询时仍可能无法使用索引，导致性能下降。这种现象称为"),a("strong",[s._v("索引失效")]),s._v("。")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"索引失效的常见原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引失效的常见原因"}},[s._v("#")]),s._v(" "),a("strong",[s._v("索引失效的常见原因")])]),s._v(" "),a("h3",{attrs:{id:"_1-查询条件中的函数或表达式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-查询条件中的函数或表达式"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1. 查询条件中的函数或表达式")])]),s._v(" "),a("p",[s._v("当查询条件中对索引字段进行了函数操作或表达式计算时，索引会失效。")]),s._v(" "),a("h4",{attrs:{id:"示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[s._v("#")]),s._v(" 示例：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 假设 `name` 字段有索引")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" UPPER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'JOHN'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("原因："),a("code",[s._v("UPPER(name)")]),s._v(" 会对每一行的数据进行操作，使得索引无法直接用于查询。")])]),s._v(" "),a("h4",{attrs:{id:"解决方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[s._v("#")]),s._v(" 解决方法：")]),s._v(" "),a("p",[s._v("避免对索引字段进行函数或表达式操作。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'john'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("h3",{attrs:{id:"_2-使用不等于-或"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用不等于-或"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2. 使用不等于（"),a("code",[s._v("!=")]),s._v(" 或 "),a("code",[s._v("<>")]),s._v("）")])]),s._v(" "),a("p",[s._v("不等于操作符会导致全表扫描，因为无法通过索引快速过滤不满足条件的记录。")]),s._v(" "),a("h4",{attrs:{id:"示例-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-2"}},[s._v("#")]),s._v(" 示例：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("原因：索引无法对 "),a("code",[s._v("!=")]),s._v(" 操作快速定位所有可能的值。")])]),s._v(" "),a("h4",{attrs:{id:"解决方法-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-2"}},[s._v("#")]),s._v(" 解决方法：")]),s._v(" "),a("p",[s._v("优化查询逻辑，尽量使用范围查询或其他条件。")]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_3-or-查询中没有对所有条件字段加索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-or-查询中没有对所有条件字段加索引"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3. "),a("code",[s._v("OR")]),s._v(" 查询中没有对所有条件字段加索引")])]),s._v(" "),a("p",[s._v("如果 "),a("code",[s._v("OR")]),s._v(" 连接的多个条件中，某些字段没有索引，则索引会失效。")]),s._v(" "),a("h4",{attrs:{id:"示例-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-3"}},[s._v("#")]),s._v(" 示例：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("OR")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'John'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("如果 "),a("code",[s._v("age")]),s._v(" 和 "),a("code",[s._v("name")]),s._v(" 字段没有同时建立索引，则可能导致索引失效。")])]),s._v(" "),a("h4",{attrs:{id:"解决方法-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-3"}},[s._v("#")]),s._v(" 解决方法：")]),s._v(" "),a("p",[s._v("为所有可能的查询字段建立索引，或将 "),a("code",[s._v("OR")]),s._v(" 查询拆分为 "),a("code",[s._v("UNION")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNION")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'John'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("hr"),s._v(" "),a("h3",{attrs:{id:"_4-模糊查询以通配符开头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-模糊查询以通配符开头"}},[s._v("#")]),s._v(" "),a("strong",[s._v("4. 模糊查询以通配符开头")])]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("LIKE")]),s._v(" 语句中，如果通配符（"),a("code",[s._v("%")]),s._v("或"),a("code",[s._v("_")]),s._v("）出现在字符串开头，则索引失效。")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[a("code",[s._v("%")])]),s._v(" 匹配 "),a("strong",[s._v("零个或多个字符")]),s._v("，可以匹配任意长度的字符串。")])]),s._v(" "),a("li",[a("p",[a("strong",[a("code",[s._v("_")])]),s._v(" 匹配 "),a("strong",[s._v("单个字符")]),s._v("，即它代表一个任意字符")])])]),s._v(" "),a("h4",{attrs:{id:"示例-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-4"}},[s._v("#")]),s._v(" 示例：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%john'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("原因：数据库无法确定以 “"),a("code",[s._v("john")]),s._v("” 结尾的记录范围，只能进行全表扫描。")])]),s._v(" "),a("h4",{attrs:{id:"解决方法-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-4"}},[s._v("#")]),s._v(" 解决方法：")]),s._v(" "),a("p",[s._v("避免通配符出现在开头，或使用全文索引（Full-Text Index）。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'john%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("h3",{attrs:{id:"_5-隐式类型转换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-隐式类型转换"}},[s._v("#")]),s._v(" "),a("strong",[s._v("5. 隐式类型转换")])]),s._v(" "),a("p",[s._v("如果查询条件的字段类型和传入的值类型不一致，数据库可能会进行隐式转换，导致索引失效。")]),s._v(" "),a("h4",{attrs:{id:"示例-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-5"}},[s._v("#")]),s._v(" 示例：")]),s._v(" "),a("p",[s._v("假设 "),a("code",[s._v("id")]),s._v(" 是一个字符串类型字段：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("原因："),a("code",[s._v("id")]),s._v(" 字段为字符串类型，而 "),a("code",[s._v("123")]),s._v(" 是整数，数据库会将 "),a("code",[s._v("id")]),s._v(" 字段转换为数字，导致索引失效。")])]),s._v(" "),a("h4",{attrs:{id:"解决方法-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-5"}},[s._v("#")]),s._v(" 解决方法：")]),s._v(" "),a("p",[s._v("确保查询条件的值类型与字段类型一致。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("h3",{attrs:{id:"_6-查询条件中使用-is-null-或-is-not-null"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-查询条件中使用-is-null-或-is-not-null"}},[s._v("#")]),s._v(" "),a("strong",[s._v("6. 查询条件中使用 IS NULL 或 IS NOT NULL")])]),s._v(" "),a("p",[s._v("对索引字段进行 "),a("code",[s._v("IS NULL")]),s._v(" 或 "),a("code",[s._v("IS NOT NULL")]),s._v(" 查询时，索引通常会失效。")]),s._v(" "),a("h4",{attrs:{id:"示例-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-6"}},[s._v("#")]),s._v(" 示例：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("原因：索引通常不存储 "),a("code",[s._v("NULL")]),s._v(" 值。")])]),s._v(" "),a("h4",{attrs:{id:"解决方法-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-6"}},[s._v("#")]),s._v(" 解决方法：")]),s._v(" "),a("ul",[a("li",[s._v("尽量避免查询 "),a("code",[s._v("NULL")]),s._v(" 值，或使用覆盖索引等其他优化方法。")])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_7-使用-的全模糊匹配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-使用-的全模糊匹配"}},[s._v("#")]),s._v(" "),a("strong",[s._v("7. 使用"),a("code",[s._v("%")]),s._v("的全模糊匹配")])]),s._v(" "),a("p",[s._v("即使没有通配符在开头，"),a("strong",[s._v("全模糊匹配")]),s._v("也可能导致索引失效。")]),s._v(" "),a("h4",{attrs:{id:"示例-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-7"}},[s._v("#")]),s._v(" 示例：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%john%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("原因：全模糊匹配需要扫描所有数据，不能直接利用索引。")])]),s._v(" "),a("h4",{attrs:{id:"解决方法-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-7"}},[s._v("#")]),s._v(" 解决方法：")]),s._v(" "),a("p",[s._v("使用全文索引或专门的搜索工具（如 Elasticsearch）。")]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_8-多列索引未按顺序使用-最左前缀原则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-多列索引未按顺序使用-最左前缀原则"}},[s._v("#")]),s._v(" "),a("strong",[s._v("8. 多列索引未按顺序使用（最左前缀原则）")])]),s._v(" "),a("p",[s._v("对于复合索引，如果查询条件未按照索引字段的顺序使用，可能导致索引失效。")]),s._v(" "),a("h4",{attrs:{id:"示例-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-8"}},[s._v("#")]),s._v(" 示例：")]),s._v(" "),a("p",[s._v("假设有一个复合索引 "),a("code",[s._v("(name, age)")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("原因：复合索引的查询必须从最左侧字段"),a("code",[s._v("name")]),s._v("开始，否则索引无法生效。")])]),s._v(" "),a("h4",{attrs:{id:"解决方法-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-8"}},[s._v("#")]),s._v(" 解决方法：")]),s._v(" "),a("p",[s._v("遵循最左前缀原则，尽量使用索引的最左字段。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'John'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("h3",{attrs:{id:"_9-数据量过少"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-数据量过少"}},[s._v("#")]),s._v(" "),a("strong",[s._v("9. 数据量过少")])]),s._v(" "),a("p",[s._v("如果表中的数据量过少，数据库优化器可能会直接选择全表扫描，而不是使用索引。")]),s._v(" "),a("h4",{attrs:{id:"原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原因"}},[s._v("#")]),s._v(" 原因：")]),s._v(" "),a("ul",[a("li",[s._v("对小表来说，全表扫描的性能可能与索引查询相差无几，因此优化器可能会选择全表扫描。")])]),s._v(" "),a("h4",{attrs:{id:"解决方法-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-9"}},[s._v("#")]),s._v(" 解决方法：")]),s._v(" "),a("p",[s._v("无需特别优化，此时索引失效是数据库的优化行为。")]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_10-索引失效的其他原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-索引失效的其他原因"}},[s._v("#")]),s._v(" "),a("strong",[s._v("10. 索引失效的其他原因")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("统计信息过期")]),s._v("：数据库优化器依赖统计信息，如果统计信息过时可能导致错误的执行计划。")]),s._v(" "),a("li",[a("strong",[s._v("使用非主键或唯一索引字段进行排序")]),s._v("：排序操作可能触发全表扫描。")]),s._v(" "),a("li",[a("strong",[s._v("分页查询中偏移量过大")]),s._v("：分页查询时，较大的偏移量可能导致性能问题。")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"避免索引失效的建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#避免索引失效的建议"}},[s._v("#")]),s._v(" "),a("strong",[s._v("避免索引失效的建议")])]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("设计合理的索引")]),s._v("：\n"),a("ul",[a("li",[s._v("为常用查询条件字段建立索引。")]),s._v(" "),a("li",[s._v("尽量避免在索引字段上使用函数、表达式和计算。")]),s._v(" "),a("li",[s._v("使用覆盖索引优化查询。")])])]),s._v(" "),a("li",[a("strong",[s._v("遵循最左前缀原则")]),s._v("：\n"),a("ul",[a("li",[s._v("复合索引要按顺序使用，从左到右。")])])]),s._v(" "),a("li",[a("strong",[s._v("避免隐式类型转换")]),s._v("：\n"),a("ul",[a("li",[s._v("确保查询条件与字段类型一致。")])])]),s._v(" "),a("li",[a("strong",[s._v("避免模糊查询的通配符开头")]),s._v("：\n"),a("ul",[a("li",[s._v("如果需要模糊匹配，考虑全文索引或外部搜索工具。")])])]),s._v(" "),a("li",[a("strong",[s._v("及时更新统计信息")]),s._v("：\n"),a("ul",[a("li",[s._v("对于大表，定期分析表，确保优化器选择最优的执行计划。")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v("索引失效的主要原因是查询条件和索引设计不匹配。通过合理设计索引、优化查询语句以及遵循索引使用规则，可以有效避免索引失效问题，提升查询性能。在实际开发中，定期分析执行计划（"),a("code",[s._v("EXPLAIN")]),s._v("）是发现索引失效的有效方法。")])])}),[],!1,null,null,null);a.default=e.exports}}]);